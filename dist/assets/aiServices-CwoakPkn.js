import{dF as _,dG as F,b2 as nt,W as q,ct as rt,hF as ie,is as $e,dP as P,it as ze,dI as b,cr as S,dL as p,dM as G,h2 as W,R as de,dK as v,bq as qe,il as st,dH as at,X as it,V as ye,U as he,S as pe,am as ot,jb as lt,aC as ut,jc as ct,jd as ft,w as me,B as w,F as x,J as ge,v as dt,s as yt,j as ht,C as pt,Q as mt}from"./index-DzoQLc5A.js";import{l as gt,p as bt}from"./number-BUyyDjIe.js";import{a as St,f as Tt,s as Nt}from"./utils-DDykF6ND.js";import{t as wt}from"./commonProperties-DHiB1uzW.js";function _t(e){if(typeof e=="string")return e.toLowerCase();if("name"in e)return e.name.toLowerCase();if(typeof e.value!="string")throw new _(null,F.InvalidIdentifier,null);return e.value.toLowerCase()}const yn=Object.freeze({aborted:!1});let be=class{};class E{constructor(){}}function Le(e,t,n){if(e instanceof E&&!(e instanceof oe)){const r=new oe;return r.fn=e,r.parameterEvaluator=n,r.context=t,r}return e}let pn=class extends E{constructor(t){super(),this.fn=t}createFunction(t){return(...n)=>this.fn(t,{preparsed:!0,arguments:n})}call(t,n){return this.fn(t,n)}marshalledCall(t,n,r,s){return s(t,n,((a,o,i)=>{i=i.map((c=>c instanceof E&&!(c instanceof oe)?Le(c,t,s):c));const u=this.call(r,{args:i});return nt(u)?u.then((c=>Le(c,r,s))):u}))}},oe=class extends E{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(t){return this.fn.createFunction(this.context)}call(t,n){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}marshalledCall(t,n,r){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}};class J{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){return this.slice()}slice(t=0,n=this.length()){const r=[];for(let s=t;s<n;s++)r.push(this.get(s));return r}}let H=class Ue extends J{constructor(t,n,r,s,a,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=r,this._hasM=s,this._cacheId=a,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const n=this._elements[t];if(n===void 0)return;const r=new q(n[0],n[1],this._spRef);this._hasZ&&(r.z=n[2]),this._hasM&&(r.m=this._hasZ?n[3]:n[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=r}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof Ue&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class Se extends J{constructor(t,n,r,s,a){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=n,this._cacheId=a}get(t){if(this._lazyPath[t]===void 0){const n=this._elements[t];if(n===void 0)return;this._lazyPath[t]=new H(n,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof Se&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}var Me,Pe;function bn(e){return rt.fromJSON(e.toJSON())}function Ft(e){return e.toJSON?e.toJSON():e}function Sn(e){return e instanceof Date}function Tn(e){return e instanceof ie}function Nn(e){return e instanceof P}function wn(e){return e instanceof ze}function _n(e){return e instanceof $e}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Me||(Me={})),(function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"})(Pe||(Pe={}));const Fn=1e3,vn={point:"point"},Ge={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},xn={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function On(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function Cn(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(i,u){const c={key:i,value:o[i]},d={key:u,value:o[u]};return s(c,d)}});var s;const a=[];return(function o(i){if(i!=null&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i===void 0)return;if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);let u,c;if(Array.isArray(i)){for(c="[",u=0;u<i.length;u++)u&&(c+=","),c+=o(i[u])||"null";return c+"]"}if(i===null)return"null";if(a.includes(i)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=a.push(i)-1,y=Object.keys(i).sort(r==null?void 0:r(i));for(c="",u=0;u<y.length;u++){const k=y[u],N=o(i[k]);N&&(c&&(c+=","),c+=JSON.stringify(k)+":"+N)}return a.splice(d,1),"{"+c+"}"})(e)}function vt(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function kn(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return vt(e)}}let xt=class{constructor(t){this.value=t}};class Ot{constructor(t){this.value=t}}const T={type:"VOID"},Ct=Symbol("BREAK"),kt=Symbol("CONTINUE");function V(e,t,n){return t===""||t==null||t===n||t===n?e:e=e.split(t).join(n)}function Y(e){return e instanceof E}function Te(e){return e instanceof be}function U(e){return!!p(e)||!!S(e)||!!h(e)||!!m(e)||!!g(e)||!!b(e)||e===null||e===T||typeof e=="number"}function Dt(e,t){return e===void 0?t:e}function Zt(e){return e==null?"":v(e)||C(e)?"Array":h(e)?"Date":g(e)?"Time":m(e)?"DateOnly":p(e)?"String":b(e)?"Boolean":S(e)?"Number":(e==null?void 0:e.declaredClass)==="esri.arcade.Attachment"?"Attachment":(e==null?void 0:e.declaredClass)==="esri.arcade.Portal"?"Portal":(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?"Dictionary":ve(e)?"KnowledgeGraph":e instanceof be?"Module":K(e)?"Feature":e instanceof q?"Point":e instanceof ye?"Polygon":e instanceof he?"Polyline":e instanceof pe?"Multipoint":e instanceof de?"Extent":Y(e)?"Function":we(e)?"FeatureSet":Fe(e)?"FeatureSetCollection":Ne(e)?"Voxel":e===T?"":typeof e=="number"&&isNaN(e)?"Number":"Unrecognized Type"}function At(e){return e===T}function ne(e){return e instanceof G}function K(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function Ne(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Voxel"}function we(e){return(e==null?void 0:e.declaredRootClass)==="esri.arcade.featureset.support.FeatureSet"}function _e(e){return(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"}function It(e){return _e(e)||K(e)||Ne(e)}function Fe(e){return(e==null?void 0:e.declaredRootClass)==="esri.arcade.featureSetCollection"}function ve(e){return(e==null?void 0:e.declaredClass)==="esri.rest.knowledgeGraph.KnowledgeGraph"}function C(e){return e instanceof J}function h(e){return e instanceof P}function m(e){return e instanceof ze}function g(e){return e instanceof $e}function le(e){return e!=null&&typeof e=="object"}function Be(e,t,n,r,s){if(e.length<t||e.length>n)throw new _(r,F.WrongNumberOfParameters,s)}function Jt(e){return e<0?-Math.round(-e):Math.round(e)}function xe(e,t){return isNaN(e)||t==null||t===""?e.toString():(t=V(t,"‰",""),t=V(t,"¤",""),gt(e,{pattern:t}))}function re(e,t){return t==null||t===""?e.toISOString(!0):e.toFormat(Ye(t),{locale:qe(),numberingSystem:"latn"})}function Ye(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const s of e.match(r)||[])switch(s){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=s;break;default:s.length>=2&&s.slice(0,1)==="["&&s.slice(-1)==="]"?n+=`'${s.slice(1,-1)}'`:n+=`'${s}'`}return n}function l(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function Lt(e,t,n){if(e===null){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(p(t)||b(t))return l(0,f(t),n);if(h(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}if(e===T){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(p(t)||b(t))return l(0,f(t),n);if(h(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}else if(S(e)){if(S(t))return l(e,t,n);if(b(t))return l(e,f(t),n);if(t===null||t===T)return l(e,0,n);if(p(t))return l(e,f(t),n);if(h(t)||g(t)||m(t))return l(e,t.toNumber(),n)}else if(p(e)){if(p(t))return l(I(e),I(t),n);if(h(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(S(t))return l(f(e),t,n);if(t===null||t===T)return l(f(e),0,n);if(b(t))return l(f(e),f(t),n)}else if(h(e)){if(h(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=P.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=P.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))throw new _(null,F.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(b(e)){if(b(t))return l(e,t,n);if(S(t))return l(f(e),f(t),n);if(h(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(t===null||t===T)return l(f(e),0,n);if(p(t))return l(f(e),f(t),n)}else if(m(e)){if(h(t))return l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))throw new _(null,F.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(g(e)){if(h(t))throw new _(null,F.CannotCompareDateAndTime,null);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||p(t))return l(e.toNumber(),f(t),n);if(g(t))return l(e.toNumber(),t.toNumber(),n);if(m(t))throw new _(null,F.CannotCompareDateAndTime,null)}return!!Ee(e,t)&&(n==="<="||n===">=")}function Ee(e,t){if(e===t||e===null&&t===T||t===null&&e===T)return!0;if(h(e)&&h(t)||g(e)&&g(t)||m(e)&&m(t))return e.equals(t);if(e instanceof Se||e instanceof H)return e.equalityTest(t);if(e instanceof q&&t instanceof q){const n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(n!=null)return n===r}return!!(le(e)&&le(t)&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null))}function Ve(e,{useNumbersForDates:t}){let n="";for(const r in e){n!==""&&(n+=",");const s=e[r];s==null?n+=JSON.stringify(r)+":null":b(s)||S(s)||p(s)?n+=JSON.stringify(r)+":"+JSON.stringify(s):ne(s)?n+=JSON.stringify(r)+":"+z(s):g(s)||m(s)?n+=`${JSON.stringify(r)}:${JSON.stringify(s.toString())}`:C(s)||Array.isArray(s)?n+=JSON.stringify(r)+":"+z(s,null,t):h(s)?n+=t?JSON.stringify(r)+":"+JSON.stringify(s.getTime()):JSON.stringify(r)+":"+s.stringify():s!==null&&typeof s=="object"&&"castToText"in s&&(n+=JSON.stringify(r)+":"+s.castToText(t))}return"{"+n+"}"}function I(e,t){if(p(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(h(e))return re(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof G)return JSON.stringify(e.toJSON());if(v(e)){const n=[];for(let r=0;r<e.length;r++)n[r]=Q(e[r]);return"["+n.join(",")+"]"}if(e instanceof J){const n=[];for(let r=0;r<e.length();r++)n[r]=Q(e.get(r));return"["+n.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText():Y(e)?"object, Function":e===T?"":Te(e)?"object, Module":""}function Mt(e){const t=[];if(e instanceof J){for(let n=0;n<e.length();n++)t[n]=f(e.get(n));return t}if(!v(e))return null;for(let n=0;n<e.length;n++)t[n]=f(e[n]);return t}function z(e,t,n=!1){if(p(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(h(e))return re(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof G)return e instanceof de?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+ue(e.spatialReference)+"}":ue(e.toJSON(),((r,s)=>r.key===s.key?0:r.key==="spatialReference"?1:s.key==="spatialReference"||r.key<s.key?-1:r.key>s.key?1:0));if(v(e)){const r=[];for(let s=0;s<e.length;s++)r[s]=Q(e[s],n);return"["+r.join(",")+"]"}if(e instanceof J){const r=[];for(let s=0;s<e.length();s++)r[s]=Q(e.get(s),n);return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText(n):Y(e)?"object, Function":e===T?"":Te(e)?"object, Module":""}function Q(e,t=!1){if(e===null)return"null";if(b(e)||S(e)||p(e))return JSON.stringify(e);if(e instanceof G||e instanceof J||Array.isArray(e))return z(e,null,t);if(h(e))return JSON.stringify(t?e.getTime():re(e,""));if(g(e)||m(e))return JSON.stringify(e.toString());if(e!==null&&typeof e=="object"){if("castToText"in e)return e.castToText(t)}else if(e===T)return"null";return"null"}function f(e,t){return S(e)?e:e===null||e===""?0:h(e)||m(e)||g(e)?NaN:b(e)?e?1:0:v(e)||e===""||e===void 0?NaN:t!==void 0&&p(e)?(t=V(t,"‰",""),t=V(t,"¤",""),bt(e,{pattern:t})):e===T?0:Number(e)}function Pt(e,t){if(h(e))return e;if(p(e)){const n=Gt(e,t);if(n)return P.dateTimeToArcadeDate(n)}return null}function Gt(e,t){const n=/ (\d\d)/,r=ft(t);let s=ie.fromISO(e,{zone:r});return s.isValid||n.test(e)&&(e=e.replace(n,"T$1"),s=ie.fromISO(e,{zone:t}),s.isValid)?s:null}function jt(e){return b(e)?e:p(e)?(e=e.toLowerCase())==="true":!!S(e)&&e!==0&&!isNaN(e)}function Rt(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),it(n)}function $t(e,t){return e==null?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function zt(e){if(e===null)return null;if(e instanceof q)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof ye){if((e.curveRings??e.rings).length===0)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof he){if((e.curvePaths??e.paths).length===0)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof pe?e.points.length===0?null:e:e instanceof de?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function He(e,t){if(!e||!e.domain)return t;let n=null,r=null;if(h(t))n=t.toNumber();else if(m(t))n=t.toString();else if(g(t))n=t.toStorageString();else if(e.field.type==="string"||e.field.type==="esriFieldTypeString")n=I(t);else{if(t==null)return null;if(t==="")return t;n=f(t)}for(let s=0;s<e.domain.codedValues.length;s++){const a=e.domain.codedValues[s];a.code===n&&(r=a)}return r===null?I(t):r.name}function Ke(e,t){if(!e||!e.domain)return t;let n=null;const r=I(t);for(let s=0;s<e.domain.codedValues.length;s++){const a=e.domain.codedValues[s];a.name===r&&(n=a)}return n===null?t:n.code}function se(e,t,n=null,r=null){if(!t||!t.fields)return null;let s,a,o=null;for(let d=0;d<t.fields.length;d++){const y=t.fields[d];y.name.toLowerCase()===e.toString().toLowerCase()&&(o=y)}if(o===null)throw new _(null,F.FieldNotFound,null,{key:e});let i=t.typeIdField,u="id",c=t.types;if(t.subtypeField&&(i=t.subtypeField,u="code",c=t.subtypes??[]),r===null&&n&&i)r=n.hasField(i)?n.field(i):null;else if(i&&r!==null){let d=!1;for(const y of c||[])if(r===y[u]){d=!0;break}if(!d){for(const y of c||[])if(r===y.name){r=y[u],d=!0;break}}d||(r=null,n&&i&&(r=n.hasField(i)?n.field(i):null))}return r!=null&&c.some((d=>{var y;return d[u]===r&&(s=(y=d.domains)==null?void 0:y[o.name],s&&s.type==="inherited"&&(s=je(o.name,t),a=!0),!0)})),a||s||(s=je(e,t)),{field:o,domain:s}}function je(e,t){let n;return t.fields.some((r=>(r.name.toLowerCase()===e.toLowerCase()&&(n=r.domain),!!n))),n}function ue(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(i,u){const c={key:i,value:o[i]},d={key:u,value:o[u]};return s(c,d)}});var s;const a=[];return(function o(i){if(i!=null&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i===void 0)return;if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);let u,c;if(Array.isArray(i)){for(c="[",u=0;u<i.length;u++)u&&(c+=","),c+=o(i[u])||"null";return c+"]"}if(i===null)return"null";if(a.includes(i)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=a.push(i)-1,y=Object.keys(i).sort(r==null?void 0:r(i));for(c="",u=0;u<y.length;u++){const k=y[u],N=o(i[k]);N&&(c&&(c+=","),c+=JSON.stringify(k)+":"+N)}return a.splice(d,1),"{"+c+"}"})(e)}function qt(e){if(e===null)return null;const t=[];for(const n of e)K(n)?t.push(n.geometry()):t.push(n);return t}function B(e,t){if(!(t instanceof q))throw new _(null,F.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Ut(e,t){if(v(e)||C(e)){let n=!1,r=!1,s=[],a=t;if(v(e)){for(const o of e)B(s,o);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof H)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else{if(!C(e))throw new _(null,F.InvalidParameter,null);for(const o of e.toArray())B(s,o);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(ct(s)||(s=s.slice().reverse()),new ye({rings:[s],spatialReference:a,hasZ:n,hasM:r}))}return e}function Bt(e,t){if(v(e)||C(e)){let n=!1,r=!1,s=[],a=t;if(v(e)){for(const o of e)B(s,o);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof H)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(C(e)){for(const o of e.toArray())B(s,o);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new he({paths:[s],spatialReference:a,hasZ:n,hasM:r})}return e}function Yt(e,t){if(v(e)||C(e)){let n=!1,r=!1,s=[],a=t;if(v(e)){for(const o of e)B(s,o);s.length>0&&(a=e[0].spatialReference,n=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof H)s=e._elements,s.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(C(e)){for(const o of e.toArray())B(s,o);s.length>0&&(a=e.get(0).spatialReference,n=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new pe({points:s,spatialReference:a,hasZ:n,hasM:r})}return e}function ce(e,t=!0){if(e==null)return[];if(v(e)){const n=[];for(const r of e){const s=I(r);(t||s!=="")&&n.push(s)}return n}if(C(e)){const n=[];for(let r=0;r<e.length();r++){const s=I(e.get(r));(t||s!=="")&&n.push(s)}return n}if(U(e)){const n=I(e);if(t||n!=="")return[n]}return[]}let ae=0;function Et(e){return ae++,ae%100==0?(ae=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Vt(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function $(e,t=null){return e==null?null:b(e)||S(e)||p(e)?e:e instanceof G?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof J?e.toArray().map((n=>$(n,t))):Array.isArray(e)?e.map((n=>$(n,t))):W(e)?e:h(e)?e.toJSDate():g(e)?e.toString():m(e)?e.toJSDate():e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function Ht(e,t,n,r,s){const a=await Oe(e,t,n);s[r]=a}async function Oe(e,t=null,n=null){if(e instanceof J&&(e=e.toArray()),e==null)return null;if(U(e)||e instanceof G||W(e)||h(e))return $(e,n);if(Array.isArray(e)){const r=[],s=[];for(const a of e)a===null||U(a)||a instanceof G||W(a)||h(a)?s.push($(a,n)):(s.push(null),r.push(Ht(a,t,n,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,n):null}function X(e){return Xe(e)?e.parent:e}function Xe(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.support.SubtypeSublayer"}function Kt(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Xt(e,t,n){const r=X(e.fullSchema());return r===null||!r.fields?null:se(t,r,e,n)}function Wt(e){const t=X(e.fullSchema());return t===null?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map((n=>({name:n.name,code:n.code}))):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((n=>({name:n.name,code:n.id}))):[]}:null:null}function Qt(e,t,n,r){const s=X(e.fullSchema());if(s===null||!s.fields)return null;const a=se(t,s,e,r);if(n===void 0)try{n=e.field(t)}catch{return null}return He(a,n)}function en(e,t,n,r){const s=X(e.fullSchema());if(s===null||!s.fields)return null;if(n===void 0){try{n=e.field(t)}catch{return null}return n}return Ke(se(t,s,e,r),n)}function tn(e){return(e==null?void 0:e.timeZone)??"system"}function nn(e){const t=X(e.fullSchema());if(t===null||!t.fields)return null;const n=[];for(const r of t.fields)n.push(Ft(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:Ge[t.geometryType]===void 0?"":Ge[t.geometryType],fields:n}}function rn(e,t){const n=P.systemTimeZoneCanonicalName;return e==="system"&&(e=n),{version:We,engineVersion:lt,timeZone:e,userTimeZone:n,spatialReference:t instanceof ut?t.toJSON():t,application:ot.applicationName??"",engine:"web",locale:qe()}}const We="1.32",Zn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Ot,ReturnResult:xt,absRound:Jt,arcadeVersion:We,autoCastArrayOfPointsToMultiPoint:Yt,autoCastArrayOfPointsToPolygon:Ut,autoCastArrayOfPointsToPolyline:Bt,autoCastFeatureToGeometry:qt,binaryOperator:Vt,breakResult:Ct,castAsJson:$,castAsJsonAsync:Oe,castRecordToText:Ve,continueResult:kt,defaultExecutingContext:rn,defaultTimeZone:tn,defaultUndefined:Dt,equalityTest:Ee,featureDomainCodeLookup:en,featureDomainValueLookup:Qt,featureFullDomain:Xt,featureSchema:nn,featureSubtypes:Wt,fixNullGeometry:zt,fixSpatialReference:$t,formatDate:re,formatNumber:xe,getDomain:se,getDomainCode:Ke,getDomainValue:He,getType:Zt,greaterThanLessThan:Lt,isArray:v,isBoolean:b,isDate:h,isDateOnly:m,isDictionary:_e,isDictionaryLike:It,isFeature:K,isFeatureSet:we,isFeatureSetCollection:Fe,isFunctionParameter:Y,isGeometry:ne,isGraphic:at,isImmutableArray:C,isInteger:st,isJsDate:W,isKnowledgeGraph:ve,isModule:Te,isNumber:S,isObject:le,isSimpleType:U,isString:p,isSubtypeGrouplayer:Kt,isSubtypeSublayer:Xe,isTime:g,isVoid:At,isVoxel:Ne,multiReplace:V,parseGeometryFromJson:Rt,pcCheck:Be,stableStringify:ue,standardiseDateFormat:Ye,tick:Et,toBoolean:jt,toDate:Pt,toNumber:f,toNumberArray:Mt,toString:I,toStringArray:ce,toStringExplicit:z,voidOperation:T},Symbol.toStringTag,{value:"Module"}));function An(e){Qe=e}let Qe;function fe(e){return e===null?null:h(e)?e.clone():U(e)?e:ne(e)?e.clone():C(e)?e.toArray().map((t=>fe(t))):v(e)?e.map((t=>fe(t))):K(e)?Qe.createFromArcadeFeature(e):Fe(e)||we(e)?e:_e(e)||(e==null?void 0:e.declaredClass)==="esri.arcade.Attachment"?e.deepClone():((e==null?void 0:e.declaredClass)==="esri.arcade.Portal"||ve(e)||e instanceof be||Y(e),e)}function ee(e,t,n=!1,r=!1){if(e==null)return null;if(S(e)||b(e)||p(e)||h(e)||m(e)||g(e))return e;if(v(e)){const a=[];for(const o of e)a.push(ee(o,t,n,r));return a}if(r&&ne(e))return e;const s=new Z;s.immutable=!1;for(const[a,o]of Object.entries(e))o!==void 0&&s.setField(a,ee(o,t,n,r));return s.immutable=n,s}class Z{constructor(t){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,t instanceof Z?this.attributes=t.attributes:t==null?this.attributes=Object.create(null):Object.getPrototypeOf(t)!=null?this.attributes={__proto__:null,...t}:this.attributes=t}static containerEntry(t,n){return new Z({__proto__:null,key:t,value:n})}static textFormatting(){const t=new Z({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return t.immutable=!1,t}field(t){const n=t.toLowerCase(),r=this.attributes[t];if(r!==void 0)return r;for(const s in this.attributes)if(s.toLowerCase()===n)return this.attributes[s];throw new _(null,F.FieldNotFound,null,{key:t})}setField(t,n){if(this.immutable)throw new _(null,F.Immutable,null);if(Y(n))throw new _(null,F.NoFunctionInDictionary,null);const r=t.toLowerCase();if(n instanceof Date&&(n=P.dateJSToArcadeDate(n)),this.attributes[t]===void 0){for(const s in this.attributes)if(s.toLowerCase()===r)return void(this.attributes[s]=n);this.attributes[t]=n}else this.attributes[t]=n}hasField(t){const n=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(const r in this.attributes)if(r.toLowerCase()===n)return!0;return!1}keys(){let t=[];for(const n in this.attributes)t.push(n);return t=t.sort(),t}castToText(t=!1){return Ve(this.attributes,{useNumbersForDates:t})}static convertObjectToArcadeDictionary(t,n,r=!0,s=!1){const a=new Z;a.immutable=!1;for(const o in t){const i=t[o];i!==void 0&&a.setField(o.toString(),ee(i,n,r,s))}return a.immutable=r,a}static convertJsonToArcade(t,n,r=!1,s=!1){return ee(t,n,r,s)}castAsJson(t=null){const n=Object.create(null);for(let r in this.attributes){const s=this.attributes[r];s!==void 0&&(t!=null&&t.keyTranslate&&(r=t.keyTranslate(r)),n[r]=$(s,t))}return n}async castDictionaryValueAsJsonAsync(t,n,r,s=null,a){const o=await Oe(r,s,a);return t[n]=o,o}async castAsJsonAsync(t=null,n=null){const r=Object.create(null),s=[];for(let a in this.attributes){const o=this.attributes[a];n!=null&&n.keyTranslate&&(a=n.keyTranslate(a)),o!==void 0&&(U(o)||o instanceof G||o instanceof P?r[a]=$(o,n):s.push(this.castDictionaryValueAsJsonAsync(r,a,o,t,n)))}return s.length>0&&await Promise.all(s),r}deepClone(){const t=new Z;t.immutable=!1;for(const n of this.keys())t.setField(n,fe(this.field(n)));return t}}let A=class extends me{constructor(e){super(e),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([x({type:String,json:{write:!0}})],A.prototype,"key",void 0),w([x({type:String,json:{write:!0}})],A.prototype,"text",void 0),w([x({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],A.prototype,"detectedLanguage",void 0),w([x({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],A.prototype,"detectedLanguageScore",void 0),w([x({type:Object,json:{write:!0}})],A.prototype,"translation",void 0),A=w([ge("esri.rest.support.TranslateResult")],A);async function sn(e,t,n){const r=t.toJSON();r.contents=JSON.stringify(r.contents),r.token=await St(t.portalUrl,t.apiKey,{signal:n==null?void 0:n.signal,prompt:(n==null?void 0:n.authMode)!=="no-prompt"});const s=Tt(e),a=Nt(s.query,{...n,query:r,method:"post",authMode:"anonymous"});return(await dt(s.path,a)).data.results.map((o=>A.fromJSON(o)))}let R=class extends me{constructor(e){super(e)}};w([x({type:String,json:{write:!0}})],R.prototype,"key",void 0),w([x({type:String,json:{write:!0}})],R.prototype,"text",void 0),R=w([ge("esri.rest.support.TranslateContent")],R);let D=class extends me{constructor(e){super(e),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([x({type:[String],json:{write:!0}})],D.prototype,"to",void 0),w([x({type:[R],json:{write:!0}})],D.prototype,"contents",void 0),w([x({type:String,json:{write:!0}})],D.prototype,"portalUrl",void 0),w([x({type:String,json:{write:!0,default:"esri"}})],D.prototype,"translator",void 0),w([x({type:String,json:{write:!0}})],D.prototype,"from",void 0),w([x(wt)],D.prototype,"apiKey",void 0),w([x({type:String,json:{name:"x-esri-request-source"}})],D.prototype,"requestSource",void 0),D=w([ge("esri.rest.support.TranslateParameters")],D);class et{constructor(t,n){this.portal=t,this._debugLog=n}async translate(t){var s;this.portal.loaded||await this.portal.load();const n=(s=this.portal.helperServices)==null?void 0:s.aiUtilityServices;if(n==null)return{success:!1};const r=n.url+n.translateUtility;try{return t.requestSource??(t.requestSource="arcade"),{success:!0,results:(await sn(r,t,{authMode:"no-prompt"})).map((a=>a.toJSON()))}}catch(a){return this._debugLog!=null&&(a instanceof Error||a instanceof yt)&&this._debugLog(`TranslateText error: ${a.message}`),ht.getLogger("esri.arcade.functions.aiServices").error(a),{success:!1}}}}class an{constructor(t,n,r){this._parameters=t,this._maxTotalContentSize=n,this._maxContentsLength=r,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(t){const n=new Set(t.filter((a=>!this._normalizedContents.has(a.text))).map((a=>a.text)));if(this._requests.length+n.size>this._maxContentsLength)return null;let r=0;for(const a of n)r+=a.length;if((r+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const s=this._requests.length;for(const{key:a,text:o}of t)mt(this._normalizedContents,o,(()=>[])).push({batchIdx:s,key:a});return this._requests.push(t),this._contentsTotalSize+=r,s}async send(t){const n=[],r=[];let s=0;for(const[u,c]of this._normalizedContents)n.push(new R({key:String(s++),text:u})),r.push(c);const a=new D(this._parameters);a.contents=n;const o=await t.translate(a);if(!o.success)return Array.from(this._requests,(()=>o));const i=Array.from(this._requests,(()=>({success:!0,results:[]})));for(const u of o.results){const c=Number(u.key);for(const d of r[c])i[d.batchIdx].results.push({...u,key:d.key})}return i}}function te(e){const t=[...new Set(e.to)].sort(),n=e.from??null,r=e.portalUrl,s=e.translator,a=e.apiKey??null;return JSON.stringify([t,n,r,s,a])}async function Re(e,t,n){try{return(await e.yieldFor(n))[t]}catch{return{success:!1}}}class on{constructor(t,n,{maxTotalContentSize:r=5e4,maxContentsLength:s=1e3}={}){this._executor=t,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=r,this._maxContentsLength=s}create(t){return{translate:async n=>{const r=te(n),{contents:s,to:a,from:o,translator:i,portalUrl:u,apiKey:c}=n;if(a==null)return{success:!1};if(s==null||s.every((N=>N.text.length===0)))return{success:!1};const d=this._openBatches.get(r);if(d!=null){const N=d.data.tryAdd(s);if(N!=null)return await Re(t,N,d);d.send()}const y=new an({to:a,from:o,translator:i,portalUrl:u,apiKey:c},this._maxTotalContentSize,this._maxContentsLength),k=y.tryAdd(s);if(k!=null){const N=this._executor.openBatch(y,{open:j=>{this._openBatches.set(r,j)},execute:j=>j.send(this._service),close:j=>{this._openBatches.get(r)===j&&this._openBatches.delete(r)}});return await Re(t,k,N)}return await this._service.translate(n)}}}}function ln(e){e.mode==="async"&&(e.functions[_t("TranslateText")]=function(t,n){return e.standardFunctionAsync(t,n,(async(r,s,a)=>{var Ce,ke,De,Ze,Ae,Ie;if(Be(a,2,3,r,s),!p(a[0])&&!v(a[0])&&!C(a[0]))throw new _(r,F.InvalidParameter,s);const o=ce(a[0]);if(!p(a[1])&&!v(a[1])&&!C(a[1]))throw new _(r,F.InvalidParameter,s);const i=ce(a[1]);let u=null;if(a.length>=3){if(!p(a[2]))throw new _(r,F.InvalidParameter,s);u=a[2]}const c=o.map(((L,O)=>new R({key:String(O),text:L}))),d=((Ce=r.services)==null?void 0:Ce.portal)??pt.getDefault(),y=new D({to:i,contents:c,from:u,portalUrl:d.restUrl.replace(/\/sharing\/rest$/,"")}),k=new Map;let N=null;if(r.lrucache!=null){const L=r.lrucache;N??(N=te(y)),y.contents=(ke=y.contents)==null?void 0:ke.filter((O=>{const M=L.getCachedTranslation(N,O.text);return M==null||(k.set(O.key,{...M,key:O.key,text:O.text}),!1)}))}if((De=y.contents)!=null&&De.length){const L=((Ze=r.services)==null?void 0:Ze.translation)??new et(d,r.console),O=await L.translate(y);if(!O.success)return new Z({__proto__:null,success:!1});for(const M of O.results){const Je=(Ie=(Ae=y.contents)==null?void 0:Ae.find((tt=>tt.key===M.key)))==null?void 0:Ie.text;if(Je==null)throw new _(null,F.NeverReach,null);k.set(M.key,M),r.lrucache!=null&&(N??(N=te(y)),r.lrucache.setCachedTranslation(N,Je,{detectedLanguage:M.detectedLanguage,translation:M.translation}))}}const j=Array.from(c,(L=>{const O=A.fromJSON(k.get(L.key));if(O==null)throw new _(null,F.NeverReach,null);return O.text=L.text,Z.convertJsonToArcade(O.toJSON(),r.timeZone??"system",!0)}));return new Z({__proto__:null,success:!0,results:j})}))})}const In=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:on,PortalTranslationService:et,getTranslateParametersKey:te,registerFunctions:ln},Symbol.toStringTag,{value:"Module"}));export{K as $,h as A,en as B,se as C,He as D,g as E,m as F,Y as G,ne as H,T as I,$t as J,we as K,Yt as L,Ut as M,f as N,Ke as O,Ct as P,It as Q,Bt as R,on as S,ln as T,At as U,jt as V,nn as W,ve as X,kt as Y,_e as Z,Ot as _,Be as a,Pt as a0,Fe as a1,J as a2,ce as a3,kn as a4,V as a5,bn as a6,Me as a7,Tn as a8,Sn as a9,rn as aA,Zn as aB,_n as aa,Nn as ab,wn as ac,vn as ad,Pe as ae,Ft as af,Ge as ag,Et as ah,Fn as ai,Cn as aj,On as ak,vt as al,Xe as am,H as an,Se as ao,Ve as ap,U as aq,$ as ar,An as as,fe as at,Zt as au,Ye as av,Jt as aw,zt as ax,Ne as ay,Mt as az,C as b,Vt as c,Ee as d,pn as e,Le as f,et as g,be as h,In as i,Z as j,qt as k,tn as l,Lt as m,yn as n,Xt as o,I as p,Dt as q,E as r,oe as s,_t as t,Wt as u,xt as v,te as w,Qt as x,z as y,xn as z};
