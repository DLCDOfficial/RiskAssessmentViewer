const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./unitConversion-Bk3Wy7HF.js","./index-Bdk4Sca1.js","./index-DE10eTWw.css"])))=>i.map(i=>d[i]);
import{bU as $,a0 as H,gp as m,gi as s,gj as o,aC as y,gn as S,jq as O,V as x,cr as j,_ as nn,as as R,cs as b,cP as V,h as tn,C as z}from"./index-Bdk4Sca1.js";import{i as v,A as D,k as en,U as rn,T as an,m as sn,q as on,r as un,t as B}from"./arcade-BW2XYcer.js";import{w,a as h,o as K,i as W,k as Q,p as X,b as J,M as q,K as L,R as M,H as E,V as k,Z,N as P,T as ln,q as T,j as C,l as U}from"./aiServices-m_n14f1F.js";import{l as Y}from"./portalUtils-CluutDlk.js";import{a as d}from"./operatorsWorkerConnection-BuWkAizZ.js";import"./featureConversionUtils-D-LqQla5.js";import"./OptimizedFeature-BX2Fv57A.js";import"./memoryEstimations-FXmOR3Da.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-BP5E8iZN.js";import"./WhereClause-BMNqinzW.js";import"./unitConversion-Bk3Wy7HF.js";import"./number-0XJjYpJh.js";import"./commonProperties-DHiB1uzW.js";async function G(i,t,e){var r,a;if(!((r=$)==null?void 0:r.findCredential(i.restUrl)))return null;if(i.loadStatus==="loaded"&&t===""&&((a=i.user)!=null&&a.sourceJSON)&&e===!1)return i.user.sourceJSON;const f={responseType:"json",query:{f:"json"}};if(e&&(f.query.returnUserLicenseTypeExtensions=!0),t===""){const u=await H(i.restUrl+"/community/self",f);if(u.data){const l=u.data;if(l!=null&&l.username)return l}return null}const n=await H(i.restUrl+"/community/users/"+t,f);if(n.data){const u=n.data;return u.error?null:u}return null}function N(i){if(i==null)return i;switch(typeof i){case"string":case"number":return i;default:throw new s(null,o.InvalidParameter,null)}}function An(i){i.mode==="async"&&(i.functions.disjoint=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]===null||n[1]===null||d("disjoint",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.intersects=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("intersects",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.touches=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("touches",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.crosses=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("crosses",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.within=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("within",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.contains=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("contains",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.overlaps=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(n=w(n),v(n,t,e),n[0]!==null&&n[1]!==null&&d("overlaps",[n[0].toJSON(),n[1].toJSON()]))))},i.functions.equals=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>(h(n,2,2,t,e),n[0]===n[1]||(n[0]instanceof m&&n[1]instanceof m?d("equals",[n[0].toJSON(),n[1].toJSON()]):(K(n[0])&&K(n[1])||!!(W(n[0])&&W(n[1])||Q(n[0])&&Q(n[1])))&&n[0].equals(n[1])))))},i.functions.relate=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>{if(n=w(n),h(n,3,3,t,e),n[0]instanceof m&&n[1]instanceof m)return d("relate",[n[0].toJSON(),n[1].toJSON(),X(n[2])]);if(n[0]instanceof m&&n[1]===null||n[1]instanceof m&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new s(t,o.InvalidParameter,e)}))},i.functions.intersection=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>(n=w(n),v(n,t,e),n[0]===null||n[1]===null?null:y(await d("intersection",[n[0].toJSON(),n[1].toJSON()])))))},i.functions.union=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if((n=w(n)).length===0)throw new s(t,o.WrongNumberOfParameters,e);const r=[];if(n.length===1)if(S(n[0])){for(const a of w(n[0]))if(a!==null){if(!(a instanceof m))throw new s(t,o.InvalidParameter,e);r.push(a.toJSON())}}else{if(!J(n[0])){if(n[0]instanceof m)return q(O(n[0]),t.spatialReference);if(n[0]===null)return null;throw new s(t,o.InvalidParameter,e)}for(const a of w(n[0].toArray()))if(a!==null){if(!(a instanceof m))throw new s(t,o.InvalidParameter,e);r.push(a.toJSON())}}else for(const a of n)if(a!==null){if(!(a instanceof m))throw new s(t,o.InvalidParameter,e);r.push(a.toJSON())}return r.length===0?null:y(await d("union",[r]))}))},i.functions.difference=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>(n=w(n),v(n,t,e),n[0]===null?null:n[1]===null?O(n[0]):y(await d("difference",[n[0].toJSON(),n[1].toJSON()])))))},i.functions.symmetricdifference=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>(n=w(n),v(n,t,e),n[0]===null&&n[1]===null?null:n[0]===null?O(n[1]):n[1]===null?O(n[0]):y(await d("symmetricDifference",[n[0].toJSON(),n[1].toJSON()])))))},i.functions.clip=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,2,t,e),!(n[1]instanceof x)&&n[1]!==null)throw new s(t,o.InvalidParameter,e);if(n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);return n[1]===null?null:y(await d("clip",[n[0].toJSON(),n[1].toJSON()]))}))},i.functions.cut=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,2,t,e),!(n[1]instanceof j)&&n[1]!==null)throw new s(t,o.InvalidParameter,e);if(n[0]===null)return[];if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);return n[1]===null?[O(n[0])]:(await d("cut",[n[0].toJSON(),n[1].toJSON()])).map((r=>y(r)))}))},i.functions.area=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(h(n,1,2,t,e),n=w(n),L(n[0])){const a=await n[0].sumArea(N(n[1]),null,t.abortSignal);if(t.abortSignal.aborted)throw new s(t,o.Cancelled,e);return a}let r=n[0];if((S(r)||J(r))&&(r=M(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new s(t,o.InvalidParameter,e);return d("area",[r.toJSON(),N(n[1])])}))},i.functions.areageodetic=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{h(n,1,3,t,e);let r=(n=w(n))[0];(S(r)||J(r))&&(r=M(r,t.spatialReference));const a=N(n[1]),u=D(n[2]);if(L(r)){const l=await r.sumArea(a,u,t.abortSignal);if(t.abortSignal.aborted)throw new s(t,o.Cancelled,e);return l}if(r==null)return 0;if(!E(r))throw new s(t,o.InvalidParameter,e);return d("geodeticArea",[r.toJSON(),a,u])}))},i.functions.length=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(h(n,1,2,t,e),n=w(n),L(n[0])){const a=await n[0].sumLength(N(n[1]),null,t.abortSignal);if(t.abortSignal.aborted)throw new s(t,o.Cancelled,e);return a}let r=n[0];if((S(n[0])||J(n[0]))&&(r=k(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new s(t,o.InvalidParameter,e);return d("length",[r.toJSON(),N(n[1])])}))},i.functions.length3d=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(h(n,1,2,t,e),(n=w(n))[0]===null)return 0;let r=n[0];if((S(n[0])||J(n[0]))&&(r=k(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new s(t,o.InvalidParameter,e);if(r.hasZ===!0){const{convertFromSpatialReferenceUnit:a,toLengthUnit:u}=await nn(()=>import("./unitConversion-Bk3Wy7HF.js"),__vite__mapDeps([0,1,2]),import.meta.url),l=en(r);return a(r.spatialReference,u(n[1]),l)}return d("length",[r.toJSON(),N(n[1])])}))},i.functions.lengthgeodetic=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{h(n,1,3,t,e);let r=(n=w(n))[0];(S(n[0])||J(n[0]))&&(r=k(n[0],t.spatialReference));const a=N(n[1]),u=D(n[2]);if(L(r)){const l=await r.sumLength(a,u,t.abortSignal);if(t.abortSignal.aborted)throw new s(t,o.Cancelled,e);return l}if(r===null)return 0;if(!E(r))throw new s(t,o.InvalidParameter,e);return d("geodeticLength",[r.toJSON(),a,u])}))},i.functions.distance=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{n=w(n),h(n,2,3,t,e);let r=n[0];if((S(n[0])||J(n[0]))&&(r=Z(n[0],t.spatialReference)),!(r instanceof m))throw new s(t,o.InvalidParameter,e);let a=n[1];if((S(n[1])||J(n[1]))&&(a=Z(n[1],t.spatialReference)),!(a instanceof m))throw new s(t,o.InvalidParameter,e);return d("distance",[r.toJSON(),a.toJSON(),N(n[2])])}))},i.functions.distancegeodetic=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{n=w(n),h(n,2,4,t,e);const r=n[0];if(!(r instanceof R))throw new s(t,o.InvalidParameter,e);const a=n[1];if(!(a instanceof R))throw new s(t,o.InvalidParameter,e);const u=new j({paths:[],spatialReference:r.spatialReference});return u.addPath([r,a]),d("geodeticLength",[u.toJSON(),N(n[2]),D(n[3])])}))},i.functions.densify=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new s(t,o.InvalidParameter,e);if(r<=0)throw new s(t,o.InvalidParameter,e);switch(n[0].type){case"polygon":case"polyline":case"extent":return y(await d("densify",[n[0].toJSON(),r,N(n[2])]));default:return n[0]}}))},i.functions.densifygeodetic=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{n=w(n),h(n,2,4,t,e);const r=n[0];if(r==null)return null;if(!E(r))throw new s(t,o.InvalidParameter,e);const a=P(n[1]);if(isNaN(a))throw new s(t,o.InvalidParameter,e);if(a<=0)throw new s(t,o.InvalidParameter,e);const u=N(n[2]),l=D(n[3]);switch(r.type){case"polygon":case"polyline":case"extent":return y(await d("geodeticDensify",[r.toJSON(),a,u,l]));default:return r}}))},i.functions.generalize=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,4,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new s(t,o.InvalidParameter,e);const a=ln(T(n[2],!0));return y(await d("generalize",[n[0].toJSON(),r,N(n[3]),{removeDegenerateParts:a}]))}))},i.functions.buffer=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new s(t,o.InvalidParameter,e);return r===0?O(n[0]):y(await d("buffer",[n[0].toJSON(),r,N(n[2])]))}))},i.functions.buffergeodetic=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{n=w(n),h(n,2,4,t,e);const r=n[0];if(r==null)return null;if(!E(r))throw new s(t,o.InvalidParameter,e);const a=P(n[1]);if(isNaN(a))throw new s(t,o.InvalidParameter,e);if(a===0)return O(r);const u=N(n[2]),l=D(n[3]);return y(await d("geodesicBuffer",[r.toJSON(),a,u,l]))}))},i.functions.offset=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,6,t,e),n[0]===null)return null;if(!(n[0]instanceof b||n[0]instanceof j))throw new s(t,o.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new s(t,o.InvalidParameter,e);const a=rn(n[3]),u=P(T(n[4],10));if(isNaN(u))throw new s(t,o.InvalidParameter,e);const l=P(T(n[5],0));if(isNaN(l))throw new s(t,o.InvalidParameter,e);return y(await d("offset",[n[0].toJSON(),r,N(n[2]),{joins:a,miterLimit:u,flattenError:l}]))}))},i.functions.rotate=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{var l;if(n=w(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);const r=n[0]instanceof x?b.fromExtent(n[0]):n[0],a=P(n[1]);if(isNaN(a))throw new s(t,o.InvalidParameter,e);const u=T(n[2],null);if(u===null){const p=r.type==="point"?r:(l=r.extent)==null?void 0:l.center;return y(await d("rotate",[r.toJSON(),a,p==null?void 0:p.x,p==null?void 0:p.y]))}if(u instanceof R)return y(await d("rotate",[r.toJSON(),a,u.x,u.y]));throw new s(t,o.InvalidParameter,e)}))},i.functions.centroid=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,1,2,t,e),n[0]===null)return null;const r=an(n[1]);let a=n[0];if((S(n[0])||J(n[0]))&&(a=r==="geometric"?Z(n[0],t.spatialReference):M(n[0],t.spatialReference),a===null))return null;if(!(a instanceof m))throw new s(t,o.InvalidParameter,e);return y(r==="geometric"?await d("centroid",[a.toJSON()]):await d("labelPoint",[a.toJSON()]))}))},i.functions.measuretocoordinate=function(t,e){return i.standardFunctionAsync(t,e,sn)},i.functions.pointtocoordinate=function(t,e){return i.standardFunctionAsync(t,e,on)},i.functions.distancetocoordinate=function(t,e){return i.standardFunctionAsync(t,e,un)},i.functions.multiparttosinglepart=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);if(n[0]instanceof R)return[q(O(n[0]),t.spatialReference)];if(n[0]instanceof x)return[q(O(n[0]),t.spatialReference)];const r=y(await d("simplify",[n[0].toJSON()]));if(r instanceof b){const a=[],u=[];for(let l=0;l<r.rings.length;l++)if(r.isClockwise(r.rings[l])){const p=y({rings:[r.rings[l]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});a.push(p)}else u.push({ring:r.rings[l],pt:r.getPoint(l,0)});for(let l=0;l<u.length;l++)for(let p=0;p<a.length;p++)if(a[p].contains(u[l].pt)){a[p].addRing(u[l].ring);break}return a}if(r instanceof j){const a=[];for(let u=0;u<r.paths.length;u++){const l=y({paths:[r.paths[u]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});a.push(l)}return a}if(n[0]instanceof V){const a=[],u=q(O(n[0]),t.spatialReference);for(let l=0;l<u.points.length;l++)a.push(u.getPoint(l));return a}return null}))},i.functions.isselfintersecting=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{h(n,1,1,c,f);let r=(n=w(n))[0];if((S(n[0])||J(n[0]))&&(r=k(n[0],c.spatialReference)),r instanceof V){const a=r.points;for(let u=0;u<a.length;u++)for(let l=u+1;l<a.length;l++)if(tn(a[u],a[l]))return!0;return!1}return(r instanceof j||r instanceof b)&&await d("isSelfIntersecting",[r.toJSON()])}))},i.functions.issimple=function(t,e){return i.standardFunctionAsync(t,e,((c,f,n)=>{if(n=w(n),h(n,1,1,t,e),n[0]===null)return!0;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);return d("isSimple",[n[0].toJSON()])}))},i.functions.simplify=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);return y(await d("simplify",[n[0].toJSON()]))}))},i.functions.convexhull=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new s(t,o.InvalidParameter,e);return y(await d("convexHull",[n[0].toJSON()]))}))},i.functions.getuser=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{var l,p;h(n,0,2,t,e);let r=T(n[1],""),a=r===!0;if(r=r===!0||r===!1?"":X(r),n.length===0||n[0]instanceof B){let I;I=(l=t.services)!=null&&l.portal?t.services.portal:z.getDefault(),n.length>0&&(I=Y(n[0],I));const F=await G(I,r,a);if(F){const A=JSON.parse(JSON.stringify(F));for(const g of["lastLogin","created","modified"])A[g]!==void 0&&A[g]!==null&&(A[g]=new Date(A[g]));return C.convertObjectToArcadeDictionary(A,U(t))}return null}let u=null;if(L(n[0])&&(u=n[0]),u){if(a=!1,r)return null;await u.load();const I=await u.getOwningSystemUrl();if(!I){if(!r){const g=await u.getIdentityUser();return g?C.convertObjectToArcadeDictionary({username:g},U(t)):null}return null}let F;F=(p=t.services)!=null&&p.portal?t.services.portal:z.getDefault(),F=Y(new B(I),F);const A=await G(F,r,a);if(A){const g=JSON.parse(JSON.stringify(A));for(const _ of["lastLogin","created","modified"])g[_]!==void 0&&g[_]!==null&&(g[_]=new Date(g[_]));return C.convertObjectToArcadeDictionary(g,U(t))}return null}throw new s(t,o.InvalidParameter,e)}))},i.functions.nearestcoordinate=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,2,t,e),!(n[0]instanceof m||n[0]===null))throw new s(t,o.InvalidParameter,e);if(!(n[1]instanceof R||n[1]===null))throw new s(t,o.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof x?b.fromExtent(n[0]):n[0],a=await d("getNearestCoordinate",[r.toJSON(),n[1].toJSON(),{calculateLeftRightSide:!0}]);return a===null?null:C.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.isRightSide?"right":"left"},U(t),!1,!0)}))},i.functions.nearestvertex=function(t,e){return i.standardFunctionAsync(t,e,(async(c,f,n)=>{if(n=w(n),h(n,2,2,t,e),!(n[0]instanceof m||n[0]===null))throw new s(t,o.InvalidParameter,e);if(!(n[1]instanceof R||n[1]===null))throw new s(t,o.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof x?b.fromExtent(n[0]):n[0],a=await d("getNearestVertex",[r.toJSON(),n[1].toJSON()]);return a===null?null:C.convertObjectToArcadeDictionary({coordinate:y(a.coordinate),distance:a.distance,sideOfLine:a.distance===0?"straddle":a.isRightSide?"right":"left"},U(t),!1,!0)}))})}export{An as registerFunctions};
