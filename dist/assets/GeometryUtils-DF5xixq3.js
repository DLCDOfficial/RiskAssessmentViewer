import{g0 as z}from"./index-DzoQLc5A.js";const H=512,F=29,G=24,O=4;var L;(function(_){_[_.FilterFlags=0]="FilterFlags",_[_.Animation=1]="Animation",_[_.GPGPU=2]="GPGPU",_[_.VV=3]="VV",_[_.DD0=4]="DD0",_[_.DD1=5]="DD1",_[_.DD2=6]="DD2",_[_.LocalTimeOrigin=7]="LocalTimeOrigin"})(L||(L={}));const U=6,C=1.05,j=4,J=1,K=10,W=256,Y=32,Q=512,S=512;var P,f;(function(_){_[_.Unknown=0]="Unknown",_[_.Point=1]="Point",_[_.LineString=2]="LineString",_[_.Polygon=3]="Polygon"})(P||(P={}));let g=class v{constructor(t,s){this.x=t,this.y=s}static fromArray(t){return new v(t[0],t[1])}clone(){return new v(this.x,this.y)}equals(t,s){return t===this.x&&s===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,s){return this.x=t,this.y=s,this}normalize(){const t=this.x,s=this.y,i=Math.sqrt(t*t+s*s);return this.x/=i,this.y/=i,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,s){return this.x+=t,this.y+=s,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this}assignSub(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this}rotate(t,s){const i=this.x,h=this.y;return this.x=i*t-h*s,this.y=i*s+h*t,this}rotateReverse(t,s){const i=this.x,h=this.y;return this.x=i*t+h*s,this.y=-i*s+h*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,s=this.y;return Math.sqrt(t*t+s*s)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,s){const i=s.x-t.x,h=s.y-t.y;return Math.sqrt(i*i+h*h)}static add(t,s){return new v(t.x+s.x,t.y+s.y)}static sub(t,s){return new v(t.x-s.x,t.y-s.y)}};class I{constructor(t,s,i){this.ratio=t,this.x=s,this.y=i}}let X=class{constructor(t,s,i,h=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=h,this._pixelMargin=n,this._tileSize=S*h,this._dz=t,this._yPos=s,this._xPos=i}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let s=this._pixelRatio*this._pixelMargin;s/=this._finalRatio;const i=t>>this._dz;s>i&&(s=i),this._margin=s,this._xmin=i*this._xPos-s,this._ymin=i*this._yPos-s,this._xmax=this._xmin+i+2*s,this._ymax=this._ymin+i+2*s}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,s){this._pushLine(),this._prevIsIn=this._isIn(t,s),this._moveTo(t,s,this._prevIsIn),this._prevPt=new g(t,s),this._firstPt=new g(t,s),this._dist=0}lineTo(t,s){const i=this._isIn(t,s),h=new g(t,s),n=g.distance(this._prevPt,h);let e,r,l,a,d,m,y,p;if(i)this._prevIsIn?this._lineTo(t,s,!0):(e=this._prevPt,r=h,l=this._intersect(r,e),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(r.x,r.y,!0));else if(this._prevIsIn)r=this._prevPt,e=h,l=this._intersect(r,e),this._lineTo(l.x,l.y,!0),this._lineTo(e.x,e.y,!1);else{const x=this._prevPt,o=h;if(x.x<=this._xmin&&o.x<=this._xmin||x.x>=this._xmax&&o.x>=this._xmax||x.y<=this._ymin&&o.y<=this._ymin||x.y>=this._ymax&&o.y>=this._ymax)this._lineTo(o.x,o.y,!1);else{const c=[];if((x.x<this._xmin&&o.x>this._xmin||x.x>this._xmin&&o.x<this._xmin)&&(a=(this._xmin-x.x)/(o.x-x.x),p=x.y+a*(o.y-x.y),p<=this._ymin?m=!1:p>=this._ymax?m=!0:c.push(new I(a,this._xmin,p))),(x.x<this._xmax&&o.x>this._xmax||x.x>this._xmax&&o.x<this._xmax)&&(a=(this._xmax-x.x)/(o.x-x.x),p=x.y+a*(o.y-x.y),p<=this._ymin?m=!1:p>=this._ymax?m=!0:c.push(new I(a,this._xmax,p))),(x.y<this._ymin&&o.y>this._ymin||x.y>this._ymin&&o.y<this._ymin)&&(a=(this._ymin-x.y)/(o.y-x.y),y=x.x+a*(o.x-x.x),y<=this._xmin?d=!1:y>=this._xmax?d=!0:c.push(new I(a,y,this._ymin))),(x.y<this._ymax&&o.y>this._ymax||x.y>this._ymax&&o.y<this._ymax)&&(a=(this._ymax-x.y)/(o.y-x.y),y=x.x+a*(o.x-x.x),y<=this._xmin?d=!1:y>=this._xmax?d=!0:c.push(new I(a,y,this._ymax))),c.length===0)d?m?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):m?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(c.length>1&&c[0].ratio>c[1].ratio)this._start=this._dist+n*c[1].ratio,this._lineTo(c[1].x,c[1].y,!0),this._lineTo(c[0].x,c[0].y,!0);else{this._start=this._dist+n*c[0].ratio;for(let u=0;u<c.length;u++)this._lineTo(c[u].x,c[u].y,!0)}this._lineTo(o.x,o.y,!1)}}this._dist+=n,this._prevIsIn=i,this._prevPt=h}close(){if(this._line.length>2){const t=this._firstPt,s=this._prevPt;t.x===s.x&&t.y===s.y||this.lineTo(t.x,t.y);const i=this._line;let h=i.length;for(;h>=4&&(i[0].x===i[1].x&&i[0].x===i[h-2].x||i[0].y===i[1].y&&i[0].y===i[h-2].y);)i.pop(),i[0].x=i[h-2].x,i[0].y=i[h-2].y,--h}}result(t=!0){return this._pushLine(),this._lines.length===0?null:(this._type===P.Polygon&&t&&V.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==P.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,s=t.length;if(s===0)return null;const i=[];for(let h=0;h<s;h++)i.push({line:t[h],start:this._starts[h]||0});return i}_isIn(t,s){return t>=this._xmin&&t<=this._xmax&&s>=this._ymin&&s<=this._ymax}_intersect(t,s){let i,h,n;if(s.x>=this._xmin&&s.x<=this._xmax)h=s.y<=this._ymin?this._ymin:this._ymax,n=(h-t.y)/(s.y-t.y),i=t.x+n*(s.x-t.x);else if(s.y>=this._ymin&&s.y<=this._ymax)i=s.x<=this._xmin?this._xmin:this._xmax,n=(i-t.x)/(s.x-t.x),h=t.y+n*(s.y-t.y);else{h=s.y<=this._ymin?this._ymin:this._ymax,i=s.x<=this._xmin?this._xmin:this._xmax;const e=(i-t.x)/(s.x-t.x),r=(h-t.y)/(s.y-t.y);e<r?(n=e,h=t.y+e*(s.y-t.y)):(n=r,i=t.x+r*(s.x-t.x))}return this._r=n,new g(i,h)}_pushLine(){this._line&&(this._type===P.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===P.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===P.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,s,i){this._type!==P.Polygon?i&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(t,s))):(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(t,s)),this._isH=!1,this._isV=!1)}_lineTo(t,s,i){let h,n;if(this._type!==P.Polygon)if(i){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(h=this._line[this._line.length-1],h.equals(t,s)))return;this._line.push(new g(t,s))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){h=this._line[this._line.length-1];const e=h.x===t,r=h.y===s;if(e&&r)return;this._isH&&e||this._isV&&r?(h.x=t,h.y=s,n=this._line[this._line.length-2],n.x===t&&n.y===s?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===t,this._isV=n.y===s)):(this._isH=n.x===t,this._isV=n.y===s)):(this._line.push(new g(t,s)),this._isH=e,this._isV=r)}else this._line.push(new g(t,s))}};class tt{setExtent(t){this._ratio=t===4096?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,s){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new g(t*i,s*i))}lineTo(t,s){const i=this._ratio;this._line.push(new g(t*i,s*i))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}}(function(_){_[_.sideLeft=0]="sideLeft",_[_.sideRight=1]="sideRight",_[_.sideTop=2]="sideTop",_[_.sideBottom=3]="sideBottom"})(f||(f={}));let V=class T{static simplify(t,s,i){if(!i)return;const h=-s,n=t+s,e=-s,r=t+s,l=[],a=[],d=i.length;for(let y=0;y<d;++y){const p=i[y];if(!p||p.length<2)continue;let x,o=p[0];const c=p.length;for(let u=1;u<c;++u)x=p[u],o.x===x.x&&(o.x<=h&&(o.y>x.y?(l.push(y),l.push(u),l.push(f.sideLeft),l.push(-1)):(a.push(y),a.push(u),a.push(f.sideLeft),a.push(-1))),o.x>=n&&(o.y<x.y?(l.push(y),l.push(u),l.push(f.sideRight),l.push(-1)):(a.push(y),a.push(u),a.push(f.sideRight),a.push(-1)))),o.y===x.y&&(o.y<=e&&(o.x<x.x?(l.push(y),l.push(u),l.push(f.sideTop),l.push(-1)):(a.push(y),a.push(u),a.push(f.sideTop),a.push(-1))),o.y>=r&&(o.x>x.x?(l.push(y),l.push(u),l.push(f.sideBottom),l.push(-1)):(a.push(y),a.push(u),a.push(f.sideBottom),a.push(-1)))),o=x}if(l.length===0||a.length===0)return;T.fillParent(i,a,l),T.fillParent(i,l,a);const m=[];T.calcDeltas(m,a,l),T.calcDeltas(m,l,a),T.addDeltas(m,i)}static fillParent(t,s,i){const h=i.length,n=s.length;for(let e=0;e<n;e+=4){const r=s[e],l=s[e+1],a=s[e+2],d=t[r][l-1],m=t[r][l];let y=8092,p=-1;for(let x=0;x<h;x+=4){if(i[x+2]!==a)continue;const o=i[x],c=i[x+1],u=t[o][c-1],w=t[o][c];switch(a){case f.sideLeft:case f.sideRight:if(R(d.y,u.y,w.y)&&R(m.y,u.y,w.y)){const M=Math.abs(w.y-u.y);M<y&&(y=M,p=x)}break;case f.sideTop:case f.sideBottom:if(R(d.x,u.x,w.x)&&R(m.x,u.x,w.x)){const M=Math.abs(w.x-u.x);M<y&&(y=M,p=x)}}}s[e+3]=p}}static calcDeltas(t,s,i){const h=s.length;for(let n=0;n<h;n+=4){const e=[],r=T.calcDelta(n,s,i,e);t.push(s[n]),t.push(s[n+1]),t.push(s[n+2]),t.push(r)}}static calcDelta(t,s,i,h){const n=s[t+3];if(n===-1)return 0;const e=h.length;return e>1&&h[e-2]===n?0:(h.push(n),T.calcDelta(n,i,s,h)+1)}static addDeltas(t,s){const i=t.length;let h=0;for(let n=0;n<i;n+=4){const e=t[n+3];e>h&&(h=e)}for(let n=0;n<i;n+=4){const e=s[t[n]],r=t[n+1],l=h-t[n+3];switch(t[n+2]){case f.sideLeft:e[r-1].x-=l,e[r].x-=l,r===1&&(e[e.length-1].x-=l),r===e.length-1&&(e[0].x-=l);break;case f.sideRight:e[r-1].x+=l,e[r].x+=l,r===1&&(e[e.length-1].x+=l),r===e.length-1&&(e[0].x+=l);break;case f.sideTop:e[r-1].y-=l,e[r].y-=l,r===1&&(e[e.length-1].y-=l),r===e.length-1&&(e[0].y-=l);break;case f.sideBottom:e[r-1].y+=l,e[r].y+=l,r===1&&(e[e.length-1].y+=l),r===e.length-1&&(e[0].y+=l)}}}};const R=(_,t,s)=>_>=t&&_<=s||_>=s&&_<=t,st=Number.POSITIVE_INFINITY,D=Math.PI,it=2*D,$=128/D,B=256/360,ht=D/180,N=1/Math.LN2;function b(_,t){return(_%=t)>=0?_:_+t}function et(_){return b(_*$,256)}function nt(_){return b(_*B,256)}function _t(_){return Math.log(_)*N}function lt(_,t,s){return _*(1-s)+t*s}const k=8,q=14,A=16;function rt(_){return k+Math.max((_-q)*A,0)}function at(_,t,s){let i,h,n,e=0;for(const r of s){i=r.length;for(let l=1;l<i;++l)h=r[l-1],n=r[l],h.y>t!=n.y>t&&((n.x-h.x)*(t-h.y)-(n.y-h.y)*(_-h.x)>0?e++:e--)}return e!==0}function xt(_,t,s,i){let h,n,e,r;const l=i*i;for(const a of s){const d=a.length;if(!(d<2)){h=a[0].x,n=a[0].y;for(let m=1;m<d;++m){if(e=a[m].x,r=a[m].y,z(_,t,h,n,e,r)<l)return!0;h=e,n=r}}}return!1}function ot(_,t){if(t===0||Number.isNaN(t))return _;const s=[],i=new g(0,0),h=new g(0,0),n=new g(0,0);for(let e=0;e<_.length;e++){const r=_[e],l=[];for(let a=0;a<r.length;a++){const d=r[a-1],m=r[a],y=r[a+1];a===0?i.setCoords(0,0):i.assignSub(m,d).normalize().rightPerpendicular(),a===r.length-1?h.setCoords(0,0):h.assignSub(y,m).normalize().rightPerpendicular(),n.assignAdd(i,h).normalize();const p=n.x*h.x+n.y*h.y;p!==0&&n.scale(1/p),l.push(g.add(m,n.scale(t)))}s.push(l)}return s}function yt(_,t,s,i){const h=new g(_[0],_[1]);if(h.scale(i),t==="viewport"){const n=-s*(Math.PI/180),e=Math.cos(n),r=Math.sin(n);h.rotate(e,r)}return h}export{G as A,Q as B,F as G,at as I,L as J,U as K,O as L,xt as N,ot as P,C as R,tt as _,b as a,yt as b,_t as c,rt as d,it as e,et as f,X as g,g as h,P as i,H as j,K as k,nt as l,J as m,D as o,lt as p,st as r,ht as s,j as t,W as y,Y as z};
