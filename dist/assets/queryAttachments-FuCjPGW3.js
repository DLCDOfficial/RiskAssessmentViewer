import{w as I,B as a,F as s,fB as f,J as b,v as m,gf as g,gg as j}from"./index-DzoQLc5A.js";import{t as x}from"./query-BkjTHcYa.js";import"https://js.arcgis.com/map-components/4.33/arcgis-map-components.esm.js";import"./normalizeUtils-PTTPU64I.js";import"./normalizeUtilsCommon-C_a4i1bY.js";import"./utils-DDykF6ND.js";import"./utils-BRuFmAg3.js";import"./pbfQueryUtils-Dt3eDkdS.js";import"./pbf-B-Qb_RCl.js";import"./memoryEstimations-Cau39Oyv.js";import"./OptimizedFeature-DdLiUxBt.js";import"./OptimizedFeatureSet-BR8EEvDc.js";function v(e){const{exifInfo:t,exifName:o,tagName:r}=e;if(!t||!o||!r)return null;const n=t.find((l=>l.name===o));return n?O({tagName:r,tags:n.tags}):null}function O(e){const{tagName:t,tags:o}=e;if(!o||!t)return null;const r=o.find((n=>n.name===t));return(r==null?void 0:r.value)||null}var c;const w={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let i=c=class extends I{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=v({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return w[t]||null}clone(){return new c({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};a([s({type:String})],i.prototype,"contentType",void 0),a([s()],i.prototype,"exifInfo",void 0),a([s({readOnly:!0})],i.prototype,"orientationInfo",null),a([s({type:f})],i.prototype,"id",void 0),a([s({type:String})],i.prototype,"globalId",void 0),a([s({type:String})],i.prototype,"keywords",void 0),a([s({type:String})],i.prototype,"name",void 0),a([s({json:{read:!1}})],i.prototype,"parentGlobalId",void 0),a([s({json:{read:!1}})],i.prototype,"parentObjectId",void 0),a([s({type:f})],i.prototype,"size",void 0),a([s({json:{read:!1}})],i.prototype,"url",void 0),i=c=a([b("esri.rest.query.support.AttachmentInfo")],i);function $(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),t}function D(e,t){const o={};for(const r of t){const{parentObjectId:n,parentGlobalId:l,attachmentInfos:p}=r;for(const d of p){const{id:y}=d,h=g(j(`${e.path}/${n}/attachments/${y}`)),u=i.fromJSON(d);u.set({url:h,parentObjectId:n,parentGlobalId:l}),o[n]?o[n].push(u):o[n]=[u]}}return o}function E(e,t,o){let r={query:x({...e.query,f:"json",...$(t)})};return o&&(r={...o,...r,query:{...o.query,...r.query}}),m(e.path+"/queryAttachments",r).then((n=>n.data.attachmentGroups))}async function H(e,t,o){const{objectIds:r}=t,n=[];for(const l of r)n.push(m(e.path+"/"+l+"/attachments",o));return Promise.all(n).then((l=>r.map(((p,d)=>({parentObjectId:p,attachmentInfos:l[d].data.attachmentInfos})))))}export{E as executeAttachmentQuery,H as fetchAttachments,D as processAttachmentQueryResult};
