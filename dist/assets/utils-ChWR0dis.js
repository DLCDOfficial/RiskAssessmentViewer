const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-BtPl_kdD.js","./index-DzoQLc5A.js","./index-FMl8DCyv.css"])))=>i.map(i=>d[i]);
import{bs as i,gh as M,gi as d,gj as I,gk as g,gl as L,b6 as P,e1 as y,gm as p,gn as z,go as E,gp as $,_ as j}from"./index-DzoQLc5A.js";function _(o){const r=[];return h(M(o),r),r.length?new i(L(r[0])):null}function h(o,r){var t;if(!o)return;let n;n=o.type==="CIMTextSymbol"?o.symbol:o;const l=o.type==="CIMPolygonSymbol";if(n!=null&&n.symbolLayers){for(const a of n.symbolLayers)if(!(a.colorLocked||l&&(d(a)||I(a)&&a.markerPlacement&&g(a.markerPlacement))))switch(a.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":a.tintColor&&m(r,a.tintColor);break;case"CIMVectorMarker":(t=a.markerGraphics)==null||t.forEach((e=>{h(e.symbol,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":m(r,a.color);break;case"CIMGradientFill":x(r,a);break;case"CIMHatchFill":h(a.lineSymbol,r)}}}function m(o,r){for(const n of o)if(n.join(".")===r.join("."))return;o.push(r)}function x(o,r){var l,t;switch((l=r.colorRamp)==null?void 0:l.type){case"CIMMultipartColorRamp":(t=r.colorRamp.colorRamps)==null||t.forEach((a=>{a.type==="CIMLinearContinuousColorRamp"&&k(o,a)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":k(o,r.colorRamp)}}function k(o,r){r&&(r.fromColor&&m(o,r.fromColor),r.toColor&&m(o,r.toColor))}function B(o,r,n){r instanceof i||(r=new i(r));const l=M(o);l&&C(l,r)}function C(o,r,n){var a;if(!o)return;let l;l=o.type==="CIMTextSymbol"?o.symbol:o;const t=(l==null?void 0:l.type)==="CIMPolygonSymbol";if(l!=null&&l.symbolLayers)for(const e of l.symbolLayers){if(e.colorLocked||t&&(d(e)||I(e)&&e.markerPlacement&&g(e.markerPlacement)))continue;const s=r.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=s;break;case"CIMVectorMarker":(a=e.markerGraphics)==null||a.forEach((c=>{C(c.symbol,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=s;break;case"CIMGradientFill":F(e,r);break;case"CIMHatchFill":C(e.lineSymbol,r)}}}function F(o,r){var l,t;switch((l=o.colorRamp)==null?void 0:l.type){case"CIMMultipartColorRamp":(t=o.colorRamp.colorRamps)==null||t.forEach((a=>{a.type==="CIMLinearContinuousColorRamp"&&w(a,r)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":w(o.colorRamp,r)}}function w(o,r){if(o&&(o.fromColor&&(o.fromColor=r.toArray()),o.toColor)){const n=r.clone();n.a=0,o.toColor=n.toArray()}}new P(1e3);new i([128,128,128]);new i("white");function K(o,r){if(!o)return null;let n=null;return y(o)?n=v(o):p(o)&&(n=o.type==="cim"?_(o):o.color?new i(o.color):null),n?b(n,r):null}function v(o){const r=o.symbolLayers;if(!r)return null;let n=null;return r.forEach((l=>{var t;l.type==="object"&&((t=l.resource)!=null&&t.href)||(n=l.type==="water"?l.color:l.material?l.material.color:null)})),n?new i(n):null}function b(o,r){if(r==null||o==null)return o;const n=o.toRgba();return n[3]=n[3]*r,new i(n)}function A(o,r,n){const l=o.symbolLayers;if(!l)return;const t=a=>b(r??a??null,n);l.forEach((a=>{var e;if(a.type!=="object"||!((e=a.resource)!=null&&e.href)||r)if(a.type==="water")a.color=t(a.color);else{const s=a.material!=null?a.material.color:null,c=t(s);if(a.material==null?a.material=new z({color:c}):a.material.color=c,"marker"in a&&a.marker!=null){const f=t(a.marker.color);a.marker.color=f}}}))}function G(o,r,n){(r=r??o.color)&&(o.color=b(r,n))}function Q(o,r,n){o&&(r||n!=null)&&(r&&(r=new i(r)),y(o)?A(o,r,n):p(o)&&G(o,r,n))}async function O(o,r){const n=o.symbolLayers;n&&await E(n,(async l=>T(l,r)))}async function T(o,r){switch(o.type){case"extrude":D(o,r);break;case"icon":case"line":case"text":V(o,r);break;case"path":J(o,r);break;case"object":await H(o,r)}}function V(o,r){const n=S(r);n!=null&&(o.size=n)}function S(o){for(const r of o)if(typeof r=="number")return r;return null}function D(o,r){const n=r[2];typeof n=="number"&&(o.size=n)}async function H(o,r){const{resourceSize:n,symbolSize:l}=await N(o),t=R(r,n,l);t!=null&&(o.width=u(r[0],l[0],n[0],t),o.depth=u(r[1],l[1],n[1],t),o.height=u(r[2],l[2],n[2],t))}function J(o,r){const n=R(r,$,[o.width,void 0,o.height]);n!=null&&(o.width=u(r[0],o.width,1,n),o.height=u(r[2],o.height,1,n))}function R(o,r,n){for(let l=0;l<3;l++){const t=o[l];switch(t){case"symbol-value":{const a=n[l];return a!=null?a/r[l]:1}case"proportional":break;default:if(t&&r[l])return t/r[l]}}return null}async function N(o){const{computeObjectLayerResourceSize:r}=await j(()=>import("./symbolLayerUtils-BtPl_kdD.js"),__vite__mapDeps([0,1,2]),import.meta.url),n=await r(o,10),{width:l,height:t,depth:a}=o,e=[l,a,t];let s=1;for(let c=0;c<3;c++){const f=e[c];if(f!=null){s=f/n[c];break}}for(let c=0;c<3;c++)e[c]==null&&(e[c]=n[c]*s);return{resourceSize:n,symbolSize:e}}function u(o,r,n,l){switch(o){case"proportional":return n*l;case"symbol-value":return r??n;default:return o}}function U(o,r){const n=S(r);if(n!=null)switch(o.type){case"simple-marker":o.size=n;break;case"picture-marker":{const l=o.width/o.height;l>1?(o.width=n,o.height=n*l):(o.width=n*l,o.height=n);break}case"simple-line":o.width=n;break;case"text":o.font.size=n}}async function W(o,r){if(o&&r)return y(o)?O(o,r):void(p(o)&&U(o,r))}function X(o,r,n){if(o&&r!=null)if(y(o)){const l=o.symbolLayers;l&&l.forEach((t=>{if(t.type==="object")switch(n){case"tilt":t.tilt=(t.tilt??0)+r;break;case"roll":t.roll=(t.roll??0)+r;break;default:t.heading=(t.heading??0)+r}t.type==="icon"&&(t.angle+=r)}))}else p(o)&&(o.type!=="simple-marker"&&o.type!=="picture-marker"&&o.type!=="text"||(o.angle+=r))}export{Q as L,W as M,X as N,B as k,K as w};
