import{l as C}from"./ClassBreaksDefinition-C0HjICjI.js";import{j as w}from"./index-DzoQLc5A.js";const E=()=>w.getLogger("esri.rest.support.generateRendererUtils");function x(n,t){return Number(n.toFixed(t))}function B(n,t){const{normalizationTotal:e}=n;return{classBreaks:O(n,t),normalizationTotal:e}}function O(n,t){const e=n.definition,{classificationMethod:a,normalizationType:l,definedInterval:m}=e,s=e.breakCount??1,i=[];let o=n.values;if(o.length===0)return[];o=o.sort(((c,r)=>c-r));const[h,d]=t??[o.at(0),o.at(-1)];if(a==="equal-interval")if(o.length>=s){const c=(d-h)/s;let r=h;for(let u=1;u<s;u++){const f=x(h+u*c,6);i.push({minValue:r,maxValue:f,label:v(r,f,l)}),r=f}i.push({minValue:r,maxValue:d,label:v(r,d,l)})}else o.forEach((c=>{i.push({minValue:c,maxValue:c,label:v(c,c,l)})}));else if(a==="natural-breaks"){const c=U(o),r=n.valueFrequency||c.valueFrequency,u=P(c.uniqueValues,r,s);let f=h;for(let p=1;p<s;p++)if(c.uniqueValues.length>p){const b=x(c.uniqueValues[u[p]],6);i.push({minValue:f,maxValue:b,label:v(f,b,l)}),f=b}i.push({minValue:f,maxValue:d,label:v(f,d,l)})}else if(a==="quantile")if(o.length>=s&&h!==d){let c=h,r=Math.ceil(o.length/s),u=0;for(let f=1;f<s;f++){let p=r+u-1;p>o.length&&(p=o.length-1),p<0&&(p=0),i.push({minValue:c,maxValue:o[p],label:v(c,o[p],l)}),c=o[p],u+=r,r=Math.ceil((o.length-u)/(s-f))}i.push({minValue:c,maxValue:d,label:v(c,d,l)})}else{let c=-1;for(let r=0;r<o.length;r++){const u=o[r];u!==c&&(c=u,i.push({minValue:c,maxValue:u,label:v(c,u,l)}),c=u)}}else if(a==="standard-deviation"){const c=A(o),r=_(o,c);if(r===0)i.push({minValue:o[0],maxValue:o[0],label:v(o[0],o[0],l)});else{const u=G(h,d,s,c,r)*r;let f=0,p=h;for(let V=s;V>=1;V--){const g=x(c-(V-.5)*u,6);i.push({minValue:p,maxValue:g,label:v(p,g,l)}),p=g,f++}let b=x(c+.5*u,6);i.push({minValue:p,maxValue:b,label:v(p,b,l)}),p=b,f++;for(let V=1;V<=s;V++)b=f===2*s?d:x(c+(V+.5)*u,6),i.push({minValue:p,maxValue:b,label:v(p,b,l)}),p=b,f++}}else if(a==="defined-interval"){if(!m)return i;const[c,r]=t??[o.at(0),o.at(-1)],u=Math.ceil((r-c)/m);let f=c;for(let p=1;p<u;p++){const b=x(c+p*m,6);i.push({minValue:f,maxValue:b,label:v(f,b,l)}),f=b}i.push({minValue:f,maxValue:r,label:v(f,r,l)})}return i}function v(n,t,e){let a=null;return a=n===t?e&&e==="percent-of-total"?n+"%":n.toString():e&&e==="percent-of-total"?n+"% - "+t+"%":n+" - "+t,a}function U(n){const t=[],e=[];let a=Number.MIN_VALUE,l=1,m=-1;for(let s=0;s<n.length;s++){const i=n[s];i===a?(l++,e[m]=l):i!==null&&(t.push(i),a=i,l=1,e.push(l),m++)}return{uniqueValues:t,valueFrequency:e}}function P(n,t,e){const a=n.length,l=[];e>a&&(e=a);for(let s=0;s<e;s++)l.push(Math.round(s*a/e-1));l.push(a-1);let m=D(l,n,t,e);return L(m.mean,m.sdcm,l,n,t,e)&&(m=D(l,n,t,e)),l}function D(n,t,e,a){let l=[],m=[],s=[],i=0;const o=[],h=[];for(let u=0;u<a;u++){const f=T(u,n,t,e);o.push(f.sbMean),h.push(f.sbSdcm),i+=h[u]}let d,c=i,r=!0;for(;r||i<c;){r=!1,l=[];for(let u=0;u<a;u++)l.push(n[u]);for(let u=0;u<a;u++)for(let f=n[u]+1;f<=n[u+1];f++)if(d=t[f],u>0&&f!==n[u+1]&&Math.abs(d-o[u])>Math.abs(d-o[u-1]))n[u]=f;else if(u<a-1&&n[u]!==f-1&&Math.abs(d-o[u])>Math.abs(d-o[u+1])){n[u+1]=f-1;break}c=i,i=0,m=[],s=[];for(let u=0;u<a;u++){m.push(o[u]),s.push(h[u]);const f=T(u,n,t,e);o[u]=f.sbMean,h[u]=f.sbSdcm,i+=h[u]}}if(i>c){for(let u=0;u<a;u++)n[u]=l[u],o[u]=m[u],h[u]=s[u];i=c}return{mean:o,sdcm:h}}function L(n,t,e,a,l,m){let s=0,i=0,o=0,h=0,d=!0;for(let c=0;c<2&&d;c++){c===0&&(d=!1);for(let r=0;r<m-1;r++)for(;e[r+1]+1!==e[r+2];){e[r+1]=e[r+1]+1;const u=T(r,e,a,l);o=u.sbMean,s=u.sbSdcm;const f=T(r+1,e,a,l);if(h=f.sbMean,i=f.sbSdcm,!(s+i<t[r]+t[r+1])){e[r+1]=e[r+1]-1;break}t[r]=s,t[r+1]=i,n[r]=o,n[r+1]=h,d=!0}for(let r=m-1;r>0;r--)for(;e[r]!==e[r-1]+1;){e[r]=e[r]-1;const u=T(r-1,e,a,l);o=u.sbMean,s=u.sbSdcm;const f=T(r,e,a,l);if(h=f.sbMean,i=f.sbSdcm,!(s+i<t[r-1]+t[r])){e[r]=e[r]+1;break}t[r-1]=s,t[r]=i,n[r-1]=o,n[r]=h,d=!0}}return d}function G(n,t,e,a,l){let m=Math.max(a-n,t-a)/l/e;return m=m>=1?1:m>=.5?.5:.25,m}function A(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t/=n.length,t}function _(n,t){let e=0;for(let a=0;a<n.length;a++){const l=n[a];e+=(l-t)*(l-t)}return e/=n.length,Math.sqrt(e)}function T(n,t,e,a){let l=0,m=0;for(let o=t[n]+1;o<=t[n+1];o++){const h=a[o];l+=e[o]*h,m+=h}m<=0&&E().warn("Exception in Natural Breaks calculation");const s=l/m;let i=0;for(let o=t[n]+1;o<=t[n+1];o++)i+=a[o]*(e[o]-s)**2;return{sbMean:s,sbSdcm:i}}const j="<Null>",Y="equal-interval",Q=1,R=5,H=10,J=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,K=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),W=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),X=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function y(n){return n==null||typeof n=="string"&&!n?j:n}function Z(n){const t=n.normalizationField!=null||n.normalizationType!=null,e=n.minValue!=null||n.maxValue!=null,a=!!n.sqlExpression&&n.supportsSQLExpression;return!t&&!e&&!a}function gn(n){var s,i;const{outStatisticTypes:t}=n,e=n.returnDistinct?[...new Set(n.values)]:n.values,a=e.filter((o=>o!=null)).sort(),l=a.length,m={count:l,min:a[0],max:a[l-1]};return n.supportsNullCount&&(m.nullcount=e.length-l),!n.percentileParams||(s=t==null?void 0:t.include)!=null&&s.length&&!t.include.includes("median")||(i=t==null?void 0:t.exclude)!=null&&i.length&&t.exclude.includes("median")||(m.median=k(e,n.percentileParams)),m}function nn(n){var p,b;const{values:t,useSampleStdDev:e,supportsNullCount:a,outStatisticTypes:l}=n;let m=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=null,o=null,h=null,d=null,c=0;const r=n.minValue==null?-1/0:n.minValue,u=n.maxValue==null?1/0:n.maxValue;for(const V of t)Number.isFinite(V)?V>=r&&V<=u&&(i=i===null?V:i+V,m=Math.min(m,V),s=Math.max(s,V),c++):typeof V=="string"&&c++;if(c&&i!=null){o=i/c;let V=0;for(const g of t)Number.isFinite(g)&&g>=r&&g<=u&&(V+=(g-o)**2);d=e?c>1?V/(c-1):0:c>0?V/c:0,h=Math.sqrt(d)}else m=null,s=null;const f={avg:o,count:c,max:s,min:m,stddev:h,sum:i,variance:d};return a&&(f.nullcount=t.length-c),!n.percentileParams||(p=l==null?void 0:l.include)!=null&&p.length&&!l.include.includes("median")||(b=l==null?void 0:l.exclude)!=null&&b.length&&l.exclude.includes("median")||(f.median=k(t,n.percentileParams)),f}function k(n,t){const{fieldType:e,value:a,orderBy:l,isDiscrete:m}=t,s=tn(e,l==="desc");if((n=[...n].filter((u=>u!=null)).sort(((u,f)=>s(u,f)))).length===0)return null;if(a<=0)return n[0];if(a>=1)return n[n.length-1];const i=(n.length-1)*a,o=Math.floor(i),h=o+1,d=i%1,c=n[o],r=n[h];return h>=n.length||m||typeof c=="string"||typeof r=="string"?c:c*(1-d)+r*d}function tn(n,t){if(n){if(K.has(n))return $(t);if(W.has(n))return I(t,!1);if(n==="esriFieldTypeTimestampOffset")return an(t);const s=I(t,!0);if(n==="esriFieldTypeString")return s;if(n==="esriFieldTypeGUID"||n==="esriFieldTypeGlobalID")return(i,o)=>s(N(i),N(o))}const e=t?1:-1,a=$(t),l=I(t,!0),m=q(t);return(s,i)=>typeof s=="number"&&typeof i=="number"?a(s,i):typeof s=="string"&&typeof i=="string"?l(s,i):m(s,i)??e}const F=(n,t)=>n==null?t==null?0:1:t==null?-1:null,M=(n,t)=>n==null?t==null?0:-1:t==null?1:null;function q(n){return n?F:M}const en=(n,t)=>M(n,t)??(n===t?0:new Date(n).getTime()-new Date(t).getTime()),ln=(n,t)=>F(n,t)??(n===t?0:new Date(t).getTime()-new Date(n).getTime());function an(n){return n?ln:en}const un=(n,t)=>M(n,t)??(n===t?0:n<t?-1:1),on=(n,t)=>F(n,t)??(n===t?0:n<t?1:-1);function I(n,t){if(!t)return n?on:un;const e=q(n);return n?(a,l)=>{const m=e(a,l);return m??((a=a.toUpperCase())>(l=l.toUpperCase())?-1:a<l?1:0)}:(a,l)=>{const m=e(a,l);return m??((a=a.toUpperCase())<(l=l.toUpperCase())?-1:a>l?1:0)}}const rn=(n,t)=>F(n,t)??t-n,sn=(n,t)=>M(n,t)??n-t;function $(n){return n?rn:sn}function N(n){return n.slice(24,36)+n.slice(19,23)+n.slice(16,18)+n.slice(14,16)+n.slice(11,13)+n.slice(9,11)+n.slice(6,8)+n.slice(4,6)+n.slice(2,4)+n.slice(0,2)}function vn(n,t,e){var l,m;let a;for(a in n)(l=t==null?void 0:t.include)!=null&&l.length&&!t.include.includes(a)||(m=t==null?void 0:t.exclude)!=null&&m.length&&t.exclude.includes(a)?delete n[a]:X.includes(a)&&(Number.isFinite(n[a])||(n[a]=null));return e&&["avg","stddev","variance"].forEach((s=>{n[s]!=null&&(n[s]=Math.ceil(n[s]??0))})),n}function xn(n){const t={};for(let e of n)(e==null||typeof e=="string"&&e.trim()==="")&&(e=null),t[e]==null?t[e]={count:1,data:e}:t[e].count++;return{count:t}}function z(n){return(n==null?void 0:n.type)!=="coded-value"?[]:n.codedValues.map((t=>t.code))}function Tn(n,t,e,a){const l=n.count,m=[];if(e&&t){const s=[],i=z(t[0]);for(const o of i)if(t[1]){const h=z(t[1]);for(const d of h)if(t[2]){const c=z(t[2]);for(const r of c)s.push(`${y(o)}${a}${y(d)}${a}${y(r)}`)}else s.push(`${y(o)}${a}${y(d)}`)}else s.push(o);for(const o of s)l.hasOwnProperty(o)||(l[o]={data:o,count:0})}for(const s in l){const i=l[s];m.push({value:i.data,count:i.count,label:i.label})}return{uniqueValueInfos:m}}function yn(n,t,e,a){let l=null;switch(t){case"log":n!==0&&(l=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(a)&&a!==0&&(l=n/a*100);break;case"field":Number.isFinite(e)&&e!==0&&(l=n/e);break;case"natural-log":n>0&&(l=Math.log(n));break;case"square-root":n>0&&(l=n**.5)}return l}function cn(n,t,e){const a=fn({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||R});return n=mn(n,t.minValue,t.maxValue),B({definition:a,values:n,normalizationTotal:t.normalizationTotal},e)}function mn(n,t,e){const a=t??-1/0,l=e??1/0;return n.filter((m=>Number.isFinite(m)&&m>=a&&m<=l))}function fn(n){const{breakCount:t,field:e,normalizationField:a,normalizationType:l}=n,m=n.classificationMethod||Y,s=m==="standard-deviation"?n.standardDeviationInterval||Q:void 0,i=m==="defined-interval"?n.definedInterval:void 0;return new C({breakCount:t,classificationField:e,classificationMethod:m,normalizationField:l==="field"?a:void 0,normalizationType:l,standardDeviationInterval:s,definedInterval:i})}function Fn(n,t){var o,h;let e=n.classBreaks;const a=e.length,l=(o=e[0])==null?void 0:o.minValue,m=(h=e[a-1])==null?void 0:h.maxValue,s=t==="standard-deviation",i=J;return e=e.map((d=>{const c=d.label,r={minValue:d.minValue,maxValue:d.maxValue,label:c};if(s&&c){const u=c.match(i),f=(u==null?void 0:u.map((p=>+p.trim())))??[];f.length===2?(r.minStdDev=f[0],r.maxStdDev=f[1],f[0]<0&&f[1]>0&&(r.hasAvg=!0)):f.length===1&&(c.includes("<")?(r.minStdDev=null,r.maxStdDev=f[0]):c.includes(">")&&(r.minStdDev=f[0],r.maxStdDev=null))}return r})),{minValue:l,maxValue:m,classBreakInfos:e,normalizationTotal:n.normalizationTotal}}function Mn(n,t){const e=dn(n,t);if(e.min==null&&e.max==null)return{bins:[],minValue:e.min,maxValue:e.max,normalizationTotal:t.normalizationTotal};const a=e.intervals,l=e.min??0,m=e.max??0,s=a.map(((i,o)=>({minValue:a[o][0],maxValue:a[o][1],count:0})));for(const i of n)if(i!=null&&i>=l&&i<=m){const o=pn(a,i);o>-1&&s[o].count++}return{bins:s,minValue:l,maxValue:m,normalizationTotal:t.normalizationTotal}}function dn(n,t,e=!1){var b,V;const{field:a,classificationMethod:l,standardDeviationInterval:m,definedInterval:s,normalizationType:i,normalizationField:o,normalizationTotal:h,minValue:d,maxValue:c}=t,r=t.numBins||H;let u=null,f=null,p=null;if((!l||l==="equal-interval")&&!i){if(d!=null&&c!=null)u=d,f=c;else{const g=nn({values:n,minValue:d,maxValue:c,useSampleStdDev:!i,supportsNullCount:Z({normalizationType:i,normalizationField:o,minValue:d,maxValue:c})});u=g.min??null,f=g.max??null}p=hn(u??0,f??0,r)}else{const{classBreaks:g}=cn(n,{field:a,normalizationType:i,normalizationField:o,normalizationTotal:h,classificationMethod:l,standardDeviationInterval:m,definedInterval:s,minValue:d,maxValue:c,numClasses:r},d!=null&&c!=null?[d,c]:void 0);u=(b=g[0])==null?void 0:b.minValue,f=(V=g[g.length-1])==null?void 0:V.maxValue,p=g.map((S=>[S.minValue,S.maxValue]))}if(e&&p.length){const g=p.at(-1)[1];p.push([g,g])}return{min:u,max:f,intervals:p}}function pn(n,t){let e=-1;for(let a=n.length-1;a>=0;a--)if(t>=n[a][0]){e=a;break}return e}function hn(n,t,e){const a=(t-n)/e,l=[];let m,s=n;for(let i=1;i<=e;i++)m=s+a,m=Number(m.toFixed(16)),l.push([s,i===e?t:m]),s=m;return l}export{Tn as $,yn as B,vn as C,cn as E,dn as G,pn as L,Fn as P,Mn as U,Z as d,gn as f,tn as g,xn as k,y as m,nn as p,k as v};
