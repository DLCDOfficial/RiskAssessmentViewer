import{aN as O,cI as T,v as X,X as H,I as Q,am as V,bw as C,U as z,fP as L,j as W,V as F,fQ as _,s as B}from"./index-DzoQLc5A.js";import{r as q,i as b,o as v,s as k}from"./normalizeUtilsCommon-C_a4i1bY.js";import{f as E}from"./utils-DDykF6ND.js";import{r as G,o as K}from"./utils-BRuFmAg3.js";async function Y(e,s,c,n){const t=E(e),i=s[0].spatialReference,r={...n,responseType:"json",query:{...t.query,f:"json",sr:T(i),target:JSON.stringify({geometryType:O(s[0]),geometries:s}),cutter:JSON.stringify(c)}},o=await X(t.path+"/cut",r),{cutIndexes:f,geometries:u=[]}=o.data;return{cutIndexes:f,geometries:u.map((p=>{const x=H(p);return x.spatialReference=i,x}))}}async function Z(e,s,c){const n=typeof e=="string"?Q(e):e,t=s[0].spatialReference,i=O(s[0]),r={...c,query:{...n.query,f:"json",sr:T(t),geometries:JSON.stringify(G(s))}},{data:o}=await X(n.path+"/simplify",r);return K(o.geometries,i,t)}const D=()=>W.getLogger("esri.geometry.support.normalizeUtils");function ee(e){return e.type==="polygon"}function te(e){return e[0].type==="polygon"}function se(e){return e[0].type==="polyline"}function ne(e,s){if(!(e instanceof z||e instanceof F)){const t="straightLineDensify: the input geometry is neither polyline nor polygon";throw D().error(t),new B("internal:geometry",t)}const c=v(e),n=[];for(const t of c){const i=[];n.push(i),i.push([t[0][0],t[0][1]]);for(let r=0;r<t.length-1;r++){const o=t[r][0],f=t[r][1],u=t[r+1][0],p=t[r+1][1],x=Math.sqrt((u-o)*(u-o)+(p-f)*(p-f)),h=(p-f)/x,d=(u-o)/x,g=x/s;if(g>1){for(let R=1;R<=g-1;R++){const N=R*s,l=d*N+o,a=h*N+f;i.push([l,a])}const M=(x+Math.floor(g-1)*s)/2,P=d*M+o,A=h*M+f;i.push([P,A])}i.push([u,p])}}return ee(e)?new F({rings:n,spatialReference:e.spatialReference}):new z({paths:n,spatialReference:e.spatialReference})}function U(e,s,c){if(s){const n=ne(e,1e6);e=_(n,!0)}return c&&(e=k(e,c)),e}function J(e,s,c){if(Array.isArray(e)){const n=e[0];if(n>s){const t=b(n,s);e[0]=n+t*(-2*s)}else if(n<c){const t=b(n,c);e[0]=n+t*(-2*c)}}else{const n=e.x;if(n>s){const t=b(n,s);e=e.clone().offset(t*(-2*s),0)}else if(n<c){const t=b(n,c);e=e.clone().offset(t*(-2*c),0)}}return e}function oe(e,s){let c=-1;for(let n=0;n<s.cutIndexes.length;n++){const t=s.cutIndexes[n],i=s.geometries[n],r=v(i);for(let o=0;o<r.length;o++){const f=r[o];f.some((u=>{if(u[0]<180)return!0;{let p=0;for(let h=0;h<f.length;h++){const d=f[h][0];p=d>p?d:p}p=Number(p.toFixed(9));const x=-360*b(p,180);for(let h=0;h<f.length;h++){const d=i.getPoint(o,h);i.setPoint(o,h,d.clone().offset(x,0))}return!0}}))}if(t===c){if(te(e))for(const o of v(i))e[t]=e[t].addRing(o);else if(se(e))for(const o of v(i))e[t]=e[t].addPath(o)}else c=t,e[t]=i}return e}async function re(e,s,c){if(!Array.isArray(e))return re([e],s);s&&typeof s!="string"&&D().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const n=typeof s=="string"?s:(s==null?void 0:s.url)??V.geometryServiceUrl;let t,i,r,o,f,u,p,x,h=0;const d=[],g=[];for(const l of e)if(l!=null)if(t||(t=l.spatialReference,i=C(t),r=t.isWebMercator,u=r?102100:4326,o=q[u].maxX,f=q[u].minX,p=q[u].plus180Line,x=q[u].minus180Line),i)if(l.type==="mesh")g.push(l);else if(l.type==="point")g.push(J(l.clone(),o,f));else if(l.type==="multipoint"){const a=l.clone();a.points=a.points.map((m=>J(m,o,f))),g.push(a)}else if(l.type==="extent"){const a=l.clone()._normalize(!1,!1,i);g.push(a.rings?new F(a):a)}else if(l.extent){const a=l.extent,m=b(a.xmin,f)*(2*o);let $=m===0?l.clone():k(l.clone(),m);a.offset(m,0);let{xmin:w,xmax:y}=a;w=Number(w.toFixed(9)),y=Number(y.toFixed(9)),a.intersects(p)&&y!==o?(h=y>h?y:h,$=U($,r),d.push($),g.push("cut")):a.intersects(x)&&w!==f?(h=y*(2*o)>h?y*(2*o):h,$=U($,r,360),d.push($),g.push("cut")):g.push($)}else g.push(l.clone());else g.push(l);else g.push(l);let M=b(h,o),P=-90;const A=M,R=new z;for(;M>0;){const l=360*M-180;R.addPath([[l,P],[l,-1*P]]),P*=-1,M--}if(d.length>0&&A>0){const l=oe(d,await Y(n,d,R,c)),a=[],m=[];for(let y=0;y<g.length;y++){const j=g[y];if(j!=="cut")m.push(j);else{const S=l.shift(),I=e[y];I!=null&&I.type==="polygon"&&I.rings&&I.rings.length>1&&S.rings.length>=I.rings.length?(a.push(S),m.push("simplify")):m.push(r?L(S):S)}}if(!a.length)return m;const $=await Z(n,a,c),w=[];for(let y=0;y<m.length;y++){const j=m[y];j!=="simplify"?w.push(j):w.push(r?L($.shift()):$.shift())}return w}const N=[];for(let l=0;l<g.length;l++){const a=g[l];if(a!=="cut")N.push(a);else{const m=d.shift();N.push(r===!0?L(m):m)}}return N}function ae(e,s,c){const n=C(c);if(n==null)return e;const[t,i]=n.valid,r=2*i;let o=0,f=0;s>i?o=Math.ceil(Math.abs(s-i)/r):s<t&&(o=-Math.ceil(Math.abs(s-t)/r)),e>i?f=Math.ceil(Math.abs(e-i)/r):e<t&&(f=-Math.ceil(Math.abs(e-t)/r));let u=e+(o-f)*r;const p=u-s;return p>i?u-=r:p<t&&(u+=r),u}export{ae as P,re as R};
