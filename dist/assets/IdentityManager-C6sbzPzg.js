const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DM3E7zfv.js","./customElement-CW8_LrXG.js","./component-C4aMrbhB.js","./dom-DCtltayX.js","./interactive-M0P1TcJY.js","./form-CHrUrdjh.js","./label-DthW-ry0.js","./index-DzoQLc5A.js","./index-FMl8DCyv.css","./sanitizerUtils-C8BmVxiO.js","./index-Cp1weyCC.js","./key-1SYfXAnk.js","./index-BbP3371Q.js","./openCloseComponent-fHKBRHSH.js","./index-o_F49Ot3.js","./index-DsEdFNTP.js","./index-x-kuVGlT.js"])))=>i.map(i=>d[i]);
var Lr=Object.getPrototypeOf;var Dr=Reflect.get;var ps=r=>{throw TypeError(r)};var St=(r,e,t)=>e.has(r)||ps("Cannot "+t);var f=(r,e,t)=>(St(r,e,"read from private field"),t?t.call(r):e.get(r)),I=(r,e,t)=>e.has(r)?ps("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),b=(r,e,t,s)=>(St(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),J=(r,e,t)=>(St(r,e,"access private method"),t);var fs=(r,e,t)=>Dr(Lr(r),t,e);import{r as Nr,bk as Oe,j as jt,o as lt,g as ht,cm as Mt,fK as jr,b_ as ct,k4 as Mr,bB as Hr,jG as gs,fA as qr,bY as Ht,g$ as Ks,j9 as Br,bC as Xt,ej as zr,fJ as Vr,a5 as Fr,cN as Wr,k5 as Jr,k6 as Kr,id as ms,fM as vs,k7 as Gr,k8 as tt,k9 as Qr,bZ as Yr,B as m,F as v,dE as Zr,J as We,_ as Te,w as Gs,I as At,ka as Qs,K as Ge,a$ as Pe,s as T,fU as Xr,cy as K,ft as ie,v as q,kb as Qe,kc as bt,dC as _s,kd as ei,gd as ys,am as $t,fw as ti,j8 as si,cn as ri,an as Ye,ke as ii}from"./index-DzoQLc5A.js";import{t as Ys}from"./sanitizerUtils-C8BmVxiO.js";const Zs=()=>jt.getLogger("esri.intl.substitute");function oi(r,e,t={}){const{format:s={}}=t;return Nr(r,(i=>ni(i,e,s)))}function ni(r,e,t){let s,i;const o=r.indexOf(":");if(o===-1?s=r.trim():(s=r.slice(0,o).trim(),i=r.slice(o+1).trim()),!s)return"";const n=Oe(s,e);if(n==null)return"";const l=(i?t==null?void 0:t[i]:null)??(t==null?void 0:t[s]);return l?ai(n,l):i?li(n,i):es(n)}function ai(r,e){switch(e.type){case"date":return ht(r,e.intlOptions);case"number":return lt(r,e.intlOptions);default:return Zs().warn("missing format descriptor for key {key}"),es(r)}}function li(r,e){switch(e.toLowerCase()){case"dateformat":return ht(r);case"numberformat":return lt(r);default:return Zs().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ht(r):/^numberformat/i.test(e)?lt(r):es(r)}}function es(r){switch(typeof r){case"string":return r;case"number":return lt(r);case"boolean":return""+r;default:return r instanceof Date?ht(r):""}}function hi(r){return typeof r=="string"?document.getElementById(r):r??null}const Xs="http://www.w3.org/",mt=`${Xs}2000/svg`,er=`${Xs}1999/xlink`;let ws=[],ts=(r,e)=>{let t={};return Object.keys(r).forEach((s=>{t[s]=r[s]})),e&&Object.keys(e).forEach((s=>{t[s]=e[s]})),t},ss=(r,e)=>r.vnodeSelector===e.vnodeSelector&&(r.properties&&e.properties?r.properties.key===e.properties.key&&r.properties.bind===e.properties.bind:!r.properties&&!e.properties),tr=r=>{if(typeof r!="string")throw new Error("Style values must be strings")},ci=(r,e,t)=>{if(e.vnodeSelector!==""){for(let s=t;s<r.length;s++)if(ss(r[s],e))return s}return-1},It=(r,e,t,s)=>{let i=r[e];if(i.vnodeSelector==="")return;let o=i.properties;if(!(o&&(o.key===void 0?o.bind:o.key))){for(let n=0;n<r.length;n++)if(n!==e){let l=r[n];if(ss(l,i))throw new Error(`${t.vnodeSelector} had a ${i.vnodeSelector} child ${s==="added"?s:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},di=r=>{if(r.properties){let e=r.properties.enterAnimation;e&&e(r.domNode,r.properties)}},qt=[],Bt=!1,sr=r=>{(r.children||[]).forEach(sr),r.properties&&r.properties.afterRemoved&&r.properties.afterRemoved.apply(r.properties.bind||r.properties,[r.domNode])},Ss=()=>{Bt=!1,qt.forEach(sr),qt.length=0},As=r=>{qt.push(r),Bt||(Bt=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Ss,{timeout:16}):setTimeout(Ss,16))},bs=r=>{let e=r.domNode;if(r.properties){let t=r.properties.exitAnimation;if(t)return e.style.pointerEvents="none",void t(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),As(r))},r.properties)}e.parentNode&&(e.parentNode.removeChild(e),As(r))},ui=(r,e,t)=>{if(!e)return;let s=t.eventHandlerInterceptor,i=Object.keys(e),o=i.length;for(let n=0;n<o;n++){let l=i[n],a=e[l];if(l==="className")throw new Error('Property "className" is not supported, use "class".');if(l==="class")Vt(r,a,!0);else if(l==="classes"){let h=Object.keys(a),c=h.length;for(let u=0;u<c;u++){let d=h[u];a[d]&&r.classList.add(d)}}else if(l==="styles"){let h=Object.keys(a),c=h.length;for(let u=0;u<c;u++){let d=h[u],p=a[d];p&&(tr(p),t.styleApplyer(r,d,p))}}else if(l!=="key"&&a!=null){let h=typeof a;h==="function"?(l.lastIndexOf("on",0)===0&&(s&&(a=s(l,a,r,e)),l==="oninput"&&(function(){let c=a;a=function(u){c.apply(this,[u]),u.target["oninput-value"]=u.target.value}})()),r[l]=a):t.namespace===mt?l==="href"?r.setAttributeNS(er,l,a):r.setAttribute(l,a):h==="string"&&l!=="value"?l==="innerHTML"?r[l]=Ys.sanitize(a):zt(r)&&l in r?r[l]=a:r.setAttribute(l,a):r[l]=a}}};function zt(r){if(!(r instanceof Element&&r.tagName.includes("-")))return!1;const e=window.customElements.get(r.tagName.toLowerCase());return!!e&&r instanceof e}let dt,pi=(r,e,t)=>{if(e)for(let s of e)Le(s,r,void 0,t)},rr=(r,e,t)=>{pi(r,e.children,t),e.text&&(r.textContent=e.text),ui(r,e.properties,t),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[r,t,e.vnodeSelector,e.properties,e.children])},Le=(r,e,t,s)=>{let i,o=0,n=r.vnodeSelector,l=e.ownerDocument;if(n==="")i=r.domNode=l.createTextNode(r.text),t!==void 0?e.insertBefore(i,t):e.appendChild(i);else{for(let a=0;a<=n.length;++a){let h=n.charAt(a);if(a===n.length||h==="."||h==="#"){let c=n.charAt(o-1),u=n.slice(o,a);c==="."?i.classList.add(u):c==="#"?i.id=u:(u==="svg"&&(s=ts(s,{namespace:mt})),s.namespace!==void 0?i=r.domNode=l.createElementNS(s.namespace,u):(i=r.domNode=r.domNode||l.createElement(u),u==="input"&&r.properties&&r.properties.type!==void 0&&i.setAttribute("type",r.properties.type)),t!==void 0?e.insertBefore(i,t):i.parentNode!==e&&e.appendChild(i)),o=a+1}}rr(i,r,s)}},Vt=(r,e,t)=>{e&&e.split(" ").forEach((s=>{s&&r.classList.toggle(s,t)}))},fi=(r,e,t,s)=>{if(!t)return;let i=!1,o=Object.keys(t),n=o.length;for(let l=0;l<n;l++){let a=o[l],h=t[a],c=e[a];if(a==="class")c!==h&&(Vt(r,c,!1),Vt(r,h,!0));else if(a==="classes"){let u=r.classList,d=Object.keys(h),p=d.length;for(let g=0;g<p;g++){let _=d[g],y=!!h[_];y!==!!c[_]&&(i=!0,y?u.add(_):u.remove(_))}}else if(a==="styles"){let u=Object.keys(h),d=u.length;for(let p=0;p<d;p++){let g=u[p],_=h[g];_!==c[g]&&(i=!0,_?(tr(_),s.styleApplyer(r,g,_)):s.styleApplyer(r,g,""))}}else if(h||typeof c!="string"||(h=""),a!=="value"||zt(r)){if(h!==c){let u=typeof h;u==="function"&&s.eventHandlerInterceptor||(s.namespace===mt?a==="href"?r.setAttributeNS(er,a,h):r.setAttribute(a,h):u==="string"?a==="innerHTML"?r[a]=Ys.sanitize(h):a==="role"&&h===""?r.removeAttribute(a):zt(r)&&a in r?r[a]=h:r.setAttribute(a,h):r[a]!==h&&(r[a]=h),i=!0)}}else{let u=r[a];u!==h&&(r["oninput-value"]?u===r["oninput-value"]:h!==c)&&(r[a]=h,r["oninput-value"]=void 0),h!==c&&(i=!0)}}return i},gi=(r,e,t,s,i)=>{if(t===s)return!1;s=s||ws;let o,n=(t=t||ws).length,l=s.length,a=0,h=0,c=!1;for(;h<l;){let u=a<n?t[a]:void 0,d=s[h];if(u!==void 0&&ss(u,d))c=dt(u,d,i)||c,a++;else{let p=ci(t,d,a+1);if(p>=0){for(o=a;o<p;o++)bs(t[o]),It(t,o,r,"removed");c=dt(t[p],d,i)||c,a=p+1}else Le(d,e,a<n?t[a].domNode:void 0,i),di(d),It(s,h,r,"added")}h++}if(n>a)for(o=a;o<n;o++)bs(t[o]),It(t,o,r,"removed");return c};dt=(r,e,t)=>{let s=r.domNode,i=!1;if(r===e)return!1;let o=!1;if(e.vnodeSelector===""){if(e.text!==r.text){let n=s.ownerDocument.createTextNode(e.text);return s.parentNode.replaceChild(n,s),e.domNode=n,i=!0,i}e.domNode=s}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(t=ts(t,{namespace:mt})),r.text!==e.text&&(o=!0,e.text===void 0?s.removeChild(s.firstChild):s.textContent=e.text),e.domNode=s,o=gi(e,s,r.children,e.children,t)||o,o=fi(s,r.properties,e.properties,t)||o,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[s,t,e.vnodeSelector,e.properties,e.children]);return o&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(s,e.properties,r.properties),i};let Ze=(r,e)=>({getLastRender:()=>r,update:t=>{if(r.vnodeSelector!==t.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let s=r;r=t,dt(s,t,e)},domNode:r.domNode});const mi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(r,e,t)=>{e.charAt(0)==="-"?r.style.setProperty(e,t):r.style[e]=t}};let Xe=r=>ts(mi,r),et={append:(r,e,t)=>(t=Xe(t),Le(e,r,void 0,t),Ze(e,t)),insertBefore:(r,e,t)=>(t=Xe(t),Le(e,r.parentNode,r,t),Ze(e,t)),merge:(r,e,t)=>(t=Xe(t),e.domNode=r,rr(r,e,t),Ze(e,t)),replace:(r,e,t)=>(t=Xe(t),Le(e,r.parentNode,r,t),r.parentNode.removeChild(r),Ze(e,t))};const vi={handleInterceptedEvent:(r,e,t,s)=>(r.scheduleRender(),e.properties[`on${s.type}`].apply(e.properties.bind||t,[s]))},_i={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(r,e,t)=>{e.charAt(0)==="-"?r.style.setProperty(e,t):r.style[e]=t}},yi=r=>({..._i,...r}),wi=(r,e)=>{const t=[];for(;r&&r!==e;)t.push(r),r=r.parentNode;return t},Si=(r,e)=>r.find(e),$s=(r,e,t=!1)=>{let s=r;return e.forEach(((i,o)=>{const n=s!=null&&s.children?Si(s.children,(l=>l.domNode===i)):void 0;t&&!n&&o!==e.length-1||(s=n)})),s},Ai=r=>{let e;const t={...vi,...r},s=yi(t),i=s.performanceLogger;let o,n=!0,l=!1;const a=[],h=[],c=(d,p,g)=>{var w;let _;s.eventHandlerInterceptor=(R,ee,wt,$)=>function(S){let A;i("domEvent",S);const W=wi(S.currentTarget,_.domNode),Je=W.some((te=>{var Ke;return customElements.get((Ke=te==null?void 0:te.tagName)==null?void 0:Ke.toLowerCase())}));if(S.eventPhase===Event.CAPTURING_PHASE||!Je)W.reverse(),A=$s(_.getLastRender(),W);else{const te=S.composedPath(),Ke=te.slice(te.indexOf(S.currentTarget),te.indexOf(_.domNode)).reverse();A=$s(_.getLastRender(),Ke,!0)}let us;return A&&(us=t.handleInterceptedEvent(e,A,this,S)),i("domEventProcessed",S),us},(w=t.postProcessProjectionOptions)==null||w.call(t,s);const y=g();_=d(p,y,s),s.eventHandlerInterceptor=void 0,a.push(_),h.push(g),t.afterFirstVNodeRendered&&t.afterFirstVNodeRendered(_,y)};let u=()=>{if(o=void 0,n){n=!1,i("renderStart",void 0);for(let d=0;d<a.length;d++){const p=h[d]();i("rendered",void 0);try{a[d].update(p)}catch(g){console.error(g)}i("patched",void 0)}i("renderDone",void 0),n=!0}};return t.modifyDoRenderImplementation&&(u=t.modifyDoRenderImplementation(u,a,h)),e={renderNow:u,scheduleRender:()=>{o||l||(o=requestAnimationFrame(u))},stop:()=>{o&&(cancelAnimationFrame(o),o=void 0),l=!0},resume:()=>{l=!1,n=!0,e.scheduleRender()},append:(d,p)=>{c(et.append,d,p)},insertBefore:(d,p)=>{c(et.insertBefore,d,p)},merge:(d,p)=>{c(et.merge,d,p)},replace:(d,p)=>{c(et.replace,d,p)},detach:d=>{for(let p=0;p<h.length;p++)if(h[p]===d)return h.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e};class Me{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}const bi=(r,e)=>{let t=r;for(;t;){if(t===e)return!0;if(!t.parentNode)return!1;t.parentNode instanceof ShadowRoot?t=t.parentNode.host:t=t.parentNode}return!1},$i=(r,e,t)=>{const s=Ii(e).subscribe;return s(i=>{i.some(n=>bi(r,n.target))&&t()})},kt={},Ii=r=>{const e=r.join(","),t=kt[e];if(t!==void 0)return t;const s=new Set,i=new MutationObserver(n=>s.forEach(l=>l(n)));globalThis.document&&i.observe(document.documentElement,{attributes:!0,attributeFilter:r,subtree:!0});const o={subscribe:n=>(s.add(n),()=>{s.delete(n),s.size===0&&(i.disconnect(),kt[e]=void 0)})};return kt[e]=o,o},ki=(r,e)=>{var s,i;let t=r;for(;t;){const o=(s=t.closest)==null?void 0:s.call(t,e);if(o)return o;const n=(i=t.getRootNode)==null?void 0:i.call(t);if(n===globalThis.document)return null;t=n.host}return null},Ci=(r,e,t)=>{const s=ki(r,`[${e}]`);return(s==null?void 0:s.getAttribute(e))??t},C=(r,e,...t)=>{try{return r==null?void 0:r.call(e,...t)}catch(s){console.error(s,r)}},Ft=async(r,e,...t)=>{try{return await(r==null?void 0:r.call(e,...t))}catch(s){console.error(s,r)}},Ui="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),Ti=new Set(Ui),ut="en",Pi={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},Ei=async(r,e,t="")=>{const s=`${e}/${t}`,i=`${s}${r}.json`;return Ct[i]??(Ct[i]=ir(r,s)),await Ct[i]},Ct={},ir=async(r,e)=>{const t=`${e}${r}.json`;try{const s=await fetch(t);if(s.ok)return await s.json()}catch(s){return console.error(s),{}}return r===ut?{}:await ir(ut,e)},Oi=r=>{var t;const e=Ci(r,"lang",((t=globalThis.navigator)==null?void 0:t.language)||ut);return{lang:e,t9nLocale:or(e)}},or=r=>{const[e,t]=r.split("-"),s=e.toLowerCase();let i=s;return t&&(i=`${s}-${t.toUpperCase()}`),i=Pi[i]??i,Ti.has(i)?i:t?or(s):ut},gn=(r,e,t,s)=>{let i;const o=()=>xi(r,e(),s).then(n=>{((i==null?void 0:i.lang)!==n.lang||i.t9nLocale!==n.t9nLocale||i.t9nStrings!==n.t9nStrings)&&t(n),i=n}).catch(console.error);return queueMicrotask(o),$i(r,["lang"],o)},xi=async(r,e,t=r.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:i}=Oi(r),o=`${e}/${t}/t9n`,l=t===null?{}:await Ei(i,o,"messages.");return{lang:s,t9nLocale:i,t9nStrings:l}},Ri=r=>r.replace(Li,(e,t)=>`${t===0?"":"-"}${e.toLowerCase()}`),Li=/[A-Z]+(?![a-z])|[A-Z]/gu,Di=(r,e)=>{const t=e/Ni;let s=0;const i=setInterval(()=>{s+=t,s>=e&&(clearInterval(i),r())},t);return i},Ni=4;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const st=globalThis,rs=st.ShadowRoot&&(st.ShadyCSS===void 0||st.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,is=Symbol(),Is=new WeakMap;let nr=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==is)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(rs&&e===void 0){const s=t!==void 0&&t.length===1;s&&(e=Is.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Is.set(t,e))}return e}toString(){return this.cssText}};const ji=r=>new nr(typeof r=="string"?r:r+"",void 0,is),vn=(r,...e)=>{const t=r.length===1?r[0]:e.reduce(((s,i,o)=>s+(n=>{if(n._$cssResult$===!0)return n.cssText;if(typeof n=="number")return n;throw Error("Value passed to 'css' function must be a 'css' function result: "+n+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+r[o+1]),r[0]);return new nr(t,r,is)},Mi=(r,e)=>{if(rs)r.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const t of e){const s=document.createElement("style"),i=st.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=t.cssText,r.appendChild(s)}},ks=rs?r=>r:r=>r instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return ji(t)})(r):r;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Hi,defineProperty:qi,getOwnPropertyDescriptor:Bi,getOwnPropertyNames:zi,getOwnPropertySymbols:Vi,getPrototypeOf:Fi}=Object,Z=globalThis,Cs=Z.trustedTypes,Wi=Cs?Cs.emptyScript:"",Ut=Z.reactiveElementPolyfillSupport,De=(r,e)=>r,Wt={toAttribute(r,e){switch(e){case Boolean:r=r?Wi:null;break;case Object:case Array:r=r==null?r:JSON.stringify(r)}return r},fromAttribute(r,e){let t=r;switch(e){case Boolean:t=r!==null;break;case Number:t=r===null?null:Number(r);break;case Object:case Array:try{t=JSON.parse(r)}catch{t=null}}return t}},os=(r,e)=>!Hi(r,e),Us={attribute:!0,type:String,converter:Wt,reflect:!1,useDefault:!1,hasChanged:os};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Z.litPropertyMetadata??(Z.litPropertyMetadata=new WeakMap);let fe=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Us){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(e,s,t);i!==void 0&&qi(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){const{get:i,set:o}=Bi(this.prototype,e)??{get(){return this[t]},set(n){this[t]=n}};return{get:i,set(n){const l=i==null?void 0:i.call(this);o==null||o.call(this,n),this.requestUpdate(e,l,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Us}static _$Ei(){if(this.hasOwnProperty(De("elementProperties")))return;const e=Fi(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(De("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(De("properties"))){const t=this.properties,s=[...zi(t),...Vi(t)];for(const i of s)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[s,i]of t)this.elementProperties.set(s,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const i of s)t.unshift(ks(i))}else e!==void 0&&t.push(ks(e));return t}static _$Eu(e,t){const s=t.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach((t=>t(this)))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Mi(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach((t=>{var s;return(s=t.hostConnected)==null?void 0:s.call(t)}))}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach((t=>{var s;return(s=t.hostDisconnected)==null?void 0:s.call(t)}))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$ET(e,t){var o;const s=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,s);if(i!==void 0&&s.reflect===!0){const n=(((o=s.converter)==null?void 0:o.toAttribute)!==void 0?s.converter:Wt).toAttribute(t,s.type);this._$Em=e,n==null?this.removeAttribute(i):this.setAttribute(i,n),this._$Em=null}}_$AK(e,t){var o,n;const s=this.constructor,i=s._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const l=s.getPropertyOptions(i),a=typeof l.converter=="function"?{fromAttribute:l.converter}:((o=l.converter)==null?void 0:o.fromAttribute)!==void 0?l.converter:Wt;this._$Em=i;const h=a.fromAttribute(t,l.type);this[i]=h??((n=this._$Ej)==null?void 0:n.get(i))??h,this._$Em=null}}requestUpdate(e,t,s){var i;if(e!==void 0){const o=this.constructor,n=this[e];if(s??(s=o.getPropertyOptions(e)),!((s.hasChanged??os)(n,t)||s.useDefault&&s.reflect&&n===((i=this._$Ej)==null?void 0:i.get(e))&&!this.hasAttribute(o._$Eu(e,s))))return;this.C(e,t,s)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:s,reflect:i,wrapped:o},n){s&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,n??t??this[e]),o!==!0||n!==void 0)||(this._$AL.has(e)||(this.hasUpdated||s||(t=void 0),this._$AL.set(e,t)),i===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[o,n]of this._$Ep)this[o]=n;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[o,n]of i){const{wrapped:l}=n,a=this[o];l!==!0||this._$AL.has(o)||a===void 0||this.C(o,void 0,n,a)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(s=this._$EO)==null||s.forEach((i=>{var o;return(o=i.hostUpdate)==null?void 0:o.call(i)})),this.update(t)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach((s=>{var i;return(i=s.hostUpdated)==null?void 0:i.call(s)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach((t=>this._$ET(t,this[t])))),this._$EM()}updated(e){}firstUpdated(e){}};fe.elementStyles=[],fe.shadowRootOptions={mode:"open"},fe[De("elementProperties")]=new Map,fe[De("finalized")]=new Map,Ut==null||Ut({ReactiveElement:fe}),(Z.reactiveElementVersions??(Z.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ne=globalThis,pt=Ne.trustedTypes,Ts=pt?pt.createPolicy("lit-html",{createHTML:r=>r}):void 0,ar="$lit$",G=`lit$${Math.random().toFixed(9).slice(2)}$`,lr="?"+G,Ji=`<${lr}>`,pe=document,He=()=>pe.createComment(""),qe=r=>r===null||typeof r!="object"&&typeof r!="function",ns=Array.isArray,Ki=r=>ns(r)||typeof(r==null?void 0:r[Symbol.iterator])=="function",Tt=`[ 	
\f\r]`,Ee=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ps=/-->/g,Es=/>/g,se=RegExp(`>|${Tt}(?:([^\\s"'>=/]+)(${Tt}*=${Tt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Os=/'/g,xs=/"/g,hr=/^(?:script|style|textarea|title)$/i,cr=r=>(e,...t)=>({_$litType$:r,strings:e,values:t}),yn=cr(1),wn=cr(2),X=Symbol.for("lit-noChange"),U=Symbol.for("lit-nothing"),Rs=new WeakMap,oe=pe.createTreeWalker(pe,129);function dr(r,e){if(!ns(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ts!==void 0?Ts.createHTML(e):e}const Gi=(r,e)=>{const t=r.length-1,s=[];let i,o=e===2?"<svg>":e===3?"<math>":"",n=Ee;for(let l=0;l<t;l++){const a=r[l];let h,c,u=-1,d=0;for(;d<a.length&&(n.lastIndex=d,c=n.exec(a),c!==null);)d=n.lastIndex,n===Ee?c[1]==="!--"?n=Ps:c[1]!==void 0?n=Es:c[2]!==void 0?(hr.test(c[2])&&(i=RegExp("</"+c[2],"g")),n=se):c[3]!==void 0&&(n=se):n===se?c[0]===">"?(n=i??Ee,u=-1):c[1]===void 0?u=-2:(u=n.lastIndex-c[2].length,h=c[1],n=c[3]===void 0?se:c[3]==='"'?xs:Os):n===xs||n===Os?n=se:n===Ps||n===Es?n=Ee:(n=se,i=void 0);const p=n===se&&r[l+1].startsWith("/>")?" ":"";o+=n===Ee?a+Ji:u>=0?(s.push(h),a.slice(0,u)+ar+a.slice(u)+G+p):a+G+(u===-2?l:p)}return[dr(r,o+(r[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),s]};class Be{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let o=0,n=0;const l=e.length-1,a=this.parts,[h,c]=Gi(e,t);if(this.el=Be.createElement(h,s),oe.currentNode=this.el.content,t===2||t===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=oe.nextNode())!==null&&a.length<l;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(ar)){const d=c[n++],p=i.getAttribute(u).split(G),g=/([.?@])?(.*)/.exec(d);a.push({type:1,index:o,name:g[2],strings:p,ctor:g[1]==="."?Yi:g[1]==="?"?Zi:g[1]==="@"?Xi:vt}),i.removeAttribute(u)}else u.startsWith(G)&&(a.push({type:6,index:o}),i.removeAttribute(u));if(hr.test(i.tagName)){const u=i.textContent.split(G),d=u.length-1;if(d>0){i.textContent=pt?pt.emptyScript:"";for(let p=0;p<d;p++)i.append(u[p],He()),oe.nextNode(),a.push({type:2,index:++o});i.append(u[d],He())}}}else if(i.nodeType===8)if(i.data===lr)a.push({type:2,index:o});else{let u=-1;for(;(u=i.data.indexOf(G,u+1))!==-1;)a.push({type:7,index:o}),u+=G.length-1}o++}}static createElement(e,t){const s=pe.createElement("template");return s.innerHTML=e,s}}function Ce(r,e,t=r,s){var n,l;if(e===X)return e;let i=s!==void 0?(n=t._$Co)==null?void 0:n[s]:t._$Cl;const o=qe(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==o&&((l=i==null?void 0:i._$AO)==null||l.call(i,!1),o===void 0?i=void 0:(i=new o(r),i._$AT(r,t,s)),s!==void 0?(t._$Co??(t._$Co=[]))[s]=i:t._$Cl=i),i!==void 0&&(e=Ce(r,i._$AS(r,e.values),i,s)),e}let Qi=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,i=((e==null?void 0:e.creationScope)??pe).importNode(t,!0);oe.currentNode=i;let o=oe.nextNode(),n=0,l=0,a=s[0];for(;a!==void 0;){if(n===a.index){let h;a.type===2?h=new as(o,o.nextSibling,this,e):a.type===1?h=new a.ctor(o,a.name,a.strings,this,e):a.type===6&&(h=new eo(o,this,e)),this._$AV.push(h),a=s[++l]}n!==(a==null?void 0:a.index)&&(o=oe.nextNode(),n++)}return oe.currentNode=pe,i}p(e){let t=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}},as=class ur{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,s,i){this.type=2,this._$AH=U,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ce(this,e,t),qe(e)?e===U||e==null||e===""?(this._$AH!==U&&this._$AR(),this._$AH=U):e!==this._$AH&&e!==X&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):Ki(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==U&&qe(this._$AH)?this._$AA.nextSibling.data=e:this.T(pe.createTextNode(e)),this._$AH=e}$(e){var o;const{values:t,_$litType$:s}=e,i=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=Be.createElement(dr(s.h,s.h[0]),this.options)),s);if(((o=this._$AH)==null?void 0:o._$AD)===i)this._$AH.p(t);else{const n=new Qi(i,this),l=n.u(this.options);n.p(t),this.T(l),this._$AH=n}}_$AC(e){let t=Rs.get(e.strings);return t===void 0&&Rs.set(e.strings,t=new Be(e)),t}k(e){ns(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const o of e)i===t.length?t.push(s=new ur(this.O(He()),this.O(He()),this,this.options)):s=t[i],s._$AI(o),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,t);e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}};class vt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,i,o){this.type=1,this._$AH=U,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=o,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=U}_$AI(e,t=this,s,i){const o=this.strings;let n=!1;if(o===void 0)e=Ce(this,e,t,0),n=!qe(e)||e!==this._$AH&&e!==X,n&&(this._$AH=e);else{const l=e;let a,h;for(e=o[0],a=0;a<o.length-1;a++)h=Ce(this,l[s+a],t,a),h===X&&(h=this._$AH[a]),n||(n=!qe(h)||h!==this._$AH[a]),h===U?e=U:e!==U&&(e+=(h??"")+o[a+1]),this._$AH[a]=h}n&&!i&&this.j(e)}j(e){e===U?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Yi extends vt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===U?void 0:e}}class Zi extends vt{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==U)}}class Xi extends vt{constructor(e,t,s,i,o){super(e,t,s,i,o),this.type=5}_$AI(e,t=this){if((e=Ce(this,e,t,0)??U)===X)return;const s=this._$AH,i=e===U&&s!==U||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,o=e!==U&&(s===U||i);i&&this.element.removeEventListener(this.name,this,s),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}let eo=class{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Ce(this,e)}};const Pt=Ne.litHtmlPolyfillSupport;Pt==null||Pt(Be,as),(Ne.litHtmlVersions??(Ne.litHtmlVersions=[])).push("3.3.1");const to=(r,e,t)=>{const s=(t==null?void 0:t.renderBefore)??e;let i=s._$litPart$;if(i===void 0){const o=(t==null?void 0:t.renderBefore)??null;s._$litPart$=i=new as(e.insertBefore(He(),o),o,void 0,t??{})}return i._$AI(r),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ce=globalThis;let de=class extends fe{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=to(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return X}};var Js;de._$litElement$=!0,de.finalized=!0,(Js=ce.litElementHydrateSupport)==null||Js.call(ce,{LitElement:de});const Et=ce.litElementPolyfillSupport;Et==null||Et({LitElement:de});(ce.litElementVersions??(ce.litElementVersions=[])).push("4.2.1");const ls=Symbol.for("controller"),so=r=>typeof r=="object"&&r!==null&&(ls in r||"hostConnected"in r||"hostDisconnected"in r||"hostUpdate"in r||"hostUpdated"in r),$n=r=>typeof(r==null?void 0:r.then)=="function";let xe;const Re=r=>{xe!==r&&(xe=r,queueMicrotask(()=>xe===r?xe=void 0:0))},_t=r=>xe;let re=[];const ro=r=>{if(r===void 0){re=[];return}const e=re.indexOf(r);re=e===-1?[...re,r]:re.slice(0,e+1),queueMicrotask(()=>re=[])},io=()=>re;let ge;const In=r=>{ge!==r&&(ge=r,queueMicrotask(()=>ge===r?ge=void 0:0))},oo=()=>{const r=ge;return ge=void 0,r},no=async(r,e)=>{const t=hs(r);if(t===void 0)return r;if(await t.ready,typeof e=="function"){const s=t.watchExports(i=>e(i,s))}return t.exports},ao=async r=>{const e=hs(r);return await e.ready,e},hs=r=>{const t=_t().manager.X(r);if(t!==void 0)return t;if(so(r))return r;const s=oo();if(s!==void 0)return s};let Jt=!1;const kn=r=>{Jt=!0;try{return r()}finally{Jt=!1}},lo=(r,e,t)=>{const s=Object.keys(r),i=s.length;Y===void 0&&queueMicrotask(cs),Y??(Y=new Map);let o=Y.get(r);return o===void 0&&(o={callbacks:[],keyCount:i},Y.set(r,o)),o.keyCount!==i&&(o.callbacks.forEach(n=>n(s)),o.callbacks=[],o.keyCount=i),o.callbacks.push(n=>{const l=h=>C(e,null,h),a=n[i];a===void 0?l(void 0):r[a]===t?l(a):l(void 0)}),t};let Y;const cs=()=>{Y==null||Y.forEach(({callbacks:r},e)=>{const t=Object.keys(e);r.forEach(s=>s(t))}),Y=void 0},ho=(r,e,t)=>{const s=r.manager;return s.V!==U&&s.V!==t&&s.S(void 0,void 0),s.T.length===0&&queueMicrotask(()=>s.S(void 0,void 0)),s.V=t,s.T.push((i,o)=>C(e,void 0,t===o?i:void 0)),t},co=(r=[_t(),...io()],e,t)=>{const s=Array.isArray(r)?r:[r];let i=s.length+1;const o=n=>{i-=1,n!==void 0&&(i=Math.min(i,0)),i===0&&e(n)};s.forEach(n=>lo(n,l=>o(l===void 0?void 0:{key:l,host:n,isReactive:!1}),t));for(const n of s)if("manager"in n&&n.manager.component===n){ho(n,l=>o(l===void 0?void 0:{key:l,host:n,isReactive:!0}),t);break}return t},uo=(r="",e={},t=_t())=>{const s={emit:i=>{r===""&&cs();const o=new CustomEvent(r,{detail:i,cancelable:!0,bubbles:!0,composed:!0,...e});return t.el.dispatchEvent(o),o}};return r===""&&co(void 0,i=>r=i.key,s),s},Cn=uo.bind(null,"");var pr;pr=ls;var me,ve,ne,_e,ye,we,Se,Ae,Q,ae,O,M,B,be,rt;class po{constructor(e){I(this,be);I(this,me);I(this,ve);I(this,ne);I(this,_e);I(this,ye);I(this,we);I(this,Se);I(this,Ae);I(this,Q);I(this,ae);I(this,O);I(this,M);I(this,B);b(this,me,[]),b(this,ve,[]),b(this,ne,[]),b(this,_e,[]),b(this,ye,[]),b(this,we,[]),b(this,Se,[]),b(this,Ae,[]),b(this,Q,[]),b(this,ae,!1),this.P=new Me,this.connectedCalled=!1,this.loadedCalled=!1,this[pr]=!0,b(this,B,[]);const t=this,s=e??_t();b(t,O,s),t.ready=t.P.promise,b(t,M,Ds(t)),t.component=s,f(t,O).addController(t),f(t,O).manager===void 0||(ro(t),queueMicrotask(()=>t.catchUpLifecycle()))}catchUpLifecycle(){const{manager:e}=f(this,O);e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),f(e,ae)&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}get exports(){return f(this,M)}set exports(e){const t=f(this,M);t!==e&&(b(this,M,e),f(this,B).forEach(C),this.connectedCalled&&this.O!==!1&&f(this,O).requestUpdate(this.O,t)),this.P.resolve(e)}setProvisionalExports(e,t=!0){b(this,M,t?Ds(e):e),f(this,B).forEach(C)}watchExports(e){const t=()=>e(f(this,M));return f(this,B).push(t),()=>void f(this,B).splice(f(this,B).indexOf(t),1)}get use(){return Re(f(this,O)),no}get useRef(){return Re(f(this,O)),ao}get useRefSync(){return Re(f(this,O)),hs}controllerRemoved(){f(this,O).el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){f(this,me).push(e)}onDisconnected(e){f(this,ve).push(e)}onLoad(e){f(this,ne).push(e)}onLoaded(e){f(this,_e).push(e)}onUpdate(e){f(this,ye).push(e)}onUpdated(e){f(this,we).push(e)}onDestroy(e){f(this,Se).push(e)}onLifecycle(e){f(this,Ae).push(e),this.connectedCalled&&f(this,O).el.isConnected&&J(this,be,rt).call(this,e)}triggerConnected(){const e=this;e.hostConnected&&C(e.hostConnected,e),f(e,me).forEach(C),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&C(e.hostDisconnected,e),f(e,ve).forEach(C),f(e,Q).forEach(C),b(e,Q,[])}async triggerLoad(){if(f(this,ae))return;b(this,ae,!0);const e=this;e.hostLoad&&await Ft(e.hostLoad,e),f(this,ne).length>0&&await Promise.allSettled(f(this,ne).map(Ft)),this.P.resolve(f(this,M))}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&C(this.hostLoaded,this),f(this,_e).forEach(C),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&C(this.hostUpdate,this,e),f(this,ye).forEach(Ls,e)}triggerUpdated(e){this.hostUpdated&&C(this.hostUpdated,this,e),f(this,we).forEach(Ls,e)}triggerDestroy(){this.hostDestroy&&C(this.hostDestroy,this),f(this,Se).forEach(C)}triggerLifecycle(){this.hostLifecycle&&J(this,be,rt).call(this,()=>this.hostLifecycle()),f(this,Ae).forEach(J(this,be,rt),this)}}me=new WeakMap,ve=new WeakMap,ne=new WeakMap,_e=new WeakMap,ye=new WeakMap,we=new WeakMap,Se=new WeakMap,Ae=new WeakMap,Q=new WeakMap,ae=new WeakMap,O=new WeakMap,M=new WeakMap,B=new WeakMap,be=new WeakSet,rt=function(e){Re(f(this,O));const t=C(e);(Array.isArray(t)?t:[t]).forEach(i=>{typeof i=="function"?f(this,Q).push(i):typeof i=="object"&&typeof i.remove=="function"&&f(this,Q).push(i.remove)})};function Ls(r){C(r,void 0,this)}const fo=po,Ds=r=>{if(typeof r!="object"&&typeof r!="function"||r===null)return r;const e={get(s,i,o){if(!((i==="exports"||i==="_exports")&&i in s&&s[i]===t)&&(i in s||i in Promise.prototype||typeof i=="symbol"))return typeof s=="function"?s[i]:Reflect.get(s,i,o)}},t=new Proxy(r,e);return t},go=1,mo=2,vo=4,_o=8,yo=16,wo=32,So=64,fr=r=>{var t,s;let e=r;for(;e=e.parentNode??e.host;)if((t=e==null?void 0:e.constructor)!=null&&t.lumina){const i=e;return(s=i.manager)!=null&&s.loadedCalled||(i.J??i._offspring).push(r),(i.I??i._postLoad).promise}return!1},Ns={};function gr(){}const it=Object.defineProperty,Ao=globalThis.HTMLElement??gr;var x,z,$e,ze,Kt;const ds=class ds extends Ao{constructor(){var i,o;super();I(this,ze);I(this,x);I(this,z);I(this,$e);b(this,z,{}),b(this,$e,[]),this.I=new Me,this.H=new Me,this.J=[];const t=this,s=t.constructor;t._offspring=t.J,t._postLoad=t.I,(i=s.C)==null||i.forEach(n=>{Object.hasOwn(t,n)&&(f(t,z)[n]=t[n],delete t[n])}),s.A?J(o=t,ze,Kt).call(o,{a:s.A}):s.B.then(async n=>{var l,a;await s.K.p,J(a=t,ze,Kt).call(a,await(((l=n.default)==null?void 0:l.then(h=>typeof h=="function"?{a:h}:h))??n))}).catch(n=>{t.H.reject(n),setTimeout(()=>{throw n})})}static F(){for(const t of this.C??[])it(this.prototype,t,{configurable:!0,enumerable:!0,get(){return f(this,z)[t]},set(s){f(this,z)[t]=s}});for(const t of this.E??[])it(this.prototype,t,{async value(...s){return f(this,x)||await this.H.promise,await f(this,x)[t](...s)},configurable:!0});for(const t of this.D??[])it(this.prototype,t,{value(...s){return f(this,x)[t](...s)},configurable:!0})}get manager(){var t;return(t=f(this,x))==null?void 0:t.manager}attributeChangedCallback(t,s,i){var o;(o=f(this,x))==null||o.attributeChangedCallback(t,s,i),f(this,x)||f(this,$e).push(t)}connectedCallback(){var t,s;f(this,x)?(s=(t=f(this,x)).connectedCallback)==null||s.call(t):queueMicrotask(()=>this.G=fr(this))}disconnectedCallback(){var t,s;(s=(t=f(this,x))==null?void 0:t.disconnectedCallback)==null||s.call(t)}async componentOnReady(){return await this.H.promise,this}addController(){}requestUpdate(){var t;(t=f(this,x))==null||t.requestUpdate()}};x=new WeakMap,z=new WeakMap,$e=new WeakMap,ze=new WeakSet,Kt=function(t){var d;const s=this.constructor,i=s.L,o=f(this,z),n=Object.values(t).find(p=>p.L===i),l=`${i}--lazy`;let a=n;for(;a&&!Object.hasOwn(a,"lumina");)a=Object.getPrototypeOf(a);$o(a),!s.A&&(s.A=n,customElements.define(l,n)),n.N=this;const c=document.createElement(l);n.N=void 0,b(this,x,c),b(this,z,c),f(this,$e).forEach(p=>c.attributeChangedCallback(p,null,this.getAttribute(p))),Object.entries(o).forEach(bo,c);const u=this.isConnected;(u||this.G)&&((d=c.connectedCallback)==null||d.call(c),u||c.disconnectedCallback())},ds.lumina=!0;let js=ds;function bo([r,e]){this[r]=e}const $o=r=>{const e=r.prototype,t=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(i,o){t.setAttribute.call(this.el,i,o)},e.removeAttribute=function(i){t.removeAttribute.call(this.el,i)},it(e,"isConnected",{get(){return Reflect.get(t,"isConnected",this.el)}}))};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mr={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},vr=r=>(...e)=>({_$litDirective$:r,values:e});let _r=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Io=vr(class extends _r{constructor(r){var e;if(super(r),r.type!==mr.ATTRIBUTE||r.name!=="class"||((e=r.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(r){return" "+Object.keys(r).filter((e=>r[e])).join(" ")+" "}update(r,[e]){var s,i;if(this.st===void 0){this.st=new Set,r.strings!==void 0&&(this.nt=new Set(r.strings.join(" ").split(/\s/).filter((o=>o!==""))));for(const o in e)e[o]&&!((s=this.nt)!=null&&s.has(o))&&this.st.add(o);return this.render(e)}const t=r.element.classList;for(const o of this.st)o in e||(t.remove(o),this.st.delete(o));for(const o in e){const n=!!e[o];n===this.st.has(o)||(i=this.nt)!=null&&i.has(o)||(n?(t.add(o),this.st.add(o)):(t.remove(o),this.st.delete(o)))}return X}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const yr="important",ko=" !"+yr,Co=vr(class extends _r{constructor(r){var e;if(super(r),r.type!==mr.ATTRIBUTE||r.name!=="style"||((e=r.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(r){return Object.keys(r).reduce(((e,t)=>{const s=r[t];return s==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`}),"")}update(r,[e]){const{style:t}=r.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const s of this.ft)e[s]==null&&(this.ft.delete(s),s.includes("-")?t.removeProperty(s):t[s]=null);for(const s in e){const i=e[s];if(i!=null){this.ft.add(s);const o=typeof i=="string"&&i.endsWith(ko);s.includes("-")||o?t.setProperty(s,o?i.slice(0,-11):i,o?yr:""):t[s]=i}}return X}});var V,j,Ie;class Uo extends fo{constructor(t){super(t);I(this,V);I(this,j);I(this,Ie);this.destroyed=!1,this.R=!1,this.V=U,this.T=[],b(this,Ie,new WeakMap),b(this,j,t),this.exports=void 0,this.hasDestroy=Gt in t&&typeof t.destroy=="function",de.prototype.addController.call(t,{hostConnected:()=>{if(this.destroyed){const s=t.el.localName;throw t.el.remove(),new Error(`The ${s} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${Gt} prop.`)}f(this,V)!==void 0&&clearTimeout(f(this,V)),cs();for(const s of t.M)"triggerConnected"in s?s.triggerConnected():C(s.hostConnected,s)},hostDisconnected:()=>{for(const s of t.M)"triggerDisconnected"in s?s.triggerDisconnected():C(s.hostDisconnected,s);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const s of t.M)"triggerUpdate"in s?s.triggerUpdate(this.Q):C(s.hostUpdate,s,this.Q)},hostUpdated:()=>{for(const s of t.M)"triggerUpdated"in s?s.triggerUpdated(this.Q):C(s.hostUpdated,s,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),Re(t)}async destroy(){if(!this.destroyed){f(this,j).el.isConnected&&(this.hasDestroy=!1,f(this,j).el.remove()),b(this,V,void 0),this.destroyed=!0;for(const t of f(this,j).M)"triggerDestroy"in t?t.triggerDestroy():C(t.hostDestroy,t);f(this,j).M.splice(0)}}U(){f(this,V)!==void 0&&clearTimeout(f(this,V)),!f(this,j).el.isConnected&&!f(this,j).autoDestroyDisabled&&b(this,V,Di(()=>void f(this,j).destroy(),To))}S(t,s){const i=this.T;this.V=U,this.T=[],i.forEach(o=>o(t,s))}W(t,s){(typeof s=="object"&&s!==null||typeof s=="function")&&f(this,Ie).set(s,t)}X(t){if(typeof t=="object"&&t!==null||typeof t=="function")return f(this,Ie).get(t)}}V=new WeakMap,j=new WeakMap,Ie=new WeakMap;let To=1e3;const Gt="autoDestroyDisabled";var le,Ve,Fe,he,H,Ue,wr,Sr;const je=class je extends de{constructor(){super();I(this,Ue);I(this,le);I(this,Ve);I(this,Fe);I(this,he);I(this,H);this.M=[],this.manager=new Uo(this);const t=this,s=t.constructor,i=s.N,o=s.K.o,n=je.prototype.shouldUpdate;b(t,he,(i==null?void 0:i.H)??new Me),t.I=(i==null?void 0:i.I)??new Me,t.J=(i==null?void 0:i.J)??[],t._offspring=t.J,t._postLoad=t.I,t.el=i??t,b(t,Fe,t.enableUpdating),t.enableUpdating=gr,t.shouldUpdate!==n&&(b(t,Ve,t.shouldUpdate),t.shouldUpdate=n),o&&(b(t,le,new Map),s.elementProperties.forEach((l,a)=>f(t,le).set(a,o())))}static finalizeStyles(t){var o;const s=super.finalizeStyles(t),i=this.shadowRootOptions===Ns;return((o=this.K)==null?void 0:o.commonStyles)===void 0||i?s:[this.K.commonStyles,...s]}static createProperty(t,s){const i=typeof s=="number"?s:Array.isArray(s)?s[0]:0,o=Array.isArray(s)?s[1]:void 0,n=(o==null?void 0:o.hasChanged)??os,l={attribute:i&go&&typeof t=="string"?Ri(t):!1,reflect:!!(i&mo),type:i&vo?Boolean:i&_o?Number:void 0,state:!!(i&yo),readOnly:!!(i&wo),noAccessor:!!(i&So),c:!1,...o,hasChanged(a,h){const c=n(a,h);return l.c=c,c}};super.createProperty(t,l)}static getPropertyDescriptor(t,s,i){const o=this.K,n=super.getPropertyDescriptor(t,s,i);return i.d=n,{...n,get(){var l,a;return(l=o.t)==null||l.call(o,f(this,le).get(t)),(a=n.get)==null?void 0:a.call(this)},set(l){var h,c;const a=this.manager;if(i.readOnly&&!Jt&&(a.R||a.connectedCalled))throw Error(`Cannot assign to read-only property "${t}" of ${this.el.localName}. Trying to assign "${l}"`);n.set.call(this,l??void 0),i.c&&((c=(h=f(this,le))==null?void 0:h.get(t))==null||c.notify()),a.T.length>0&&(a==null||a.S(t,l))}}}connectedCallback(){var i,o;if(this.el.hasAttribute("defer-hydration"))return;const t=(o=(i=this.constructor.K).c)==null?void 0:o.call(i,()=>this.requestUpdate());b(this,H,t);const s=!this.manager.connectedCalled;super.connectedCallback(),s?queueMicrotask(()=>J(this,Ue,Sr).call(this).catch(n=>{f(this,he).reject(n),setTimeout(()=>{throw n})})):t&&this.requestUpdate()}disconnectedCallback(){var t;super.disconnectedCallback(),(t=f(this,H))==null||t.destroy(),b(this,H,void 0)}createRenderRoot(){const t=this.el.shadowRoot,s=this.constructor,i=s.shadowRootOptions,n=t??(i===Ns?this.el:this.el.attachShadow(i));if(t)return de.prototype.createRenderRoot.call(this),t;if(this.isConnected){const l=n.getRootNode();l.adoptedStyleSheets=[...l.adoptedStyleSheets,...s.elementStyles.map(a=>"styleSheet"in a?a.styleSheet:a)]}return n}shouldUpdate(t){var s;return this.manager.Q=t,((s=f(this,Ve))==null?void 0:s.call(this,t))??!0}update(t){f(this,H)?J(this,Ue,wr).call(this,t):super.update(t)}listen(t,s,i){const o=(s==null?void 0:s.bind(this))??s;this.manager.onLifecycle(()=>(this.el.addEventListener(t,o,i),()=>this.el.removeEventListener(t,o,i)))}listenOn(t,s,i,o){const n=(i==null?void 0:i.bind(this))??i;this.manager.onLifecycle(()=>(t.addEventListener(s,n,o),()=>t.removeEventListener(s,n,o)))}async componentOnReady(){return await f(this,he).promise,this}addController(t){var s;this.M.push(t),!(ls in t)&&this.renderRoot&&this.el.isConnected&&((s=t.hostConnected)==null||s.call(t))}removeController(t){var s;this.M.splice(this.M.indexOf(t),1),(s=t.controllerRemoved)==null||s.call(t)}};le=new WeakMap,Ve=new WeakMap,Fe=new WeakMap,he=new WeakMap,H=new WeakMap,Ue=new WeakSet,wr=function(t){try{f(this,H).clear(),this.constructor.K.r(f(this,H),()=>fs(je.prototype,this,"update").call(this,t))}catch(s){throw f(this,H).clear(),s}},Sr=async function(){var o,n;const t=this.el.G??fr(this.el);t&&await t;const s=[];for(const l of this.M)"triggerLoad"in l?s.push(l.triggerLoad()):s.push(Ft(l.hostLoad,l));await Promise.all(s),await((o=this.load)==null?void 0:o.call(this)),this.manager.hasDestroy&&this.manager.onUpdate(l=>l.has(Gt)&&this.manager.U()),f(this,Fe).call(this,!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const i=this.J.filter(l=>{var a;return!((a=l.manager)!=null&&a.loadedCalled)});i.length&&await Promise.allSettled(i.map(async l=>await l.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const l of this.M)"triggerLoaded"in l?l.triggerLoaded():C(l.hostLoaded,l);(n=this.loaded)==null||n.call(this),f(this,he).resolve()},je.lumina=!0;let Ms=je;const Po=r=>{let e;const t=i=>{var o;e=new URL(i,((o=globalThis.location)==null?void 0:o.href)||void 0).href},s={...r,getAssetPath(i){var n;const o=new URL(i,e);return o.origin!==((n=globalThis.location)==null?void 0:n.origin)?o.href:o.pathname},setAssetPath:t,customElement(i,o){o.K=s,o.L=i,customElements.get(i)||customElements.define(i,o)}};return t(r.defaultAssetPath),s},Tn=r=>typeof r=="object"&&r!=null?Io(r):r,Pn=r=>typeof r=="object"&&r!=null?Co(r):r,En=U;function On(r,e,t){t==null?r.removeAttribute(e):r.setAttribute(e,t)}const xn={toAttribute:r=>r===!0?"":r===!1?null:r};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const Eo="calcite-mode-auto",Oo="calcite-mode-dark",Rn={rtl:"calcite--rtl"},Ln={reposition:100},Dn=25;function Hs(){const{classList:r}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=()=>r.contains(Oo)||r.contains(Eo)&&e?"dark":"light",s=n=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:n}})),i=n=>{o!==n&&s(n),o=n};let o=t();s(o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>i(n.matches?"dark":"light")),new MutationObserver(()=>i(t())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const F=globalThis.calciteConfig,Nn=(F==null?void 0:F.focusTrapStack)||[],jn=(F==null?void 0:F.logLevel)||"info",qs="3.2.1",xo="2025-05-29",Ro="618973fec";function Lo(){if(F&&F.version)return;console.info(`Using Calcite Components ${qs} [Date: ${xo}, Revision: ${Ro}]`);const r=F||globalThis.calciteConfig||{};Object.defineProperty(r,"version",{value:qs,writable:!1}),globalThis.calciteConfig=r}function Do(){document.readyState==="interactive"?Hs():document.addEventListener("DOMContentLoaded",()=>Hs(),{once:!0}),Lo()}Do();const No=Po({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.2.1/",hydratedAttribute:"calcite-hydrated"}),{customElement:Mn,getAssetPath:Hn,setAssetPath:jo}=No;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */let Ar=!1;const Mo=r=>{Ar=!0,jo(r)};let br;function Ho(){Ar||Mo(Mt(jr(br)))}function qo(r){var t;const e=[];for(const s of Object.keys(r))customElements.get(`calcite-${s}`)||e.push((t=r[s])==null?void 0:t.call(r));return e.length>0?Promise.all(e):null}br="components/assets";const $r=Symbol("widget"),Ir=Symbol("widget-test-data"),Bo=[],zo={},ft=new WeakMap;function kr(r,e){let t=e.children;if(t!=null&&t.length)for(let i=0;i<t.length;++i)t[i]=kr(r,t[i]);else t=Bo;const s=e.vnodeSelector;if(gt(s)){const i=e.properties||zo,o=i.key||s,n={key:o,afterCreate:Vo,afterUpdate:Fo,afterRemoved:Cr,parentWidget:r,widgetConstructor:s,widgetProperties:{...i,key:o,children:t}};return{vnodeSelector:s.vnodeSelector,properties:n,children:void 0,text:void 0,domNode:null}}return e}function Vo(r,e,t,{parentWidget:s,widgetConstructor:i,widgetProperties:o}){var l;const n=new i(o);n.container=r,ft.set(r,n),(l=n.afterCreate)==null||l.call(n,n,r),s.addHandles(ct((()=>Cr(r)))),queueMicrotask((()=>{n[Ir].projector.renderNow()}))}function Fo(r,e,t,{widgetProperties:s}){var o;const i=ft.get(r);i&&(i.set(s),(o=i.afterUpdate)==null||o.call(i,i,r))}function Cr(r){var t;const e=ft.get(r);e&&((t=e.afterRemoved)==null||t.call(e,e,r),e.destroy(),ft.delete(r))}function gt(r){return typeof r=="function"&&r[$r]}const Bs=new Set;function Wo(r){Bs.add(r),r.finally((()=>Bs.delete(r)))}function Jo(r){return ct()}const yt=new Map;function Ur(){yt.clear()}function Ko(r){return yt.get(r)}function Go(r,e){yt.set(r,e)}function Ot(r){yt.delete(r)}function Qo(...r){const e=gs.acquire();for(let s=0;s<r.length;s++){const i=r[s],o=typeof i;if(o==="string")e.push(i);else if(Array.isArray(i))e.push.apply(e,i);else if(o==="object")for(const n in i)i[n]&&e.push(n)}const t=e.join(" ");return gs.release(e),t}(()=>{const r=new Map,e=new ResizeObserver((s=>{var i;Ur();for(const o of s)(i=r.get(o.target))==null||i(o)})),t=(s,i,o)=>(r.set(s,i),e.observe(s,o),ct((()=>{e.unobserve(s),r.delete(s)})));return(s,i,o)=>{let n=null;return qr([Ht((()=>typeof s=="function"?s():s),(l=>{n==null||n.remove(),l&&(n=t(l,i,o))}),Ks),ct((()=>n==null?void 0:n.remove()))])}})();async function Yo(r,e){await Mr(Hr(e));const t=typeof r=="function"?r():r;t&&("setFocus"in t&&typeof t.setFocus=="function"?await t.setFocus():t instanceof HTMLElement&&t.focus())}var zs;let Zo=0;function Tr(r,e){const t=Object.prototype.hasOwnProperty;for(const s in e)t.call(e,s)&&t.call(r,s)&&(r[s]!=null&&e[s]!=null&&typeof r[s]=="object"&&typeof e[s]=="object"?Tr(r[s],e[s]):r[s]=e[s]);return r}const Xo=Ai({postProcessProjectionOptions(r){const e=r.eventHandlerInterceptor,t=/capture$/i;r.eventHandlerInterceptor=(s,i,o,n)=>{const l=e==null?void 0:e(s,i,o,n),a=t.test(s);if(!((s=s.replace(t,"")).toLowerCase()in o)||a){const h=s[2].toLowerCase()+s.slice(3),c=p=>l==null?void 0:l.call(o,p);o.addEventListener(h,c,a);const u=()=>o.removeEventListener(h,c,a),d=n.afterRemoved;n.afterRemoved=p=>{d==null||d(p),u()}}return l}},handleInterceptedEvent(r,e,t,s){const{eventPhase:i,type:o}=s,n=i===Event.CAPTURING_PHASE;let l=`on${o}${n?"capture":""}`;const a=e.properties;(a&&l in a||(l=`on${o[0].toUpperCase()}${o.slice(1)}${n?"Capture":""}`,a&&l in a))&&(Ur(),r.scheduleRender(),a[l].call(a.bind||t,s))}});let xt=!1;var ue;let P=(ue=class extends Br.EsriPromiseMixin(Xt.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=Xo,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=zr((async()=>{var a;if((a=this._messageBundleProps)!=null&&a.length){const h=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let d=await Vr(c);this.uiStrings&&Object.keys(this.uiStrings)&&(d=Tr(Fr(d),this.uiStrings)),this[u]=d})));if(this.destroyed)return;for(const c of h)c.status==="rejected"&&jt.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()})),this.addHandles(Jo()),Ho();const s="esri-widget-uid-"+Wr(),i=this.render.bind(this);this._trackingTarget=new Jr((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const o=()=>({vnodeSelector:"div",properties:{key:`${s}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),n=()=>{var u,d;if(!this._readyForTrueRender||this.destroyed)return null;const a=i()??o(),h=a.properties??(a.properties={});if(h.key??(h.key=s),gt(a.vnodeSelector)){if(!this.visible)return o()}else this.visible?h.styles||(h.styles={}):(h.class="",h.styles={display:"none"}),(u=h.styles).display??(u.display="");let c=0;return(d=a.children)==null||d.forEach((p=>{var g;gt(p.vnodeSelector)||(p.properties??(p.properties={}),(g=p.properties).key??(g.key=`${this.id}--${c++}`))})),kr(this,a)};this.render=()=>{if(xt)return n();let a=Ko(this)??null;if(a)return a;this._trackingTarget.clear(),xt=!0;try{a=Kr(this._trackingTarget,n)}catch(h){throw jt.getLogger(this).error(h),h}finally{xt=!1}return a&&Go(this,a),a};const l=this.beforeFirstRender();l?this._resourcesFetch=l.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Wo(this._resourcesFetch)}normalizeCtorArgs(e,t){const s={...e};return t&&(s.container=t),s}postInitialize(){}beforeFirstRender(){var t;const e=this.loadDependencies();return(t=this._messageBundleProps)!=null&&t.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(ms):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(vs(this._trackingTarget),vs(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,Ot(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return hi(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+Zo++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(zs=$r,Ir)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Ot(this),this._projector.scheduleRender())}classes(...e){return Qo.apply(this,e)}renderNow(){Ot(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this.addHandles(Ht((()=>this.viewModel),((s,i)=>{i&&this.removeHandles("delegated-events"),s&&Gr(s)&&this.addHandles(this._delegatedEventNames.map((o=>tt(s,o,(n=>{this.emit(o,n)})))),"delegated-events")}),Ks)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(ms),this.scheduleRender()};this.addHandles([Qr(e),Ht((()=>this.uiStrings),e)]),this.addHandles(Yr((()=>this.container),(s=>{this.destroyed||this._attach(s)}),{initial:!0,once:!0}))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}},ue[zs]=!0,ue.vnodeSelector="div",ue);m([v()],P.prototype,"_readyForTrueRender",void 0),m([v({value:null})],P.prototype,"container",null),m([Zr("container")],P.prototype,"castContainer",null),m([v()],P.prototype,"icon",null),m([v()],P.prototype,"id",null),m([v()],P.prototype,"label",null),m([v()],P.prototype,"renderable",null),m([v()],P.prototype,"uiStrings",void 0),m([v()],P.prototype,"viewModel",void 0),m([v({value:!0})],P.prototype,"visible",null),m([v()],P.prototype,"key",void 0),m([v()],P.prototype,"children",void 0),m([v()],P.prototype,"afterCreate",void 0),m([v()],P.prototype,"afterUpdate",void 0),m([v()],P.prototype,"afterRemoved",void 0),P=m([We("esri.widgets.Widget")],P);const en=P;function Vs(r){return(e,t)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:r,propertyName:t})}}var tn=function(r){return{vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}},Pr=function(r,e){for(var t=0,s=r.length;t<s;t++){var i=r[t];Array.isArray(i)?Pr(i,e):i!=null&&i!==!1&&(i.hasOwnProperty("vnodeSelector")||(i=tn(i)),e.push(i))}},sn=function(r,e){for(var t=[],s=2;s<arguments.length;s++)t[s-2]=arguments[s];if(t.length===1&&typeof t[0]=="string")return{vnodeSelector:r,properties:e||void 0,children:void 0,text:t[0],domNode:null};var i=[];return Pr(t,i),{vnodeSelector:r,properties:e||void 0,children:i,text:void 0,domNode:null}};function N(r,e,...t){return typeof r!="function"||gt(r)?sn(r,e??null,...t):r(e,...t)}const rn="calcite-mode-",on="dark",nn="light",an=/\W/g,ln="--esri-calcite-mode-name";function hn(){return getComputedStyle(document.body).getPropertyValue(ln).replaceAll(an,"").toLowerCase()}function cn(){const r=hn();switch(r){case on:case nn:return`${rn}${r}`;default:return null}}const Rt="esri-identity-modal",Lt={base:Rt,info:`${Rt}__info`,notice:`${Rt}__notice`},dn="ArcGIS Online";let L=class extends en{constructor(r,e){super(r,e),this.container=document.createElement("div"),this.error=null,this.oAuthPrompt=!1,this.open=!1,this.signingIn=!1,this.server=null,this.resource=null,this._usernameInputNode=null,this._passwordInputNode=null,document.body.appendChild(this.container)}loadDependencies(){return qo({button:()=>Te(()=>import("./index-DM3E7zfv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),dialog:()=>Te(()=>import("./index-Cp1weyCC.js"),__vite__mapDeps([10,1,2,3,11,4,12,13,7,8,9]),import.meta.url),input:()=>Te(()=>import("./index-o_F49Ot3.js"),__vite__mapDeps([14,2,3,11,4,5,6,7,8,9]),import.meta.url),label:()=>Te(()=>import("./index-DsEdFNTP.js"),__vite__mapDeps([15,6,3,7,8,9]),import.meta.url),notice:()=>Te(()=>import("./index-x-kuVGlT.js"),__vite__mapDeps([16,2,3,13,7,8,9]),import.meta.url)})}get title(){var r;return(r=this.commonMessages)==null?void 0:r.auth.signIn}render(){var R;const{open:r,title:e,messages:t,signingIn:s,oAuthPrompt:i,server:o,resource:n,error:l}=this,{info:a,oAuthInfo:h,lblItem:c,invalidUser:u,noAuthService:d,lblUser:p,lblPwd:g,lblCancel:_,lblSigning:y,lblOk:w}=t;return N("div",{class:this.classes(Lt.base,cn())},N("form",{bind:this,onsubmit:this._submit},N("calcite-dialog",{bind:this,heading:e,modal:!0,open:r,outsideCloseDisabled:!0,scale:"s",widthScale:"s",onCalciteDialogClose:this._cancel,onCalciteDialogOpen:this._focusUsernameInput},N("div",{class:Lt.info},oi(i?h:a,{server:o&&/\.arcgis\.com/i.test(o)?dn:o,resource:`(${n||c})`})),l?N("calcite-notice",{class:Lt.notice,icon:"exclamation-mark-triangle",kind:"danger",open:!0},N("div",{slot:"message"},(R=l.details)!=null&&R.httpStatus?u:d)):null,i?null:[N("calcite-label",null,p,N("calcite-input",{afterCreate:ee=>this._usernameInputNode=ee,autocomplete:"off",bind:this,name:"username",required:!0,spellcheck:!1,type:"text",value:""})),N("calcite-label",null,g,N("calcite-input",{afterCreate:ee=>this._passwordInputNode=ee,bind:this,name:"password",required:!0,type:"password",value:""}))],N("calcite-button",{appearance:"outline",bind:this,onclick:this._cancel,slot:"footer-end",type:"button"},_),N("calcite-button",{loading:!!s,slot:"footer-end",type:"submit"},s?y:w))))}_focusUsernameInput(){return Yo((()=>this._usernameInputNode))}_cancel(){this._set("signingIn",!1),this.open=!1,this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(r){var t,s;r.preventDefault(),this._set("signingIn",!0);const e=this.oAuthPrompt?{}:{username:(t=this._usernameInputNode)==null?void 0:t.value,password:(s=this._passwordInputNode)==null?void 0:s.value};this.emit("submit",e)}};m([v({readOnly:!0})],L.prototype,"container",void 0),m([v(),Vs("esri/t9n/common")],L.prototype,"commonMessages",void 0),m([v()],L.prototype,"error",void 0),m([v(),Vs("esri/identity/t9n/identity")],L.prototype,"messages",void 0),m([v()],L.prototype,"oAuthPrompt",void 0),m([v()],L.prototype,"open",void 0),m([v()],L.prototype,"signingIn",void 0),m([v()],L.prototype,"server",void 0),m([v({readOnly:!0})],L.prototype,"title",null),m([v()],L.prototype,"resource",void 0),L=m([We("esri.identity.IdentityModal")],L);const Fs=L,Dt="esriJSAPIOAuth";class Qt{constructor(e,t){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=t,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const t=Date.now();this.expires>t&&(this.expires-t)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),t=this.oAuthInfo;if(t!=null&&t.authNamespace&&t.portalUrl){let s=e[t.authNamespace];s||(s=e[t.authNamespace]={}),this.appId||(this.appId=t.appId),s[t.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(Dt,JSON.stringify(e))}catch(i){return console.warn(i),!1}return!0}return!1}destroy(){const e=this._load(),t=this.oAuthInfo;if(t!=null&&t.appId&&(t!=null&&t.portalUrl)&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const s=t.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.refreshToken||this.token),i.append("client_id",t.appId),i.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(s,i);else{const o=new XMLHttpRequest;o.open("POST",s),o.send(i)}}if(t!=null&&t.authNamespace&&t.portalUrl&&this.storage){const s=e[t.authNamespace];if(s){delete s[t.portalUrl];try{this.storage.setItem(Dt,JSON.stringify(e))}catch(i){console.log(i)}}}t&&(t._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),t=this.oAuthInfo;if(t!=null&&t.authNamespace&&t.portalUrl){let s=e[t.authNamespace];s&&(s=s[t.portalUrl],s&&(this.appId=s.appId,this.codeVerifier=s.codeVerifier,this.expires=s.expires,this.refreshToken=s.refreshToken,this.ssl=s.ssl,this.stateUID=s.stateUID,this.token=s.token,this.userId=s.userId))}}_load(){let e={};if(this.storage){const t=this.storage.getItem(Dt);if(t)try{e=JSON.parse(t)}catch(s){console.warn(s)}}return e}}Qt.prototype.declaredClass="esri.identity.OAuthCredential";var Yt,ke;let E=(ke=class extends Gs{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return Yt.fromJSON(this.toJSON())}},Yt=ke,ke);m([v({json:{write:!0}})],E.prototype,"appId",void 0),m([v({json:{write:!0}})],E.prototype,"authNamespace",void 0),m([v({json:{write:!0}})],E.prototype,"expiration",void 0),m([v({json:{write:!0}})],E.prototype,"flowType",void 0),m([v({json:{write:!0}})],E.prototype,"forceLogin",void 0),m([v({json:{write:!0}})],E.prototype,"forceUserId",void 0),m([v({json:{write:!0}})],E.prototype,"locale",void 0),m([v({json:{write:!0}})],E.prototype,"minTimeUntilExpiration",void 0),m([v({json:{write:!0}})],E.prototype,"popup",void 0),m([v({json:{write:!0}})],E.prototype,"popupCallbackUrl",void 0),m([v({json:{write:!0}})],E.prototype,"popupWindowFeatures",void 0),m([v({json:{write:!0}})],E.prototype,"portalUrl",void 0),m([v({json:{write:!0}})],E.prototype,"preserveUrlHash",void 0),m([v({json:{write:!0}})],E.prototype,"userId",void 0),E=Yt=m([We("esri.identity.OAuthInfo")],E);const Ws=E;let D=class extends Gs{constructor(r){super(r),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};m([v({json:{write:!0}})],D.prototype,"adminTokenServiceUrl",void 0),m([v({json:{write:!0}})],D.prototype,"currentVersion",void 0),m([v({json:{write:!0}})],D.prototype,"hasPortal",void 0),m([v({json:{write:!0}})],D.prototype,"hasServer",void 0),m([v({json:{write:!0}})],D.prototype,"owningSystemUrl",void 0),m([v({json:{write:!0}})],D.prototype,"owningTenant",void 0),m([v({json:{write:!0}})],D.prototype,"server",void 0),m([v({json:{write:!0}})],D.prototype,"shortLivedTokenValidity",void 0),m([v({json:{write:!0}})],D.prototype,"tokenServiceUrl",void 0),m([v({json:{write:!0}})],D.prototype,"webTierAuth",void 0),D=m([We("esri.identity.ServerInfo")],D);const Nt=D,ot={},Er=r=>{const e=new ie(r.owningSystemUrl).host,t=new ie(r.server).host,s=/.+\.arcgis\.com$/i;return s.test(e)&&s.test(t)},Zt=(r,e)=>!!(Er(r)&&e&&e.some((t=>t.test(r.server))));let nt=null,at=null;try{nt=window.localStorage,at=window.sessionStorage}catch{}class Or extends Xt{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=At(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^/]+\/[^/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^/]+).*/i,this._gwItem=/http.+\/items\/([^/]+).*/i,this._gwGroup=/http.+\/groups\/([^/]+).*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getPlatformSelfError=null,this._getOAuthLocationParams(),window.addEventListener("pageshow",(e=>{this._pageShowHandler(e)}))}registerServers(e){const t=this.serverInfos;t?(e=e.filter((s=>!this.findServerInfo(s.server))),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach((s=>{s.owningSystemUrl&&this._portals.push(s.owningSystemUrl),s.hasPortal&&this._portals.push(s.server)}))}registerOAuthInfos(e){const t=this.oAuthInfos;if(t){for(const s of e){const i=this.findOAuthInfo(s.portalUrl);i&&t.splice(t.indexOf(i),1)}this.oAuthInfos=t.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),s=this._isServerRsrc(t);let i,o=this.findServerInfo(t),n=!0;o||(o=new Nt,o.server=this._getServerInstanceRoot(t),s?o.hasServer=!0:(o.tokenServiceUrl=this._getTokenSvcUrl(t),o.hasPortal=!0),this.registerServers([o])),i=this._findCredential(t),i?(delete e.server,Object.assign(i,e),n=!1):(i=new k({userId:e.userId,server:o.server??void 0,token:e.token,expires:e.expires,ssl:e.ssl,scope:s?"server":"portal"}),i.resources=[t],this.credentials.push(i)),i.emitTokenChange(!1),n||i.refreshServerTokens()}toJSON(){return Qs({serverInfos:this.serverInfos.map((e=>e.toJSON())),oAuthInfos:this.oAuthInfos.map((e=>e.toJSON())),credentials:this.credentials.map((e=>e.toJSON()))})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const t=e.serverInfos,s=e.oAuthInfos,i=e.credentials;if(t){const o=[];t.forEach((n=>{n.server&&n.tokenServiceUrl&&o.push(n.declaredClass?n:new Nt(n))})),o.length&&this.registerServers(o)}if(s){const o=[];s.forEach((n=>{n.appId&&o.push(n.declaredClass?n:new Ws(n))})),o.length&&this.registerOAuthInfos(o)}i&&i.forEach((o=>{o.server&&o.token&&o.expires&&o.expires>Date.now()&&((o=o.declaredClass?o:new k(o)).emitTokenChange(),this.credentials.push(o))}))}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.serverInfos)if(this._hasSameServerInstance(s.server,e)){t=s;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.oAuthInfos)if(this._hasSameServerInstance(s.portalUrl,e)){t=s;break}return t}findCredential(e,t){if(!e)return;let s;e=this._sanitizeUrl(e);const i=this._isServerRsrc(e)?"server":"portal";if(t){for(const o of this.credentials)if(this._hasSameServerInstance(o.server,e)&&t===o.userId&&o.scope===i){s=o;break}}else for(const o of this.credentials)if(this._hasSameServerInstance(o.server,e)&&this._getIdenticalSvcIdx(e,o)!==-1&&o.scope===i){s=o;break}return s}getCredential(e,t){var p;let s,i=!1,o=!0;t&&(i=!(!t.token&&!t.credential),s=t.error,o=t.prompt!==!1),t={...t},e=this._sanitizeUrl(e);const n=new AbortController,l=Ge();if(t.signal&&Pe(t.signal,(()=>{n.abort()})),Pe(n,(()=>{l.reject(new T("identity-manager:user-aborted","ABORTED"))})),Xr(n))return l.promise;t.signal=n.signal;const a=this._isAdminResource(e),h=i?this.findCredential(e):null;let c;if(h&&((p=s==null?void 0:s.details)==null?void 0:p.httpStatus)===498)h.destroy();else if(h)return c=new T("identity-manager:not-authorized","You are currently signed in as: '"+h.userId+"'. You do not have access to this resource: "+e,{error:s}),l.reject(c),l.promise;const u=this._findCredential(e,t);if(u)return l.resolve(u),l.promise;let d=this.findServerInfo(e);if(d)!d.hasPortal&&d.server&&d.owningSystemUrl&&this._hasSameServerInstance(d.server,d.owningSystemUrl)&&(d.hasPortal=!0),!d.hasServer&&this._isServerRsrc(e)&&(d._restInfoPms=this._getTokenSvcUrl(e),d.hasServer=!0);else{const g=this._getTokenSvcUrl(e);if(!g)return c=new T("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),l.reject(c),l.promise;d=new Nt,d.server=this._getServerInstanceRoot(e),typeof g=="string"?(d.tokenServiceUrl=g,d.hasPortal=!0):(d._restInfoPms=g,d.hasServer=!0),this.registerServers([d])}return d.hasPortal&&d._selfReq===void 0&&(o||K(d.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((g=>g.tokenServiceUrl===d.tokenServiceUrl)))&&(d._selfReq={owningTenant:t==null?void 0:t.owningTenant,selfDfd:this._getPortalSelf(d.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,d,t,l,a)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,t,s){const i=this._rePortalTokenSvc.test(e.tokenServiceUrl),o=new ie(this._appOrigin),n=e.shortLivedTokenValidity;let l,a,h,c,u,d,p,g;t&&(g=this.tokenValidity||n||this._defaultTokenValidity,g>n&&n>0&&(g=n)),s&&(l=s.isAdmin,a=s.serverUrl,h=s.token,d=s.signal,p=s.ssl,e.customParameters=s.customParameters),l?c=e.adminTokenServiceUrl:(c=e.tokenServiceUrl,u=new ie(c.toLowerCase()),e.webTierAuth&&(s!=null&&s.serverUrl)&&!p&&o.scheme==="http"&&(K(o.uri,c,!0)||u.scheme==="https"&&o.host===u.host&&o.port==="7080"&&u.port==="7443")&&(c=c.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:t==null?void 0:t.username,password:t==null?void 0:t.password,serverUrl:a,token:h,expiration:g,referer:l||i?this._appOrigin:null,client:l?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,s),signal:d,...s==null?void 0:s.ioArgs};return i||(_.withCredentials=!1),q(c,_).then((y=>{const w=y.data;if(!(w!=null&&w.token))return new T("identity-manager:authentication-failed","Unable to generate token");const R=e.server;return ot[R]||(ot[R]={}),t&&(ot[R][t.username]=t.password),w.validity=g,w}))}isBusy(){return!!this._busy}async checkSignInStatus(e){return(await this.checkAppAccess(e,"")).credential}checkAppAccess(e,t,s){let i=!1;return this.getCredential(e,{prompt:!1}).then((o=>{let n;const l={f:"json"};if(o.scope==="portal")if(t&&(this._doPortalSignIn(e)||s!=null&&s.force))n=o.server+"/sharing/rest/oauth2/validateAppAccess",l.client_id=t;else{if(!o.token)return{credential:o};n=o.server+"/sharing/rest"}else{if(!o.token)return{credential:o};n=o.server+"/rest/services"}return o.token&&(l.token=o.token),q(n,{query:l,authMode:"anonymous"}).then((a=>{if(a.data.valid===!1)throw new T("identity-manager:not-authorized",`You are currently signed in as: '${o.userId}'.`,a.data);return i=!!a.data.viewOnlyUserTypeApp,{credential:o}})).catch((a=>{var c;if(a.name==="identity-manager:not-authorized")throw a;const h=(c=a.details)==null?void 0:c.httpStatus;if(h===498)throw o.destroy(),new T("identity-manager:not-authenticated","User is not signed in.");if(h===400)throw new T("identity-manager:invalid-request","Bad request");return{credential:o}}))})).then((o=>({credential:o.credential,viewOnly:i})))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.slice(1)),this._processOAuthPopupParams(Qe(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,s={}){const i=Ge(),o=()=>{var c;a==null||a.remove(),h==null||h.remove(),(c=this.dialog)==null||c.destroy(),this.dialog=a=h=null},n=()=>{o(),this._oAuthDfd=null,i.reject(new T("identity-manager:user-aborted","ABORTED"))};s.signal&&Pe(s.signal,(()=>{n()}));const l=new Fs({open:!0,resource:this.getResourceName(e),server:t.server});this.dialog=l,this.emit("dialog-create");let a=l.on("cancel",n),h=l.on("submit",(c=>{this.generateToken(t,c,{isAdmin:s.isAdmin,signal:s.signal}).then((u=>{o();const d=new k({userId:c.username,server:t.server??void 0,token:u.token,expires:u.expires!=null?Number(u.expires):null,ssl:!!u.ssl,isAdmin:s.isAdmin,validity:u.validity});i.resolve(d)})).catch((u=>{l.error=u,l.signingIn=!1}))}));return i.promise}oAuthSignIn(e,t,s,i){this._oAuthDfd=Ge();const o=this._oAuthDfd;let n;i!=null&&i.signal&&Pe(i.signal,(()=>{const d=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;d&&!d.closed?d.close():this.dialog&&c()})),o.resUrl_=e,o.sinfo_=t,o.oinfo_=s;const l=s._oAuthCred;if(l.storage&&(s.flowType==="authorization-code"||s.flowType==="auto"&&t.currentVersion>=8.4)){let d=crypto.getRandomValues(new Uint8Array(32));n=bt(d),l.codeVerifier=n,d=crypto.getRandomValues(new Uint8Array(32)),l.stateUID=bt(d),l.save()||(l.codeVerifier=n=null)}else l.codeVerifier=null;let a,h;this._getCodeChallenge(n).then((d=>{const p=!i||i.oAuthPopupConfirmation!==!1;if(!s.popup||!p)return void this._doOAuthSignIn(e,t,s,d);const g=new Fs({oAuthPrompt:!0,server:t.server,open:!0});this.dialog=g,this.emit("dialog-create"),a=g.on("cancel",c),h=g.on("submit",(()=>{u(),this._doOAuthSignIn(e,t,s,d)}))}));const c=()=>{u(),this._oAuthDfd=null,o.reject(new T("identity-manager:user-aborted","ABORTED"))},u=()=>{var d;a==null||a.remove(),h==null||h.remove(),(d=this.dialog)==null||d.destroy(),this.dialog=null};return o.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach((e=>{e.destroy()})),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=tt(window,"message",(t=>{var s;if((t.origin===this._appOrigin||t.origin.endsWith(".arcgis.com"))&&((s=t.data)==null?void 0:s.type)==="arcgis:auth:requestCredential"){const i=t.source;this.getCredential(e).then((o=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:o.expires,server:o.server,ssl:o.ssl,token:o.token,userId:o.userId}},t.origin)})).catch((o=>{i.postMessage({type:"arcgis:auth:error",error:{name:o.name,message:o.message}},t.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){var s,i;let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.slice(1));const o=Qe(e);let n=!1;if(o.access_token&&o.expires_in&&o.state&&o.hasOwnProperty("username"))try{o.state=JSON.parse(o.state),o.state.portalUrl&&(this._oAuthLocationParams=o,n=!0)}catch{}else if(o.error&&o.error_description&&(console.log("IdentityManager OAuth Error: ",o.error," - ",o.error_description),o.error==="access_denied"&&(n=!0,o.state)))try{o.state=JSON.parse(o.state)}catch{}n&&(window.location.hash=((s=o.state)==null?void 0:s.hash)||"")}let t=window.location.search;if(t){t.charAt(0)==="?"&&(t=t.slice(1));const o=Qe(t);let n=!1;if(o.code&&o.state)try{o.state=JSON.parse(o.state),o.state.portalUrl&&o.state.uid&&(this._oAuthLocationParams=o,n=!0)}catch{}else if(o.error&&o.error_description&&(console.log("IdentityManager OAuth Error: ",o.error," - ",o.error_description),o.error==="access_denied"&&(n=!0,o.state)))try{o.state=JSON.parse(o.state)}catch{}if(n){const l={...o};["code","error","error_description","message_code","persist","state"].forEach((c=>{delete l[c]}));const a=_s(l),h=window.location.pathname+(a?`?${a}`:"")+(((i=o.state)==null?void 0:i.hash)||"");window.history.replaceState(window.history.state,"",h)}}}_getOAuthToken(e,t,s,i,o){return e=e.replace(/^http:/i,"https:"),q(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:i&&o?{grant_type:"authorization_code",code:t,redirect_uri:i,client_id:s,code_verifier:o}:{grant_type:"refresh_token",refresh_token:t,client_id:s}}).then((n=>n.data))}async _getCodeChallenge(e){if(e&&globalThis.isSecureContext){const t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",t);return bt(new Uint8Array(s))}return null}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const t=new T("identity-manager:user-aborted","ABORTED");this._errbackFunc(t)}}_findCredential(e,t){let s,i,o,n,l=-1;const a=t==null?void 0:t.token,h=t==null?void 0:t.resource,c=this._isServerRsrc(e)?"server":"portal",u=this.credentials.filter((d=>this._hasSameServerInstance(d.server,e)&&d.scope===c));if(e=h||e,u.length)if(u.length===1){if(s=u[0],o=this.findServerInfo(s.server),i=o==null?void 0:o.owningSystemUrl,n=i?this.findCredential(i,s.userId):void 0,l=this._getIdenticalSvcIdx(e,s),!a)return l===-1&&s.resources.push(e),this._addResource(e,n),s;l!==-1&&(s.resources.splice(l,1),this._removeResource(e,n))}else{let d,p;if(u.some((g=>(p=this._getIdenticalSvcIdx(e,g),p!==-1&&(d=g,o=this.findServerInfo(d.server),i=o==null?void 0:o.owningSystemUrl,n=i?this.findCredential(i,d.userId):void 0,l=p,!0)))),a)d&&(d.resources.splice(l,1),this._removeResource(e,n));else if(d)return this._addResource(e,n),d}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t){for(const s of this.oAuthInfos)if(this._isIdProvider(s.portalUrl,e)){t=s;break}}return t}_addResource(e,t){t&&this._getIdenticalSvcIdx(e,t)===-1&&t.resources.push(e)}_removeResource(e,t){let s=-1;t&&(s=this._getIdenticalSvcIdx(e,t),s>-1&&t.resources.splice(s,1))}_useProxy(e,t){return(t==null?void 0:t.isAdmin)&&!K(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!K(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const t=new ie(e);return t.scheme+"://"+t.host+(t.port!=null?":"+t.port:"")}_getServerInstanceRoot(e){const t=e.toLowerCase();let s=t.indexOf(this._agsRest);return s===-1&&this._isAdminResource(e)&&(s=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),s!==-1||ei(t)||(s=t.indexOf("/sharing")),s===-1&&t.endsWith("/")&&(s=t.length-1),s>-1?e.slice(0,s):e}_hasSameServerInstance(e,t){return e.endsWith("/")&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=ys(e),t=ys(t),(e=e.slice(Math.max(0,e.indexOf(":"))))===(t=t.slice(Math.max(0,t.indexOf(":"))))}_sanitizeUrl(e){const t=($t.request.proxyUrl||"").toLowerCase(),s=t?e.toLowerCase().indexOf(t+"?"):-1;return s!==-1&&(e=e.slice(s+t.length+1)),e=ti(e),At(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let s=!1;if(this._isRESTService(e)&&this._isRESTService(t)){const i=this._getSuffix(e).toLowerCase(),o=this._getSuffix(t).toLowerCase();if(s=i===o,!s){const n=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;s=i.replaceAll(n,"$1")===o.replaceAll(n,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(t)?s=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(s=!0);return s}_isPortalDomain(e){const t=new ie(e.toLowerCase()),s=this._portalConfig;let i=this._gwDomains.some((o=>o.regex.test(t.uri)));return!i&&s&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),t.uri)),i||$t.portalUrl&&(i=K(t,$t.portalUrl,!0)),i||(i=this._portals.some((o=>this._hasSameServerInstance(o,t.uri)))),i=i||this._agsPortal.test(t.path),i}_isIdProvider(e,t){let s=-1,i=-1;this._gwDomains.forEach(((n,l)=>{s===-1&&n.regex.test(e)&&(s=l),i===-1&&n.regex.test(t)&&(i=l)}));let o=!1;if(s>-1&&i>-1&&(s===0||s===4?i!==0&&i!==4||(o=!0):s===1?i!==1&&i!==2||(o=!0):s===2?i===2&&(o=!0):s===3&&i===3&&(o=!0)),!o){const n=this.findServerInfo(t),l=n==null?void 0:n.owningSystemUrl;l&&Er(n)&&this._isPortalDomain(l)&&this._isIdProvider(e,l)&&(o=!0)}return o}_getIdenticalSvcIdx(e,t){let s=-1;for(let i=0;i<t.resources.length;i++){const o=t.resources[i];if(this._isIdenticalService(e,o)){s=i;break}}return s}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let t,s,i;if(this._isRESTService(e)||this._isAdminResource(e)){const o=this._getServerInstanceRoot(e);return t=o+"/admin/generateToken",s=q(e=o+"/rest/info",{query:{f:"json"}}).then((n=>n.data)),{adminUrl:t,promise:s}}if(this._isPortalDomain(e)){let o="";if(this._gwDomains.some((n=>(n.regex.test(e)&&(o=n.tokenServiceUrl),!!o))),o||this._portals.some((n=>(this._hasSameServerInstance(n,e)&&(o=n+this._gwTokenUrl),!!o))),o||(i=e.toLowerCase().indexOf("/sharing"),i!==-1&&(o=e.slice(0,i)+this._gwTokenUrl)),o||(o=this._getOrigin(e)+this._gwTokenUrl),o){const n=new ie(e).port;/^http:\/\//i.test(e)&&n==="7080"&&(o=o.replace(/:7080/i,":7443")),o=o.replace(/http:/i,"https:")}return o}}_processOAuthResponseParams(e,t,s){const i=t._oAuthCred;if(e.code){const n=i.codeVerifier;return i.codeVerifier=null,i.stateUID=null,i.save(),this._getOAuthToken(s.server,e.code,t.appId,this._getRedirectURI(t,!0),n).then((l=>{const a=new k({userId:l.username,server:s.server??void 0,token:l.access_token,expires:Date.now()+1e3*l.expires_in,ssl:l.ssl,oAuthState:e.state,_oAuthCred:i});return t.userId=a.userId,i.storage=l.persist?nt:at,i.refreshToken=l.refresh_token,i.token=null,i.expires=l.refresh_token_expires_in?Date.now()+1e3*l.refresh_token_expires_in:null,i.userId=a.userId,i.ssl=a.ssl,i.save(),a}))}const o=new k({userId:e.username,server:s.server??void 0,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:i});return t.userId=o.userId,i.storage=e.persist?nt:at,i.refreshToken=null,i.token=o.token,i.expires=o.expires,i.userId=o.userId,i.ssl=o.ssl,i.save(),Promise.resolve(o)}_processOAuthPopupParams(e){var s;const t=this._oAuthDfd;if(this._oAuthDfd=null,t)if(clearInterval(this._oAuthIntervalId),(s=this._oAuthOnPopupHandle)==null||s.remove(),e.error){const i=e.error==="access_denied",o=new T(i?"identity-manager:user-aborted":"identity-manager:authentication-failed",i?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);t.reject(o)}else this._processOAuthResponseParams(e,t.oinfo_,t.sinfo_).then((i=>{t.resolve(i)})).catch((i=>{t.reject(i)}))}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.slice(1)),this._processOAuthPopupParams(Qe(e)))}async _exchangeToken(e,t,s){return(await q(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:t,token:s}})).data.token}async _getPlatformSelf(e,t){var s;if(this._getPlatformSelfError&&Date.now()-this._getPlatformSelfError[1]<1e3)throw this._getPlatformSelfError[0];e=e.replace(/^http:/i,"https:");try{const i=await q(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":t,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0});return this._getPlatformSelfError=null,i.data}catch(i){throw((s=i.details)==null?void 0:s.messageCode)==="OAUTH_0066"&&(this._getPlatformSelfError=[i,Date.now()]),i}}_getPortalSelf(e,t){let s;return this._gwDomains.some((i=>(i.regex.test(e)&&(s=i.customBaseUrl),!!s))),s?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:s,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),q(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then((i=>i.data)))}_doPortalSignIn(e){const t=this._portalConfig,s=window.location.href,i=this.findServerInfo(e);return!(!t&&!this._isPortalDomain(s)||!(i?i.hasPortal||i.owningSystemUrl&&this._isPortalDomain(i.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(s,e)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),e)||this._isIdProvider(t.restBaseUrl,e))||K(s,e,!0)))}_checkProtocol(e,t,s,i){let o=!0;const n=i?t.adminTokenServiceUrl:t.tokenServiceUrl;return n.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&si(n)&&(o=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!o)&&s(new T("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),o}_enqueue(e,t,s,i,o,n){return i||(i=Ge()),i.resUrl_=e,i.sinfo_=t,i.options_=s,i.admin_=o,i.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(i)):this._xoReqs.push(i):this._doSignIn(i),i.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=h=>{var y;const c=(y=e.options_)==null?void 0:y.resource,u=e.resUrl_,d=e.refresh_;let p=!1;this.credentials.includes(h)||(d&&this.credentials.includes(d)?(d.userId=h.userId,d.token=h.token,d.expires=h.expires,d.validity=h.validity,d.ssl=h.ssl,d.creationTime=h.creationTime,p=!0,h=d):this.credentials.push(h)),h.resources||(h.resources=[]),h.resources.includes(c||u)||h.resources.push(c||u),h.scope=this._isServerRsrc(u)?"server":"portal",h.emitTokenChange();const g=this._soReqs,_={};this._soReqs=[],g.forEach((w=>{if(!this._isIdenticalService(u,w.resUrl_)){const R=this._getSuffix(w.resUrl_);_[R]||(_[R]=!0,h.resources.push(w.resUrl_))}})),e.resolve(h),g.forEach((w=>{this._hasSameServerInstance(this._getServerInstanceRoot(u),w.resUrl_)?w.resolve(h):this._soReqs.push(w)})),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,p||this.emit("credential-create",{credential:h}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=h=>{e.reject(h),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=(h,c,u,d)=>{var R,ee,wt;const p=e.sinfo_,g=!e.options_||e.options_.prompt!==!1,_=p.hasPortal&&this._findOAuthInfo(e.resUrl_);let y,w;if(h)t(new k({userId:h,server:p.server??void 0,token:u??void 0,expires:d!=null?Number(d):null,ssl:!!c}));else if(window!==window.parent&&((R=this._appUrlObj.query)!=null&&R["arcgis-auth-origin"])&&((ee=this._appUrlObj.query)!=null&&ee["arcgis-auth-portal"])&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const $=tt(window,"message",(S=>{S.source===window.parent&&S.data&&(S.data.type==="arcgis:auth:credential"?($.remove(),S.data.credential.expires<Date.now()?s(new T("identity-manager:credential-request-failed","Parent application's token has expired.")):t(new k(S.data.credential))):S.data.type==="arcgis:auth:error"&&($.remove(),S.data.error.name==="tokenExpiredError"?s(new T("identity-manager:credential-request-failed","Parent application's token has expired.")):s(T.fromJSON(S.data.error))))}));Pe((wt=e.options_)==null?void 0:wt.signal,(()=>{$.remove()}))}else if(_){let $=_._oAuthCred;if(!$){const S=new Qt(_,nt),A=new Qt(_,at);S.isValid()&&A.isValid()?S.expires>A.expires?($=S,A.destroy()):($=A,S.destroy()):$=S.isValid()?S:A,_._oAuthCred=$}if($.isValid()){y=new k({userId:$.userId??void 0,server:p.server??void 0,token:$.token??void 0,expires:$.expires,ssl:$.ssl??void 0,_oAuthCred:$});const S=_.appId!==$.appId&&this._doPortalSignIn(e.resUrl_);S||$.refreshToken?(e._pendingDfd=$.refreshToken?this._getOAuthToken(p.server,$.refreshToken,$.appId).then((A=>(y.expires=Date.now()+1e3*A.expires_in,y.token=A.access_token,y))):Promise.resolve(y),e._pendingDfd.then((A=>S?this._exchangeToken(A.server,_.appId,A.token).then((W=>(A.token=W,A))).catch((()=>A)):A)).then((A=>{t(A)})).catch((A=>{var Je;const W=(Je=A.details)==null?void 0:Je.httpStatus;W>0&&W!==404?($.destroy(),i()):s(A)}))):t(y)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===$.stateUID&&$.codeVerifier)){const S=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(S,_,p).then((A=>{t(A)})).catch(s)}else{const S=()=>{g?e._pendingDfd=this.oAuthSignIn(e.resUrl_,p,_,e.options_).then(t,s):(w=new T("identity-manager:not-authenticated","User is not signed in."),s(w))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(p.server,_.appId).then((A=>{K(A.portalUrl,this._appOrigin,!0)?(y=new k({userId:A.username,server:p.server??void 0,expires:Date.now()+1e3*A.expires_in,token:A.token}),t(y)):S()})).catch(S):S()}}else if(g){if(this._checkProtocol(e.resUrl_,p,s,e.admin_)){let $=e.options_;e.admin_&&($=$||{},$.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,p,$).then(t,s)}}else w=new T("identity-manager:not-authenticated","User is not signed in."),s(w)},o=()=>{const h=e.sinfo_,c=h.owningSystemUrl,u=e.options_;let d,p,g,_;if(u&&(d=u.token,p=u.error,g=u.prompt),_=this._findCredential(c,{token:d,resource:e.resUrl_}),!_){for(const y of this.credentials)if(this._isIdProvider(c,y.server)){_=y;break}}if(_){const y=this.findCredential(e.resUrl_,_.userId);if(y)t(y);else if(Zt(h,this._legacyFed)){const w=_.toJSON();w.server=h.server,w.resources=null,t(new k(w))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then((w=>{t(new k({userId:_==null?void 0:_.userId,server:h.server??void 0,token:w.token,expires:w.expires!=null?Number(w.expires):null,ssl:!!w.ssl,isAdmin:e.admin_,validity:w.validity}))}),s)}else this._busy=null,d&&(e.options_.token=null),(e._pendingDfd=this.getCredential(c.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:h.owningTenant,signal:e.options_.signal,token:d,error:p,prompt:g})).then((()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)}),(y=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(y)}))};this._errbackFunc=s;const n=e.sinfo_.owningSystemUrl,l=this._isServerRsrc(e.resUrl_),a=e.sinfo_._restInfoPms;a?a.promise.then((h=>{const c=e.sinfo_;if(c._restInfoPms){c.adminTokenServiceUrl=c._restInfoPms.adminUrl,c._restInfoPms=null,c.tokenServiceUrl=(Oe("authInfo.tokenServicesUrl",h)||Oe("authInfo.tokenServiceUrl",h)||Oe("tokenServiceUrl",h))??null,c.shortLivedTokenValidity=Oe("authInfo.shortLivedTokenValidity",h)??null,c.currentVersion=h.currentVersion,c.owningTenant=h.owningTenant;const u=c.owningSystemUrl=h.owningSystemUrl;u&&this._portals.push(u)}l&&c.owningSystemUrl?o():i()}),(()=>{e.sinfo_._restInfoPms=null;const h=new T("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");s(h)})):l&&n?o():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then((h=>{var _;const c={};let u,d,p,g;return h&&(u=(_=h.user)==null?void 0:_.username,c.username=u,c.allSSL=h.allSSL,d=h.supportsOAuth,g=parseFloat(h.currentVersion),h.portalMode==="multitenant"&&(p=h.customBaseUrl),e.sinfo_.currentVersion=g),e.sinfo_.webTierAuth=!!u,u&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:c.allSSL}).catch((()=>null)).then((y=>(c.portalToken=y==null?void 0:y.token,c.tokenExpiration=y==null?void 0:y.expires,c))):!u&&d&&g>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:p,owningTenant:e.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>c)):c})).catch((()=>null)).then((h=>{e.sinfo_._selfReq=null,h?i(h.username,h.allSSL,h.portalToken,h.tokenExpiration):i()})):i()}_generateOAuthInfo(e){let t,s=null,i=e.portalUrl;const o=e.customBaseUrl,n=e.owningTenant,l=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(l){s=this._appUrlObj.path;const a=s.search(/\/(apps|home)\//);s=a>-1?s.slice(0,a):null}return l&&s?(this._hasTestedIfAppIsOnPortal=!0,t=q(s+"/sharing/rest",{query:{f:"json"}}).then((()=>{this._defaultOAuthInfo=new Ws({appId:"arcgisonline",popupCallbackUrl:s+"/home/oauth-callback.html"})}))):t=Promise.resolve(),t.then((()=>{if(this._defaultOAuthInfo)return i=i.replace(/^http:/i,"https:"),q(i+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:n,client_id:this._defaultOAuthInfo.appId,redirect_uri:Mt(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then((a=>{if(a.data.valid){const h=this._defaultOAuthInfo.clone();a.data.urlKey&&o?h.portalUrl="https://"+a.data.urlKey.toLowerCase()+"."+o:h.portalUrl=i,h.popup=window!==window.top||!(K(i,this._appOrigin)||this._gwDomains.some((c=>c.regex.test(i)&&c.regex.test(this._appOrigin)))),this.oAuthInfos.push(h)}}))}))}_doOAuthSignIn(e,t,s,i){const o=s._oAuthCred,n={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(n.hash=window.location.hash),o.stateUID&&(n.uid=o.stateUID);const l={client_id:s.appId,response_type:o.codeVerifier?"code":"token",state:JSON.stringify(n),expiration:s.expiration,locale:s.locale,redirect_uri:this._getRedirectURI(s,!!o.codeVerifier)};s.forceLogin&&(l.force_login=!0),s.forceUserId&&s.userId&&(l.prepopulatedusername=s.userId),!s.popup&&this._doPortalSignIn(e)&&(l.redirectToUserOrgUrl=!0),o.codeVerifier&&(l.code_challenge=i||o.codeVerifier,l.code_challenge_method=i?"S256":"plain");const a=s.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",h=a+"?"+_s(l);if(s.popup){const c=window.open(h,"esriJSAPIOAuth",s.popupWindowFeatures);if(c)c.focus(),this._oAuthDfd.oAuthWin_=c,this._oAuthIntervalId=setInterval((()=>{if(c.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const u=this._oAuthDfd;if(u){const d=new T("identity-manager:user-aborted","ABORTED");u.reject(d)}}}),500),this._oAuthOnPopupHandle=tt(window,["arcgis:auth:hash","arcgis:auth:location:search"],(u=>{u.type==="arcgis:auth:hash"?this.setOAuthResponseHash(u.detail):this._setOAuthResponseQueryString(u.detail)}));else{const u=new T("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(u)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:l,authorizeUrl:a,resourceUrl:e,serverInfo:t,oAuthInfo:s}):window.location.href=h}_getRedirectURI(e,t){const s=window.location.href.replace(/#.*$/,"");if(e.popup)return Mt(e.popupCallbackUrl);if(t){const i=At(s);return i.query&&["code","error","error_description","message_code","persist","state"].forEach((o=>{delete i.query[o]})),ri(i.path,i.query)}return s}}Or.prototype.declaredClass="esri.identity.IdentityManagerBase";let k=class extends Xt.EventedAccessor{constructor(r){super(r),this._oAuthCred=null,this.tokenRefreshBuffer=2,r!=null&&r._oAuthCred&&(this._oAuthCred=r._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const r=Ye,e=r.findServerInfo(this.server),t=e==null?void 0:e.owningSystemUrl,s=!!t&&this.scope==="server",i=s&&Zt(e,r._legacyFed),o=e.webTierAuth,n=o&&r.normalizeWebTierAuth,l=ot[this.server],a=l==null?void 0:l[this.userId];let h,c=this.resources&&this.resources[0],u=s?r.findServerInfo(t):null,d={username:this.userId,password:a};if(o&&!n)return;s&&!u&&r.serverInfos.some((g=>(r._isIdProvider(t,g.server)&&(u=g),!!u)));const p=u?r.findCredential(u.server,this.userId):null;if(!s||p){if(!i){if(s)h={serverUrl:c,token:p==null?void 0:p.token,ssl:p==null?void 0:p.ssl};else if(n)d=null,h={ssl:this.ssl};else{if(!a){let g;return c&&(c=r._sanitizeUrl(c),this._enqueued=1,g=r._enqueue(c,e,null,null,this.isAdmin,this),g.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),g}this.isAdmin&&(h={isAdmin:!0})}return r.generateToken(s?u:e,s?null:d,h).then((g=>{this.token=g.token,this.expires=g.expires!=null?Number(g.expires):null,this.creationTime=Date.now(),this.validity=g.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}p==null||p.refreshToken()}}refreshServerTokens(){if(this.scope==="portal"){const r=Ye;r.credentials.forEach((e=>{const t=r.findServerInfo(e.server),s=t==null?void 0:t.owningSystemUrl;e!==this&&e.userId===this.userId&&s&&e.scope==="server"&&(r._hasSameServerInstance(this.server,s)||r._isIdProvider(s,this.server))&&(Zt(t,r._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())}))}}emitTokenChange(r){clearTimeout(this._refreshTimer);const e=Ye,t=this.server?e.findServerInfo(this.server):null,s=t==null?void 0:t.owningSystemUrl,i=s?e.findServerInfo(s):null;r===!1||s&&this.scope!=="portal"&&(!(i!=null&&i.webTierAuth)||e.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const r=Ye,e=r.credentials.indexOf(this);e>-1&&r.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const r=Qs({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(r.resources=e.slice()),r}_startRefreshTimer(){clearTimeout(this._refreshTimer);const r=6e4*this.tokenRefreshBuffer,e=2**31-1;let t=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();t<0?t=0:t>e&&(t=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),t>r?t-r:t)}};m([v()],k.prototype,"creationTime",void 0),m([v()],k.prototype,"expires",void 0),m([v()],k.prototype,"isAdmin",void 0),m([v()],k.prototype,"oAuthState",void 0),m([v()],k.prototype,"resources",void 0),m([v()],k.prototype,"scope",void 0),m([v()],k.prototype,"server",void 0),m([v()],k.prototype,"ssl",void 0),m([v()],k.prototype,"token",void 0),m([v()],k.prototype,"tokenRefreshBuffer",void 0),m([v()],k.prototype,"userId",void 0),m([v()],k.prototype,"validity",void 0),k=m([We("esri.identity.Credential")],k);class xr extends Or{}xr.prototype.declaredClass="esri.identity.IdentityManager";const Rr=new xr;ii(Rr);const qn=Object.freeze(Object.defineProperty({__proto__:null,default:Rr},Symbol.toStringTag,{value:"Module"}));export{Dn as A,Rn as C,Ln as D,U as E,qn as I,Ms as L,X as T,Tn as a,Cn as b,Mn as c,On as d,Pn as e,wn as f,vr as g,_r as h,vn as i,ro as j,In as k,co as l,kn as m,po as n,Oi as o,gn as p,Re as q,io as r,xn as s,mr as t,$n as u,Hn as v,jn as w,yn as x,En as y,Nn as z};
