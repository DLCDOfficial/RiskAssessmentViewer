const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./groupLayerUtils-V1gJlfLf.js","./utils-B6CQTpbm.js","./index-DzoQLc5A.js","./index-FMl8DCyv.css","./originUtils-1P3A7roi.js","./multiOriginJSONSupportUtils-C0wm8_Yw.js","./jsonContext-0pMglxnV.js","./saveUtils-B9uHK8rd.js","./resourceUtils-DGKBAgd8.js","./resourceUtils-CcmuNY3v.js"])))=>i.map(i=>d[i]);
import{B as l,F as d,J as c,ab as m,j as y,fN as g,cW as L,b2 as w,cQ as $,cU as I,cS as S,cT as A,cV as O,ej as x,bY as h,dm as M,Z as V,b7 as E,fx as p,hy as P,_ as T,g$ as C,b$ as F,c0 as v,dp as f,bl as G}from"./index-DzoQLc5A.js";import{l as _}from"./CollectionFlattener-CcsJT0v9.js";import{t as R}from"./loadAll-cLF51iui.js";import{populateGroupLayer as j}from"./layersCreator-ktUS8r8h.js";import{a as H}from"./lazyLayerLoader-D0MmxHN2.js";import{o as B}from"./saveUtils-B9uHK8rd.js";import{g as U}from"./writeUtils-CpUZEnMe.js";import"https://js.arcgis.com/map-components/4.33/arcgis-map-components.esm.js";import"./loadUtils-TW69t3R7.js";import"./fetchService-pgc0zIL8.js";import"./associatedFeatureServiceUtils-PxhRnZmx.js";import"./portalLayers-Cefelqly.js";function k(e){return new _({getCollections:()=>[e.tables,e.layers],getChildrenFunction:r=>{const t=[];return"tables"in r&&t.push(r.tables),"layers"in r&&t.push(r.layers),t},itemFilterFunction:r=>{const t=r.parent;return!!t&&"tables"in t&&t.tables.includes(r)}})}function u(e,r,t){let i,a;if(e)for(let o=0,s=e.length;o<s;o++){if(i=e.at(o),(i==null?void 0:i[r])===t)return i;if((i==null?void 0:i.type)==="group"&&(a=u(i.layers,r,t),a))return a}}const N=e=>{let r=class extends e{constructor(...t){super(...t),this.layers=new m;const i=s=>{s.parent&&"remove"in s.parent&&s.parent.remove(s)},a=s=>{s.parent=this,this.layerAdded(s),s.type!=="elevation"&&s.type!=="base-elevation"||y.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as an operational layer and will therefore be ignored.`)},o=s=>{s.parent=null,this.layerRemoved(s)};this.addHandles([this.layers.on("before-add",(s=>{if(s.item===this)return s.preventDefault(),void y.getLogger(this).error("#add()","Cannot add layer to itself.");i(s.item)})),this.layers.on("after-add",(s=>a(s.item))),this.layers.on("after-remove",(s=>o(s.item)))])}destroy(){const t=this.layers.toArray();for(const i of t)i.destroy();this.layers.destroy()}set layers(t){this._set("layers",g(t,this._get("layers")))}add(t,i){const a=this.layers;if(i=a.getNextIndex(i),t instanceof L){const o=t;o.parent===this?this.reorder(o,i):a.add(o,i)}else w(t)?t.then((o=>{this.destroyed||this.add(o,i)})):y.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(t,i){const a=this.layers;let o=a.getNextIndex(i);t.slice().forEach((s=>{s.parent!==this?(a.add(s,o),o+=1):this.reorder(s,o)}))}findLayerById(t){return u(this.layers,"id",t)}findLayerByUid(t){return u(this.layers,"uid",t)}remove(t){return this.layers.remove(t)}removeMany(t){return this.layers.removeMany(t)}removeAll(){return this.layers.removeAll()}reorder(t,i){return this.layers.reorder(t,i)}layerAdded(t){}layerRemoved(t){}};return l([d()],r.prototype,"layers",null),r=l([c("esri.support.LayersMixin")],r),r},D=new Set(["feature","subtype-group"]);function b(e,r,t){if(e)for(let i=0,a=e.length;i<a;i++){const o=e.at(i);if(o[r]===t)return o;if((o==null?void 0:o.type)==="group"){const s=b(o.tables,r,t);if(s)return s}}}const z=e=>{let r=class extends e{constructor(...t){super(...t),this.tables=new m,this.addHandles([this.tables.on("after-add",(i=>{const a=i.item;a.parent&&a.parent!==this&&"tables"in a.parent&&a.parent.tables.remove(a),a.parent=this,D.has(a.type)||y.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(i=>{i.item.parent=null}))])}destroy(){const t=this.tables.toArray();for(const i of t)i.destroy();this.tables.destroy()}set tables(t){this._set("tables",g(t,this._get("tables")))}findTableById(t){return b(this.tables,"id",t)}findTableByUid(t){return b(this.tables,"uid",t)}};return l([d()],r.prototype,"tables",null),r=l([c("esri.support.TablesMixin")],r),r},J=Symbol("WebScene");let n=class extends $(I(S(A(z(N(O(L))))))){constructor(e){super(e),this.allLayers=new _({getCollections:()=>[this.layers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=k(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=x((async(r,t,i)=>{const{save:a,saveAs:o}=await T(()=>import("./groupLayerUtils-V1gJlfLf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url);switch(r){case p.SAVE:return a(this,t);case p.SAVE_AS:return o(this,i,t)}}))}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([h((()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&J in e}),(e=>{const r="prevent-adding-tables";this.removeHandles(r),e&&(this.tables.removeAll(),this.addHandles(F((()=>this.tables),"before-add",(t=>{t.preventDefault(),y.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")})),r))}),C),h((()=>this.visible),this._onVisibilityChange.bind(this),v)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===M.USER}_writeLayers(e,r,t,i){const a=[];if(!e)return a;e.forEach((o=>{const s=U(o,i.webmap?i.webmap.getLayerJSONFromResourceInfo(o):null,i);s!=null&&s.layerType&&a.push(s)})),r.layers=a}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,r,t){const{itemId:i,layerType:a}=r;if(a==="GroupLayer"&&i)return new V({id:i,portal:t==null?void 0:t.portal})}writePortalItem(e,r){e!=null&&e.id&&(r.itemId=e.id)}set visibilityMode(e){const r=this._get("visibilityMode")!==e;this._set("visibilityMode",e),r&&this._enforceVisibility(e,this.visible)}async beforeSave(){return B(this)}load(e){const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service","Video Service"],layerModuleTypeMap:H,populateGroupLayer:j},e).catch((t=>{if(E(t),this.sourceIsPortalItem)throw t}));return this.addResolvingPromise(r),Promise.resolve(this)}async loadAll(){return R(this,(e=>{e(this.layers,this.tables)}))}async save(e){return this._debouncedSaveOperations(p.SAVE,e)}async saveAs(e,r){return this._debouncedSaveOperations(p.SAVE_AS,r,e)}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(h((()=>e.visible),(r=>this._onChildVisibilityChange(e,r)),v),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach((r=>{r!==e&&(r.visible=!1)}))}_enforceVisibility(e,r){if(!P(this).initialized)return;const t=this.layers;let i=t.find((a=>a.visible));switch(e){case"exclusive":t.length&&!i&&(i=t.at(0),i.visible=!0),this._turnOffOtherLayers(i);break;case"inherited":t.forEach((a=>{a.visible=r}))}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach((r=>{r.visible=e}))}_onChildVisibilityChange(e,r){switch(this.visibilityMode){case"exclusive":r?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some((e=>e.visible))}};l([d({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),l([d({readOnly:!0})],n.prototype,"allTables",void 0),l([d({json:{read:!0,write:!0}})],n.prototype,"blendMode",void 0),l([d()],n.prototype,"fullExtent",void 0),l([d({readOnly:!0})],n.prototype,"sourceIsPortalItem",null),l([d({json:{read:!1,write:{ignoreOrigin:!0}}})],n.prototype,"layers",void 0),l([f("layers")],n.prototype,"_writeLayers",null),l([d({type:["GroupLayer"]})],n.prototype,"operationalLayerType",void 0),l([d({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,r,t){return{enabled:(e==null?void 0:e.type)==="Group Layer"&&(t==null?void 0:t.initiator)!==this}}}},"web-scene":{read:!1,write:!1}}}})],n.prototype,"portalItem",null),l([G("web-map","portalItem",["itemId"])],n.prototype,"readPortalItem",null),l([f("web-map","portalItem",{itemId:{type:String}})],n.prototype,"writePortalItem",null),l([d()],n.prototype,"spatialReference",void 0),l([d({json:{read:!1},readOnly:!0,value:"group"})],n.prototype,"type",void 0),l([d({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,r,t)=>{e!=="inherited"&&(r[t]=e)}}}}})],n.prototype,"visibilityMode",null),n=l([c("esri.layers.GroupLayer")],n);const ae=n;export{ae as default};
